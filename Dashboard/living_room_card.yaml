# Living Room Card - Improved
# ═══════════════════════════════════════════════════════════════════════
# v6 - Compact + room-specific:
# - More compact layout: reduced tile sizes, padding, 3-column light grid
# - Fix Reset conditional: uses sensor.room_living_state manually_controlled_lights
# - Fix Brighter/Dimmer: uses script.oal_manual_brightness_step with lights param
# - Added missing lights: spot_lights, column_lights (6 total, 3x2 grid)
# - Reset clears all living room AL zones
# - Each tile checks correct AL switch for manual control dot
# ═══════════════════════════════════════════════════════════════════════

type: vertical-stack
cards:
  # ═══════════════════════════════════════════════════════════════════════
  # HEADER - Room separator with brightness slider only
  # ═══════════════════════════════════════════════════════════════════════
  - type: custom:bubble-card
    card_type: separator
    entity: light.living_room_lights
    name: Living Room
    icon: mdi:sofa
    sub_button:
      main:
        - entity: light.living_room_lights
          sub_button_type: slider
          name: Brightness
          icon: mdi:brightness-7
          hold_action:
            action: toggle
      bottom: []
    styles: |-
      ${(() => {
        const roomState = hass.states['sensor.room_living_state']?.state || 'idle';
        const lightsOn = parseInt(hass.states['sensor.room_living_state']?.attributes?.lights_on || '0');

        let iconColor, iconBg;
        if (roomState === 'playing') {
          iconColor = 'rgb(66, 133, 244)';
          iconBg = 'rgba(66, 133, 244, 0.18)';
        } else if (roomState === 'active' || lightsOn > 0) {
          iconColor = 'rgb(255, 149, 0)';
          iconBg = 'rgba(255, 149, 0, 0.18)';
        } else {
          iconColor = 'rgba(50, 50, 50, 0.55)';
          iconBg = 'rgba(80, 80, 80, 0.10)';
        }

        return `
          ha-card {
            background: transparent !important;
            border: none !important;
            box-shadow: none !important;
            padding: 10px 14px 4px 14px !important;
            margin: 0 !important;
          }

          .bubble-icon-container {
            background: ${iconBg} !important;
            border-radius: 50% !important;
            min-width: 52px !important;
            min-height: 52px !important;
            border: 1.5px solid ${iconColor.replace('rgb', 'rgba').replace(')', ', 0.25)')} !important;
          }

          .bubble-icon {
            color: ${iconColor} !important;
            --mdc-icon-size: 30px !important;
            ${roomState !== 'idle' ? `filter: drop-shadow(0 0 4px ${iconColor.replace('rgb', 'rgba').replace(')', ', 0.4)')}) !important;` : ''}
          }

          .bubble-name {
            font-size: 22px !important;
            font-weight: 700 !important;
            color: rgba(25, 25, 25, 0.95) !important;
            letter-spacing: -0.3px !important;
          }

          .bubble-sub-button-container {
            gap: 8px !important;
          }

          .bubble-sub-button {
            background: ${iconBg} !important;
            border: 1px solid ${iconColor.replace('rgb', 'rgba').replace(')', ', 0.25)')} !important;
            border-radius: 50% !important;
            min-width: 36px !important;
            min-height: 36px !important;
            transition: transform 0.1s ease, background 0.2s ease !important;
          }

          .bubble-sub-button:active {
            transform: scale(0.90) !important;
          }

          .bubble-sub-button ha-icon {
            color: ${iconColor} !important;
            --mdc-icon-size: 18px !important;
          }
        `;
      })()}

  # ═══════════════════════════════════════════════════════════════════════
  # QUICK ACTIONS ROW - Conditional room-level controls
  # ═══════════════════════════════════════════════════════════════════════
  - type: custom:bubble-card
    card_type: button
    button_type: name
    card_layout: large
    show_icon: false
    show_name: false
    show_state: false
    sub_button:
      main:
        - name: Quick Controls
          buttons_layout: inline
          group:
            # All Lights On/Off
            - entity: light.living_room_lights
              name: All
              icon: mdi:lightbulb-group
              show_name: false
              show_icon: true
              show_background: true
              state_background: false
              custom_height: 32
              fill_width: false
              tap_action:
                action: toggle
              hold_action:
                action: more-info
            # Reset Room Override (conditional - only when lights manually controlled)
            - entity: switch.adaptive_lighting_main_living
              name: Reset
              icon: mdi:refresh
              show_name: false
              show_icon: true
              show_background: true
              state_background: false
              custom_height: 32
              fill_width: false
              visibility:
                - condition: template
                  value_template: "{{ (state_attr('sensor.room_living_state', 'manually_controlled_lights') | default([])) | length > 0 }}"
              tap_action:
                action: call-service
                service: adaptive_lighting.set_manual_control
                data:
                  entity_id:
                    - switch.adaptive_lighting_main_living
                    - switch.adaptive_lighting_accent_spots
                    - switch.adaptive_lighting_column_lights
                    - switch.adaptive_lighting_recessed_ceiling
                  manual_control: false
            # Alarm (conditional - when upcoming alarm exists)
            - entity: sensor.sonos_next_alarm_chip
              name: Alarm
              icon: mdi:alarm
              show_name: false
              show_icon: true
              show_background: true
              state_background: false
              custom_height: 32
              fill_width: false
              visibility:
                - condition: template
                  value_template: "{{ state_attr('sensor.room_living_state', 'has_upcoming_alarm') | default(false) }}"
              tap_action:
                action: perform-action
                perform_action: script.sonos_toggle_next_alarm
                data:
                  alarm_entity: "{{ state_attr('sensor.room_living_state', 'next_alarm_entity') }}"
                  tracker: input_text.sonos_manually_toggled_alarm_living_room
              hold_action:
                action: more-info
            # Brighter (room-specific via global brighter with lights filter)
            - entity: input_number.oal_manual_offset_main_living_brightness
              name: Brighter
              icon: mdi:brightness-7
              show_name: false
              show_icon: true
              show_background: true
              state_background: false
              custom_height: 32
              fill_width: false
              tap_action:
                action: perform-action
                perform_action: script.oal_global_manual_brighter
                data:
                  lights: light.living_room_lights
              hold_action:
                action: more-info
                entity: input_number.oal_manual_offset_main_living_brightness
            # Dimmer (room-specific via global dimmer with lights filter)
            - entity: input_number.oal_manual_offset_main_living_brightness
              name: Dimmer
              icon: mdi:brightness-5
              show_name: false
              show_icon: true
              show_background: true
              state_background: false
              custom_height: 32
              fill_width: false
              tap_action:
                action: perform-action
                perform_action: script.oal_global_manual_dimmer
                data:
                  lights: light.living_room_lights
              hold_action:
                action: more-info
                entity: input_number.oal_manual_offset_main_living_brightness
            # Play/Pause (conditional - when media playing/paused)
            - entity: media_player.living_room
              name: Media
              icon: mdi:play-pause
              show_name: false
              show_icon: true
              show_background: true
              state_background: false
              custom_height: 32
              fill_width: false
              visibility:
                - condition: template
                  value_template: >-
                    {{ states('media_player.living_room') in ['playing', 'paused'] }}
              tap_action:
                action: perform-action
                perform_action: media_player.media_play_pause
                target:
                  entity_id: media_player.living_room
              hold_action:
                action: more-info
              double_tap_action:
                action: call-service
                service: script.sonos_toggle_group_membership
                data:
                  target_speaker: media_player.living_room
    styles: |-
      ha-card {
        background: transparent !important;
        border: none !important;
        box-shadow: none !important;
        margin: 0 !important;
        padding: 0px 14px 0px 14px !important;
      }

      .bubble-button-card-container {
        background: transparent !important;
      }

      .bubble-sub-button-container {
        background: rgba(60, 60, 60, 0.05) !important;
        backdrop-filter: blur(4px) !important;
        -webkit-backdrop-filter: blur(4px) !important;
        border-radius: 10px !important;
        border: 1px solid rgba(60, 60, 60, 0.10) !important;
        padding: 4px 6px !important;
        margin: 0 auto !important;
        box-shadow: none !important;
        width: fit-content !important;
        justify-content: center !important;
      }

      .bubble-sub-button-1,
      .bubble-sub-button-2,
      .bubble-sub-button-3,
      .bubble-sub-button-4,
      .bubble-sub-button-5,
      .bubble-sub-button-6 {
        background: rgba(60, 60, 60, 0.07) !important;
        border: 1px solid rgba(60, 60, 60, 0.12) !important;
        border-radius: 8px !important;
        margin-left: 4px !important;
        transition: transform 0.1s ease, background 0.15s ease !important;
      }
      .bubble-sub-button-1 {
        margin-left: 0 !important;
      }
      .bubble-sub-button-1:active,
      .bubble-sub-button-2:active,
      .bubble-sub-button-3:active,
      .bubble-sub-button-4:active,
      .bubble-sub-button-5:active,
      .bubble-sub-button-6:active {
        transform: scale(0.90) !important;
      }

      /* All Lights - dynamic on/off */
      .bubble-sub-button-1 {
        background: ${hass.states['light.living_room_lights']?.state === 'on'
          ? 'rgba(255, 149, 0, 0.16)'
          : 'rgba(60, 60, 60, 0.07)'} !important;
        border: ${hass.states['light.living_room_lights']?.state === 'on'
          ? '1px solid rgba(255, 149, 0, 0.35)'
          : '1px solid rgba(60, 60, 60, 0.12)'} !important;
      }
      .bubble-sub-button-1 .bubble-sub-button-icon {
        color: ${hass.states['light.living_room_lights']?.state === 'on'
          ? 'rgb(255, 149, 0)'
          : 'rgba(60, 60, 60, 0.55)'} !important;
        --mdc-icon-size: 16px !important;
      }

      /* Reset - active when overrides exist */
      ${(() => {
        const manualLights = hass.states['sensor.room_living_state']?.attributes?.manually_controlled_lights || [];
        const hasOverride = Array.isArray(manualLights) && manualLights.length > 0;
        return `
          .bubble-sub-button-2 {
            background: ${hasOverride ? 'rgba(255, 110, 90, 0.14)' : 'rgba(60, 60, 60, 0.07)'} !important;
            border: ${hasOverride ? '1px solid rgba(255, 110, 90, 0.35)' : '1px solid rgba(60, 60, 60, 0.12)'} !important;
          }
          .bubble-sub-button-2 .bubble-sub-button-icon {
            color: ${hasOverride ? 'rgb(255, 110, 90)' : 'rgba(60, 60, 60, 0.55)'} !important;
            --mdc-icon-size: 16px !important;
          }
        `;
      })()}

      /* Alarm - active when enabled */
      ${(() => {
        const s = hass.states['sensor.hero_button_alarm_state'];
        const isEnabled = s?.attributes?.is_enabled === true || s?.attributes?.is_enabled === 'True';
        const formattedTime = s?.attributes?.formatted_time || 'OFF';
        return `
          .bubble-sub-button-3 {
            background: ${isEnabled ? 'rgba(66, 133, 244, 0.14)' : 'rgba(60, 60, 60, 0.07)'} !important;
            border: ${isEnabled ? '1px solid rgba(66, 133, 244, 0.35)' : '1px solid rgba(60, 60, 60, 0.12)'} !important;
            position: relative !important;
          }
          .bubble-sub-button-3 .bubble-sub-button-icon {
            color: ${isEnabled ? 'rgb(66, 133, 244)' : 'rgba(60, 60, 60, 0.55)'} !important;
            --mdc-icon-size: 16px !important;
          }
          .bubble-sub-button-3::after {
            content: '${isEnabled ? formattedTime : (formattedTime !== 'OFF' ? formattedTime + ' OFF' : '')}' !important;
            position: absolute !important;
            bottom: 1px !important;
            right: 3px !important;
            font-size: 7px !important;
            font-weight: 600 !important;
            color: ${isEnabled ? 'rgba(66, 133, 244, 0.9)' : 'rgba(60, 60, 60, 0.5)'} !important;
          }
        `;
      })()}

      /* Brighter/Dimmer - active when LIVING ROOM offset modified */
      ${(() => {
        const offset = parseFloat(hass.states['input_number.oal_manual_offset_main_living_brightness']?.state || '0');
        const isBrighter = offset > 0;
        const isDimmer = offset < 0;
        return `
          .bubble-sub-button-4 {
            background: ${isBrighter ? 'rgba(138, 100, 200, 0.12)' : 'rgba(60, 60, 60, 0.07)'} !important;
            border: ${isBrighter ? '1px solid rgba(138, 100, 200, 0.30)' : '1px solid rgba(60, 60, 60, 0.12)'} !important;
          }
          .bubble-sub-button-4 .bubble-sub-button-icon {
            color: ${isBrighter ? 'rgba(120, 80, 180, 0.85)' : 'rgba(60, 60, 60, 0.55)'} !important;
            --mdc-icon-size: 16px !important;
          }
          .bubble-sub-button-5 {
            background: ${isDimmer ? 'rgba(138, 100, 200, 0.12)' : 'rgba(60, 60, 60, 0.07)'} !important;
            border: ${isDimmer ? '1px solid rgba(138, 100, 200, 0.30)' : '1px solid rgba(60, 60, 60, 0.12)'} !important;
          }
          .bubble-sub-button-5 .bubble-sub-button-icon {
            color: ${isDimmer ? 'rgba(120, 80, 180, 0.85)' : 'rgba(60, 60, 60, 0.55)'} !important;
            --mdc-icon-size: 16px !important;
          }
        `;
      })()}

      /* Play/Pause - active when playing */
      ${(() => {
        const isPlaying = hass.states['media_player.living_room']?.state === 'playing';
        return `
          .bubble-sub-button-6 {
            background: ${isPlaying ? 'rgba(66, 133, 244, 0.14)' : 'rgba(60, 60, 60, 0.07)'} !important;
            border: ${isPlaying ? '1px solid rgba(66, 133, 244, 0.35)' : '1px solid rgba(60, 60, 60, 0.12)'} !important;
          }
          .bubble-sub-button-6 .bubble-sub-button-icon {
            color: ${isPlaying ? 'rgb(66, 133, 244)' : 'rgba(60, 60, 60, 0.55)'} !important;
            --mdc-icon-size: 16px !important;
          }
        `;
      })()}

  # ═══════════════════════════════════════════════════════════════════════
  # LIGHTS GRID - 6 lights in 3 columns (compact)
  # ═══════════════════════════════════════════════════════════════════════
  - type: custom:layout-card
    layout_type: custom:grid-layout
    layout:
      grid-template-columns: repeat(3, 1fr)
      gap: 8px
      padding: 2px 12px 4px 12px
      mediaquery:
        "(max-width: 400px)":
          grid-template-columns: repeat(2, 1fr)
    cards:
      # ─────────────────────────────────────────────────────────────────
      # Floor Lamp (main_living zone)
      # ─────────────────────────────────────────────────────────────────
      - type: custom:bubble-card
        card_type: button
        button_type: slider
        entity: light.living_room_floor_lamp
        name: Floor
        icon: mdi:floor-lamp
        show_state: false
        show_attribute: true
        attribute: brightness
        scrolling_effect: false
        tap_action:
          action: toggle
        hold_action:
          action: more-info
        double_tap_action:
          action: call-service
          service: light.turn_on
          target:
            entity_id: light.living_room_floor_lamp
          data:
            brightness_pct: 100
        card_mod:
          style: |
            ha-card {
              background: transparent !important;
              border: none !important;
              box-shadow: none !important;
            }
        styles: |
          .bubble-button-card-container {
            position: relative !important;
            display: grid !important;
            grid-template-rows: auto auto 1fr auto !important;
            justify-items: center !important;
            align-items: center !important;
            text-align: center !important;
            min-height: 100px !important;
            padding: 10px 4px 8px 4px !important;
            border-radius: 14px !important;
            overflow: hidden !important;
            clip-path: inset(0 round 14px) !important;
            transition: transform 0.15s ease-out, border-color 0.3s ease, background 0.3s ease, box-shadow 0.3s ease !important;
            background: ${state === 'on'
              ? 'linear-gradient(180deg, rgba(255, 149, 0, 0.13) 0%, rgba(255, 255, 255, 0.06) 100%)'
              : 'rgba(255, 255, 255, 0.08)'} !important;
            backdrop-filter: ${state === 'on'
              ? 'blur(12px) saturate(140%)'
              : 'blur(8px) saturate(110%)'} !important;
            -webkit-backdrop-filter: ${state === 'on'
              ? 'blur(12px) saturate(140%)'
              : 'blur(8px) saturate(110%)'} !important;
            border: ${state === 'on'
              ? '1px solid rgba(255, 149, 0, 0.40)'
              : '1px solid rgba(160, 160, 165, 0.30)'} !important;
            box-shadow: ${state === 'on'
              ? '0 4px 20px rgba(255, 149, 0, 0.10), inset 0 1px 0 rgba(255, 255, 255, 0.25)'
              : '0 1px 6px rgba(0, 0, 0, 0.04), inset 0 1px 0 rgba(255, 255, 255, 0.15)'} !important;
          }
          .bubble-button-card-container:active {
            transform: scale(0.95) !important;
          }
          .bubble-content-container {
            display: grid !important;
            grid-template-rows: auto auto 1fr !important;
            justify-items: center !important;
            width: 100% !important;
            position: relative !important;
            z-index: 5 !important;
            padding-bottom: 10px !important;
          }
          .bubble-button-card-container::after {
            content: '' !important;
            position: absolute !important;
            top: 5px !important;
            right: 5px !important;
            width: ${(hass.states['switch.adaptive_lighting_main_living']?.attributes?.manual_control || []).includes('light.living_room_floor_lamp') ? '7px' : '0px'} !important;
            height: ${(hass.states['switch.adaptive_lighting_main_living']?.attributes?.manual_control || []).includes('light.living_room_floor_lamp') ? '7px' : '0px'} !important;
            border-radius: 50% !important;
            background: ${(hass.states['switch.adaptive_lighting_main_living']?.attributes?.manual_control || []).includes('light.living_room_floor_lamp') ? 'rgb(255, 110, 90)' : 'transparent'} !important;
            border: ${(hass.states['switch.adaptive_lighting_main_living']?.attributes?.manual_control || []).includes('light.living_room_floor_lamp') ? '1.5px solid rgba(255, 255, 255, 0.9)' : 'none'} !important;
            box-shadow: ${(hass.states['switch.adaptive_lighting_main_living']?.attributes?.manual_control || []).includes('light.living_room_floor_lamp') ? '0 0 4px rgba(255, 110, 90, 0.5)' : 'none'} !important;
            transition: all 0.2s ease !important;
            z-index: 25 !important;
          }
          .bubble-icon-container {
            min-width: 42px !important;
            min-height: 42px !important;
            grid-row: 1 !important;
            margin: 2px 0 4px 0 !important;
            border-radius: 50% !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            background: ${state === 'on'
              ? 'rgba(255, 149, 0, 0.12)'
              : 'rgba(150, 150, 155, 0.10)'} !important;
            border: ${state === 'on'
              ? '1.5px solid rgba(255, 149, 0, 0.25)'
              : '1.5px solid rgba(150, 150, 155, 0.18)'} !important;
            backdrop-filter: blur(4px) !important;
            -webkit-backdrop-filter: blur(4px) !important;
            transition: background 0.3s ease, border-color 0.3s ease !important;
          }
          .bubble-icon {
            --mdc-icon-size: 24px !important;
            color: ${state === 'on'
              ? 'rgb(255, 149, 0)'
              : 'rgba(80, 80, 80, 0.45)'} !important;
            filter: ${state === 'on'
              ? 'drop-shadow(0 0 6px rgba(255, 149, 0, 0.45))'
              : 'none'} !important;
            transition: color 0.3s ease, filter 0.3s ease !important;
          }
          .bubble-name-container {
            grid-row: 2 !important;
            margin: 0 !important;
            width: 100% !important;
          }
          .bubble-name {
            font-weight: 650 !important;
            font-size: 14px !important;
            line-height: 1.2 !important;
            justify-content: center !important;
            margin: 0 2px !important;
            color: ${state === 'on'
              ? 'rgba(25, 25, 25, 0.95)'
              : 'rgba(70, 70, 70, 0.65)'} !important;
          }
          .bubble-state {
            font-size: 13px !important;
            font-weight: 600 !important;
            margin-top: 1px !important;
            justify-content: center !important;
            color: ${state === 'on'
              ? 'rgb(255, 149, 0)'
              : 'rgba(100, 100, 100, 0.5)'} !important;
          }
          .bubble-attribute {
            font-size: 13px !important;
            font-weight: 600 !important;
            margin-top: 1px !important;
            justify-content: center !important;
            color: ${state === 'on'
              ? 'rgb(255, 149, 0)'
              : 'rgba(100, 100, 100, 0.5)'} !important;
            transition: opacity 0.15s ease !important;
          }
          .bubble-range-slider {
            position: absolute !important;
            bottom: 0 !important;
            left: 0 !important;
            right: 0 !important;
            width: 100% !important;
            height: 4px !important;
            border-radius: 0 0 14px 14px !important;
            z-index: 10 !important;
            background: rgba(0, 0, 0, 0.06) !important;
            overflow: visible !important;
            opacity: 1 !important;
          }
          .bubble-range-fill {
            height: 4px !important;
            border-radius: 0 0 14px 0 !important;
            background: rgb(255, 149, 0) !important;
          }
          .bubble-range-value {
            position: absolute !important;
            top: unset !important;
            right: unset !important;
            bottom: 50px !important;
            left: 50% !important;
            transform: translateX(-50%) !important;
            font-size: 14px !important;
            font-weight: 700 !important;
            color: rgb(255, 149, 0) !important;
            background: rgba(255, 255, 255, 0.92) !important;
            padding: 2px 8px !important;
            border-radius: 8px !important;
            box-shadow: 0 1px 6px rgba(0, 0, 0, 0.10) !important;
            opacity: 0 !important;
            pointer-events: none !important;
            transition: opacity 0.15s ease !important;
            z-index: 30 !important;
            white-space: nowrap !important;
          }
          .is-dragging .bubble-range-value {
            opacity: 1 !important;
          }
          .is-dragging .bubble-attribute {
            opacity: 0 !important;
          }
          .is-dragging .bubble-state {
            opacity: 0 !important;
          }

      # ─────────────────────────────────────────────────────────────────
      # Couch Lamp (main_living zone)
      # ─────────────────────────────────────────────────────────────────
      - type: custom:bubble-card
        card_type: button
        button_type: slider
        entity: light.living_room_couch_lamp
        name: Couch
        icon: mdi:lamp
        show_state: false
        show_attribute: true
        attribute: brightness
        scrolling_effect: false
        tap_action:
          action: toggle
        hold_action:
          action: more-info
        double_tap_action:
          action: call-service
          service: light.turn_on
          target:
            entity_id: light.living_room_couch_lamp
          data:
            brightness_pct: 100
        card_mod:
          style: |
            ha-card {
              background: transparent !important;
              border: none !important;
              box-shadow: none !important;
            }
        styles: |
          .bubble-button-card-container {
            position: relative !important;
            display: grid !important;
            grid-template-rows: auto auto 1fr auto !important;
            justify-items: center !important;
            align-items: center !important;
            text-align: center !important;
            min-height: 100px !important;
            padding: 10px 4px 8px 4px !important;
            border-radius: 14px !important;
            overflow: hidden !important;
            clip-path: inset(0 round 14px) !important;
            transition: transform 0.15s ease-out, border-color 0.3s ease, background 0.3s ease, box-shadow 0.3s ease !important;
            background: ${state === 'on'
              ? 'linear-gradient(180deg, rgba(255, 149, 0, 0.13) 0%, rgba(255, 255, 255, 0.06) 100%)'
              : 'rgba(255, 255, 255, 0.08)'} !important;
            backdrop-filter: ${state === 'on'
              ? 'blur(12px) saturate(140%)'
              : 'blur(8px) saturate(110%)'} !important;
            -webkit-backdrop-filter: ${state === 'on'
              ? 'blur(12px) saturate(140%)'
              : 'blur(8px) saturate(110%)'} !important;
            border: ${state === 'on'
              ? '1px solid rgba(255, 149, 0, 0.40)'
              : '1px solid rgba(160, 160, 165, 0.30)'} !important;
            box-shadow: ${state === 'on'
              ? '0 4px 20px rgba(255, 149, 0, 0.10), inset 0 1px 0 rgba(255, 255, 255, 0.25)'
              : '0 1px 6px rgba(0, 0, 0, 0.04), inset 0 1px 0 rgba(255, 255, 255, 0.15)'} !important;
          }
          .bubble-button-card-container:active { transform: scale(0.95) !important; }
          .bubble-content-container { display: grid !important; grid-template-rows: auto auto 1fr !important; justify-items: center !important; width: 100% !important; position: relative !important; z-index: 5 !important; padding-bottom: 10px !important; }
          .bubble-button-card-container::after { content: '' !important; position: absolute !important; top: 5px !important; right: 5px !important; width: ${(hass.states['switch.adaptive_lighting_main_living']?.attributes?.manual_control || []).includes('light.living_room_couch_lamp') ? '7px' : '0px'} !important; height: ${(hass.states['switch.adaptive_lighting_main_living']?.attributes?.manual_control || []).includes('light.living_room_couch_lamp') ? '7px' : '0px'} !important; border-radius: 50% !important; background: ${(hass.states['switch.adaptive_lighting_main_living']?.attributes?.manual_control || []).includes('light.living_room_couch_lamp') ? 'rgb(255, 110, 90)' : 'transparent'} !important; border: ${(hass.states['switch.adaptive_lighting_main_living']?.attributes?.manual_control || []).includes('light.living_room_couch_lamp') ? '1.5px solid rgba(255, 255, 255, 0.9)' : 'none'} !important; box-shadow: ${(hass.states['switch.adaptive_lighting_main_living']?.attributes?.manual_control || []).includes('light.living_room_couch_lamp') ? '0 0 4px rgba(255, 110, 90, 0.5)' : 'none'} !important; transition: all 0.2s ease !important; z-index: 25 !important; }
          .bubble-icon-container { min-width: 42px !important; min-height: 42px !important; grid-row: 1 !important; margin: 2px 0 4px 0 !important; border-radius: 50% !important; display: flex !important; align-items: center !important; justify-content: center !important; background: ${state === 'on' ? 'rgba(255, 149, 0, 0.12)' : 'rgba(150, 150, 155, 0.10)'} !important; border: ${state === 'on' ? '1.5px solid rgba(255, 149, 0, 0.25)' : '1.5px solid rgba(150, 150, 155, 0.18)'} !important; backdrop-filter: blur(4px) !important; -webkit-backdrop-filter: blur(4px) !important; transition: background 0.3s ease, border-color 0.3s ease !important; }
          .bubble-icon { --mdc-icon-size: 24px !important; color: ${state === 'on' ? 'rgb(255, 149, 0)' : 'rgba(80, 80, 80, 0.45)'} !important; filter: ${state === 'on' ? 'drop-shadow(0 0 6px rgba(255, 149, 0, 0.45))' : 'none'} !important; transition: color 0.3s ease, filter 0.3s ease !important; }
          .bubble-name-container { grid-row: 2 !important; margin: 0 !important; width: 100% !important; }
          .bubble-name { font-weight: 650 !important; font-size: 14px !important; line-height: 1.2 !important; justify-content: center !important; margin: 0 2px !important; color: ${state === 'on' ? 'rgba(25, 25, 25, 0.95)' : 'rgba(70, 70, 70, 0.65)'} !important; }
          .bubble-state { font-size: 13px !important; font-weight: 600 !important; margin-top: 1px !important; justify-content: center !important; color: ${state === 'on' ? 'rgb(255, 149, 0)' : 'rgba(100, 100, 100, 0.5)'} !important; }
          .bubble-attribute { font-size: 13px !important; font-weight: 600 !important; margin-top: 1px !important; justify-content: center !important; color: ${state === 'on' ? 'rgb(255, 149, 0)' : 'rgba(100, 100, 100, 0.5)'} !important; transition: opacity 0.15s ease !important; }
          .bubble-range-slider { position: absolute !important; bottom: 0 !important; left: 0 !important; right: 0 !important; width: 100% !important; height: 4px !important; border-radius: 0 0 14px 14px !important; z-index: 10 !important; background: rgba(0, 0, 0, 0.06) !important; overflow: visible !important; opacity: 1 !important; }
          .bubble-range-fill { height: 4px !important; border-radius: 0 0 14px 0 !important; background: rgb(255, 149, 0) !important; }
          .bubble-range-value { position: absolute !important; top: unset !important; right: unset !important; bottom: 50px !important; left: 50% !important; transform: translateX(-50%) !important; font-size: 14px !important; font-weight: 700 !important; color: rgb(255, 149, 0) !important; background: rgba(255, 255, 255, 0.92) !important; padding: 2px 8px !important; border-radius: 8px !important; box-shadow: 0 1px 6px rgba(0, 0, 0, 0.10) !important; opacity: 0 !important; pointer-events: none !important; transition: opacity 0.15s ease !important; z-index: 30 !important; white-space: nowrap !important; }
          .is-dragging .bubble-range-value { opacity: 1 !important; }
          .is-dragging .bubble-attribute { opacity: 0 !important; }
          .is-dragging .bubble-state { opacity: 0 !important; }

      # ─────────────────────────────────────────────────────────────────
      # Entryway Lamp (main_living zone)
      # ─────────────────────────────────────────────────────────────────
      - type: custom:bubble-card
        card_type: button
        button_type: slider
        entity: light.entryway_lamp
        name: Entry
        icon: mdi:desk-lamp
        show_state: false
        show_attribute: true
        attribute: brightness
        scrolling_effect: false
        tap_action:
          action: toggle
        hold_action:
          action: more-info
        double_tap_action:
          action: call-service
          service: light.turn_on
          target:
            entity_id: light.entryway_lamp
          data:
            brightness_pct: 100
        card_mod:
          style: |
            ha-card {
              background: transparent !important;
              border: none !important;
              box-shadow: none !important;
            }
        styles: |
          .bubble-button-card-container {
            position: relative !important;
            display: grid !important;
            grid-template-rows: auto auto 1fr auto !important;
            justify-items: center !important;
            align-items: center !important;
            text-align: center !important;
            min-height: 100px !important;
            padding: 10px 4px 8px 4px !important;
            border-radius: 14px !important;
            overflow: hidden !important;
            clip-path: inset(0 round 14px) !important;
            transition: transform 0.15s ease-out, border-color 0.3s ease, background 0.3s ease, box-shadow 0.3s ease !important;
            background: ${state === 'on'
              ? 'linear-gradient(180deg, rgba(255, 149, 0, 0.13) 0%, rgba(255, 255, 255, 0.06) 100%)'
              : 'rgba(255, 255, 255, 0.08)'} !important;
            backdrop-filter: ${state === 'on'
              ? 'blur(12px) saturate(140%)'
              : 'blur(8px) saturate(110%)'} !important;
            -webkit-backdrop-filter: ${state === 'on'
              ? 'blur(12px) saturate(140%)'
              : 'blur(8px) saturate(110%)'} !important;
            border: ${state === 'on'
              ? '1px solid rgba(255, 149, 0, 0.40)'
              : '1px solid rgba(160, 160, 165, 0.30)'} !important;
            box-shadow: ${state === 'on'
              ? '0 4px 20px rgba(255, 149, 0, 0.10), inset 0 1px 0 rgba(255, 255, 255, 0.25)'
              : '0 1px 6px rgba(0, 0, 0, 0.04), inset 0 1px 0 rgba(255, 255, 255, 0.15)'} !important;
          }
          .bubble-button-card-container:active { transform: scale(0.95) !important; }
          .bubble-content-container { display: grid !important; grid-template-rows: auto auto 1fr !important; justify-items: center !important; width: 100% !important; position: relative !important; z-index: 5 !important; padding-bottom: 10px !important; }
          .bubble-button-card-container::after { content: '' !important; position: absolute !important; top: 5px !important; right: 5px !important; width: ${(hass.states['switch.adaptive_lighting_main_living']?.attributes?.manual_control || []).includes('light.entryway_lamp') ? '7px' : '0px'} !important; height: ${(hass.states['switch.adaptive_lighting_main_living']?.attributes?.manual_control || []).includes('light.entryway_lamp') ? '7px' : '0px'} !important; border-radius: 50% !important; background: ${(hass.states['switch.adaptive_lighting_main_living']?.attributes?.manual_control || []).includes('light.entryway_lamp') ? 'rgb(255, 110, 90)' : 'transparent'} !important; border: ${(hass.states['switch.adaptive_lighting_main_living']?.attributes?.manual_control || []).includes('light.entryway_lamp') ? '1.5px solid rgba(255, 255, 255, 0.9)' : 'none'} !important; box-shadow: ${(hass.states['switch.adaptive_lighting_main_living']?.attributes?.manual_control || []).includes('light.entryway_lamp') ? '0 0 4px rgba(255, 110, 90, 0.5)' : 'none'} !important; transition: all 0.2s ease !important; z-index: 25 !important; }
          .bubble-icon-container { min-width: 42px !important; min-height: 42px !important; grid-row: 1 !important; margin: 2px 0 4px 0 !important; border-radius: 50% !important; display: flex !important; align-items: center !important; justify-content: center !important; background: ${state === 'on' ? 'rgba(255, 149, 0, 0.12)' : 'rgba(150, 150, 155, 0.10)'} !important; border: ${state === 'on' ? '1.5px solid rgba(255, 149, 0, 0.25)' : '1.5px solid rgba(150, 150, 155, 0.18)'} !important; backdrop-filter: blur(4px) !important; -webkit-backdrop-filter: blur(4px) !important; transition: background 0.3s ease, border-color 0.3s ease !important; }
          .bubble-icon { --mdc-icon-size: 24px !important; color: ${state === 'on' ? 'rgb(255, 149, 0)' : 'rgba(80, 80, 80, 0.45)'} !important; filter: ${state === 'on' ? 'drop-shadow(0 0 6px rgba(255, 149, 0, 0.45))' : 'none'} !important; transition: color 0.3s ease, filter 0.3s ease !important; }
          .bubble-name-container { grid-row: 2 !important; margin: 0 !important; width: 100% !important; }
          .bubble-name { font-weight: 650 !important; font-size: 14px !important; line-height: 1.2 !important; justify-content: center !important; margin: 0 2px !important; color: ${state === 'on' ? 'rgba(25, 25, 25, 0.95)' : 'rgba(70, 70, 70, 0.65)'} !important; }
          .bubble-state { font-size: 13px !important; font-weight: 600 !important; margin-top: 1px !important; justify-content: center !important; color: ${state === 'on' ? 'rgb(255, 149, 0)' : 'rgba(100, 100, 100, 0.5)'} !important; }
          .bubble-attribute { font-size: 13px !important; font-weight: 600 !important; margin-top: 1px !important; justify-content: center !important; color: ${state === 'on' ? 'rgb(255, 149, 0)' : 'rgba(100, 100, 100, 0.5)'} !important; transition: opacity 0.15s ease !important; }
          .bubble-range-slider { position: absolute !important; bottom: 0 !important; left: 0 !important; right: 0 !important; width: 100% !important; height: 4px !important; border-radius: 0 0 14px 14px !important; z-index: 10 !important; background: rgba(0, 0, 0, 0.06) !important; overflow: visible !important; opacity: 1 !important; }
          .bubble-range-fill { height: 4px !important; border-radius: 0 0 14px 0 !important; background: rgb(255, 149, 0) !important; }
          .bubble-range-value { position: absolute !important; top: unset !important; right: unset !important; bottom: 50px !important; left: 50% !important; transform: translateX(-50%) !important; font-size: 14px !important; font-weight: 700 !important; color: rgb(255, 149, 0) !important; background: rgba(255, 255, 255, 0.92) !important; padding: 2px 8px !important; border-radius: 8px !important; box-shadow: 0 1px 6px rgba(0, 0, 0, 0.10) !important; opacity: 0 !important; pointer-events: none !important; transition: opacity 0.15s ease !important; z-index: 30 !important; white-space: nowrap !important; }
          .is-dragging .bubble-range-value { opacity: 1 !important; }
          .is-dragging .bubble-attribute { opacity: 0 !important; }
          .is-dragging .bubble-state { opacity: 0 !important; }
        sub_button:
          main: []
          bottom: []

      # ─────────────────────────────────────────────────────────────────
      # Spot Lights (accent_spots zone)
      # ─────────────────────────────────────────────────────────────────
      - type: custom:bubble-card
        card_type: button
        button_type: slider
        entity: light.living_room_spot_lights
        name: Spots
        icon: mdi:spotlight-beam
        show_state: false
        show_attribute: true
        attribute: brightness
        scrolling_effect: false
        tap_action:
          action: toggle
        hold_action:
          action: more-info
        double_tap_action:
          action: call-service
          service: light.turn_on
          target:
            entity_id: light.living_room_spot_lights
          data:
            brightness_pct: 100
        card_mod:
          style: |
            ha-card {
              background: transparent !important;
              border: none !important;
              box-shadow: none !important;
            }
        styles: |
          .bubble-button-card-container {
            position: relative !important;
            display: grid !important;
            grid-template-rows: auto auto 1fr auto !important;
            justify-items: center !important;
            align-items: center !important;
            text-align: center !important;
            min-height: 100px !important;
            padding: 10px 4px 8px 4px !important;
            border-radius: 14px !important;
            overflow: hidden !important;
            clip-path: inset(0 round 14px) !important;
            transition: transform 0.15s ease-out, border-color 0.3s ease, background 0.3s ease, box-shadow 0.3s ease !important;
            background: ${state === 'on'
              ? 'linear-gradient(180deg, rgba(255, 149, 0, 0.13) 0%, rgba(255, 255, 255, 0.06) 100%)'
              : 'rgba(255, 255, 255, 0.08)'} !important;
            backdrop-filter: ${state === 'on'
              ? 'blur(12px) saturate(140%)'
              : 'blur(8px) saturate(110%)'} !important;
            -webkit-backdrop-filter: ${state === 'on'
              ? 'blur(12px) saturate(140%)'
              : 'blur(8px) saturate(110%)'} !important;
            border: ${state === 'on'
              ? '1px solid rgba(255, 149, 0, 0.40)'
              : '1px solid rgba(160, 160, 165, 0.30)'} !important;
            box-shadow: ${state === 'on'
              ? '0 4px 20px rgba(255, 149, 0, 0.10), inset 0 1px 0 rgba(255, 255, 255, 0.25)'
              : '0 1px 6px rgba(0, 0, 0, 0.04), inset 0 1px 0 rgba(255, 255, 255, 0.15)'} !important;
          }
          .bubble-button-card-container:active { transform: scale(0.95) !important; }
          .bubble-content-container { display: grid !important; grid-template-rows: auto auto 1fr !important; justify-items: center !important; width: 100% !important; position: relative !important; z-index: 5 !important; padding-bottom: 10px !important; }
          .bubble-button-card-container::after { content: '' !important; position: absolute !important; top: 5px !important; right: 5px !important; width: ${(hass.states['switch.adaptive_lighting_accent_spots']?.attributes?.manual_control || []).includes('light.living_room_spot_lights') ? '7px' : '0px'} !important; height: ${(hass.states['switch.adaptive_lighting_accent_spots']?.attributes?.manual_control || []).includes('light.living_room_spot_lights') ? '7px' : '0px'} !important; border-radius: 50% !important; background: ${(hass.states['switch.adaptive_lighting_accent_spots']?.attributes?.manual_control || []).includes('light.living_room_spot_lights') ? 'rgb(255, 110, 90)' : 'transparent'} !important; border: ${(hass.states['switch.adaptive_lighting_accent_spots']?.attributes?.manual_control || []).includes('light.living_room_spot_lights') ? '1.5px solid rgba(255, 255, 255, 0.9)' : 'none'} !important; box-shadow: ${(hass.states['switch.adaptive_lighting_accent_spots']?.attributes?.manual_control || []).includes('light.living_room_spot_lights') ? '0 0 4px rgba(255, 110, 90, 0.5)' : 'none'} !important; transition: all 0.2s ease !important; z-index: 25 !important; }
          .bubble-icon-container { min-width: 42px !important; min-height: 42px !important; grid-row: 1 !important; margin: 2px 0 4px 0 !important; border-radius: 50% !important; display: flex !important; align-items: center !important; justify-content: center !important; background: ${state === 'on' ? 'rgba(255, 149, 0, 0.12)' : 'rgba(150, 150, 155, 0.10)'} !important; border: ${state === 'on' ? '1.5px solid rgba(255, 149, 0, 0.25)' : '1.5px solid rgba(150, 150, 155, 0.18)'} !important; backdrop-filter: blur(4px) !important; -webkit-backdrop-filter: blur(4px) !important; transition: background 0.3s ease, border-color 0.3s ease !important; }
          .bubble-icon { --mdc-icon-size: 24px !important; color: ${state === 'on' ? 'rgb(255, 149, 0)' : 'rgba(80, 80, 80, 0.45)'} !important; filter: ${state === 'on' ? 'drop-shadow(0 0 6px rgba(255, 149, 0, 0.45))' : 'none'} !important; transition: color 0.3s ease, filter 0.3s ease !important; }
          .bubble-name-container { grid-row: 2 !important; margin: 0 !important; width: 100% !important; }
          .bubble-name { font-weight: 650 !important; font-size: 14px !important; line-height: 1.2 !important; justify-content: center !important; margin: 0 2px !important; color: ${state === 'on' ? 'rgba(25, 25, 25, 0.95)' : 'rgba(70, 70, 70, 0.65)'} !important; }
          .bubble-state { font-size: 13px !important; font-weight: 600 !important; margin-top: 1px !important; justify-content: center !important; color: ${state === 'on' ? 'rgb(255, 149, 0)' : 'rgba(100, 100, 100, 0.5)'} !important; }
          .bubble-attribute { font-size: 13px !important; font-weight: 600 !important; margin-top: 1px !important; justify-content: center !important; color: ${state === 'on' ? 'rgb(255, 149, 0)' : 'rgba(100, 100, 100, 0.5)'} !important; transition: opacity 0.15s ease !important; }
          .bubble-range-slider { position: absolute !important; bottom: 0 !important; left: 0 !important; right: 0 !important; width: 100% !important; height: 4px !important; border-radius: 0 0 14px 14px !important; z-index: 10 !important; background: rgba(0, 0, 0, 0.06) !important; overflow: visible !important; opacity: 1 !important; }
          .bubble-range-fill { height: 4px !important; border-radius: 0 0 14px 0 !important; background: rgb(255, 149, 0) !important; }
          .bubble-range-value { position: absolute !important; top: unset !important; right: unset !important; bottom: 50px !important; left: 50% !important; transform: translateX(-50%) !important; font-size: 14px !important; font-weight: 700 !important; color: rgb(255, 149, 0) !important; background: rgba(255, 255, 255, 0.92) !important; padding: 2px 8px !important; border-radius: 8px !important; box-shadow: 0 1px 6px rgba(0, 0, 0, 0.10) !important; opacity: 0 !important; pointer-events: none !important; transition: opacity 0.15s ease !important; z-index: 30 !important; white-space: nowrap !important; }
          .is-dragging .bubble-range-value { opacity: 1 !important; }
          .is-dragging .bubble-attribute { opacity: 0 !important; }
          .is-dragging .bubble-state { opacity: 0 !important; }
        sub_button:
          main: []
          bottom: []

      # ─────────────────────────────────────────────────────────────────
      # Column Lights (column_lights zone)
      # ─────────────────────────────────────────────────────────────────
      - type: custom:bubble-card
        card_type: button
        button_type: slider
        entity: light.column_lights
        name: Columns
        icon: mdi:led-strip-variant
        show_state: false
        show_attribute: true
        attribute: brightness
        scrolling_effect: false
        tap_action:
          action: toggle
        hold_action:
          action: more-info
        double_tap_action:
          action: call-service
          service: light.turn_on
          target:
            entity_id: light.column_lights
          data:
            brightness_pct: 100
        card_mod:
          style: |
            ha-card {
              background: transparent !important;
              border: none !important;
              box-shadow: none !important;
            }
        styles: |
          .bubble-button-card-container {
            position: relative !important;
            display: grid !important;
            grid-template-rows: auto auto 1fr auto !important;
            justify-items: center !important;
            align-items: center !important;
            text-align: center !important;
            min-height: 100px !important;
            padding: 10px 4px 8px 4px !important;
            border-radius: 14px !important;
            overflow: hidden !important;
            clip-path: inset(0 round 14px) !important;
            transition: transform 0.15s ease-out, border-color 0.3s ease, background 0.3s ease, box-shadow 0.3s ease !important;
            background: ${state === 'on'
              ? 'linear-gradient(180deg, rgba(255, 149, 0, 0.13) 0%, rgba(255, 255, 255, 0.06) 100%)'
              : 'rgba(255, 255, 255, 0.08)'} !important;
            backdrop-filter: ${state === 'on'
              ? 'blur(12px) saturate(140%)'
              : 'blur(8px) saturate(110%)'} !important;
            -webkit-backdrop-filter: ${state === 'on'
              ? 'blur(12px) saturate(140%)'
              : 'blur(8px) saturate(110%)'} !important;
            border: ${state === 'on'
              ? '1px solid rgba(255, 149, 0, 0.40)'
              : '1px solid rgba(160, 160, 165, 0.30)'} !important;
            box-shadow: ${state === 'on'
              ? '0 4px 20px rgba(255, 149, 0, 0.10), inset 0 1px 0 rgba(255, 255, 255, 0.25)'
              : '0 1px 6px rgba(0, 0, 0, 0.04), inset 0 1px 0 rgba(255, 255, 255, 0.15)'} !important;
          }
          .bubble-button-card-container:active { transform: scale(0.95) !important; }
          .bubble-content-container { display: grid !important; grid-template-rows: auto auto 1fr !important; justify-items: center !important; width: 100% !important; position: relative !important; z-index: 5 !important; padding-bottom: 10px !important; }
          .bubble-button-card-container::after { content: '' !important; position: absolute !important; top: 5px !important; right: 5px !important; width: ${(hass.states['switch.adaptive_lighting_column_lights']?.attributes?.manual_control || []).length > 0 ? '7px' : '0px'} !important; height: ${(hass.states['switch.adaptive_lighting_column_lights']?.attributes?.manual_control || []).length > 0 ? '7px' : '0px'} !important; border-radius: 50% !important; background: ${(hass.states['switch.adaptive_lighting_column_lights']?.attributes?.manual_control || []).length > 0 ? 'rgb(255, 110, 90)' : 'transparent'} !important; border: ${(hass.states['switch.adaptive_lighting_column_lights']?.attributes?.manual_control || []).length > 0 ? '1.5px solid rgba(255, 255, 255, 0.9)' : 'none'} !important; box-shadow: ${(hass.states['switch.adaptive_lighting_column_lights']?.attributes?.manual_control || []).length > 0 ? '0 0 4px rgba(255, 110, 90, 0.5)' : 'none'} !important; transition: all 0.2s ease !important; z-index: 25 !important; }
          .bubble-icon-container { min-width: 42px !important; min-height: 42px !important; grid-row: 1 !important; margin: 2px 0 4px 0 !important; border-radius: 50% !important; display: flex !important; align-items: center !important; justify-content: center !important; background: ${state === 'on' ? 'rgba(255, 149, 0, 0.12)' : 'rgba(150, 150, 155, 0.10)'} !important; border: ${state === 'on' ? '1.5px solid rgba(255, 149, 0, 0.25)' : '1.5px solid rgba(150, 150, 155, 0.18)'} !important; backdrop-filter: blur(4px) !important; -webkit-backdrop-filter: blur(4px) !important; transition: background 0.3s ease, border-color 0.3s ease !important; }
          .bubble-icon { --mdc-icon-size: 24px !important; color: ${state === 'on' ? 'rgb(255, 149, 0)' : 'rgba(80, 80, 80, 0.45)'} !important; filter: ${state === 'on' ? 'drop-shadow(0 0 6px rgba(255, 149, 0, 0.45))' : 'none'} !important; transition: color 0.3s ease, filter 0.3s ease !important; }
          .bubble-name-container { grid-row: 2 !important; margin: 0 !important; width: 100% !important; }
          .bubble-name { font-weight: 650 !important; font-size: 14px !important; line-height: 1.2 !important; justify-content: center !important; margin: 0 2px !important; color: ${state === 'on' ? 'rgba(25, 25, 25, 0.95)' : 'rgba(70, 70, 70, 0.65)'} !important; }
          .bubble-state { font-size: 13px !important; font-weight: 600 !important; margin-top: 1px !important; justify-content: center !important; color: ${state === 'on' ? 'rgb(255, 149, 0)' : 'rgba(100, 100, 100, 0.5)'} !important; }
          .bubble-attribute { font-size: 13px !important; font-weight: 600 !important; margin-top: 1px !important; justify-content: center !important; color: ${state === 'on' ? 'rgb(255, 149, 0)' : 'rgba(100, 100, 100, 0.5)'} !important; transition: opacity 0.15s ease !important; }
          .bubble-range-slider { position: absolute !important; bottom: 0 !important; left: 0 !important; right: 0 !important; width: 100% !important; height: 4px !important; border-radius: 0 0 14px 14px !important; z-index: 10 !important; background: rgba(0, 0, 0, 0.06) !important; overflow: visible !important; opacity: 1 !important; }
          .bubble-range-fill { height: 4px !important; border-radius: 0 0 14px 0 !important; background: rgb(255, 149, 0) !important; }
          .bubble-range-value { position: absolute !important; top: unset !important; right: unset !important; bottom: 50px !important; left: 50% !important; transform: translateX(-50%) !important; font-size: 14px !important; font-weight: 700 !important; color: rgb(255, 149, 0) !important; background: rgba(255, 255, 255, 0.92) !important; padding: 2px 8px !important; border-radius: 8px !important; box-shadow: 0 1px 6px rgba(0, 0, 0, 0.10) !important; opacity: 0 !important; pointer-events: none !important; transition: opacity 0.15s ease !important; z-index: 30 !important; white-space: nowrap !important; }
          .is-dragging .bubble-range-value { opacity: 1 !important; }
          .is-dragging .bubble-attribute { opacity: 0 !important; }
          .is-dragging .bubble-state { opacity: 0 !important; }
        sub_button:
          main: []
          bottom: []

      # ─────────────────────────────────────────────────────────────────
      # Recessed / Hallway Lights (recessed_ceiling zone)
      # ─────────────────────────────────────────────────────────────────
      - type: custom:bubble-card
        card_type: button
        button_type: slider
        entity: light.living_room_hallway_lights
        name: Recessed
        icon: mdi:light-recessed
        show_state: false
        show_attribute: true
        attribute: brightness
        scrolling_effect: false
        tap_action:
          action: toggle
        hold_action:
          action: more-info
        double_tap_action:
          action: call-service
          service: light.turn_on
          target:
            entity_id: light.living_room_hallway_lights
          data:
            brightness_pct: 100
        card_mod:
          style: |
            ha-card {
              background: transparent !important;
              border: none !important;
              box-shadow: none !important;
            }
        styles: |
          .bubble-button-card-container {
            position: relative !important;
            display: grid !important;
            grid-template-rows: auto auto 1fr auto !important;
            justify-items: center !important;
            align-items: center !important;
            text-align: center !important;
            min-height: 100px !important;
            padding: 10px 4px 8px 4px !important;
            border-radius: 14px !important;
            overflow: hidden !important;
            clip-path: inset(0 round 14px) !important;
            transition: transform 0.15s ease-out, border-color 0.3s ease, background 0.3s ease, box-shadow 0.3s ease !important;
            background: ${state === 'on'
              ? 'linear-gradient(180deg, rgba(255, 149, 0, 0.13) 0%, rgba(255, 255, 255, 0.06) 100%)'
              : 'rgba(255, 255, 255, 0.08)'} !important;
            backdrop-filter: ${state === 'on'
              ? 'blur(12px) saturate(140%)'
              : 'blur(8px) saturate(110%)'} !important;
            -webkit-backdrop-filter: ${state === 'on'
              ? 'blur(12px) saturate(140%)'
              : 'blur(8px) saturate(110%)'} !important;
            border: ${state === 'on'
              ? '1px solid rgba(255, 149, 0, 0.40)'
              : '1px solid rgba(160, 160, 165, 0.30)'} !important;
            box-shadow: ${state === 'on'
              ? '0 4px 20px rgba(255, 149, 0, 0.10), inset 0 1px 0 rgba(255, 255, 255, 0.25)'
              : '0 1px 6px rgba(0, 0, 0, 0.04), inset 0 1px 0 rgba(255, 255, 255, 0.15)'} !important;
          }
          .bubble-button-card-container:active { transform: scale(0.95) !important; }
          .bubble-content-container { display: grid !important; grid-template-rows: auto auto 1fr !important; justify-items: center !important; width: 100% !important; position: relative !important; z-index: 5 !important; padding-bottom: 10px !important; }
          .bubble-button-card-container::after { content: '' !important; position: absolute !important; top: 5px !important; right: 5px !important; width: ${(hass.states['switch.adaptive_lighting_recessed_ceiling']?.attributes?.manual_control || []).includes('light.living_room_hallway_lights') ? '7px' : '0px'} !important; height: ${(hass.states['switch.adaptive_lighting_recessed_ceiling']?.attributes?.manual_control || []).includes('light.living_room_hallway_lights') ? '7px' : '0px'} !important; border-radius: 50% !important; background: ${(hass.states['switch.adaptive_lighting_recessed_ceiling']?.attributes?.manual_control || []).includes('light.living_room_hallway_lights') ? 'rgb(255, 110, 90)' : 'transparent'} !important; border: ${(hass.states['switch.adaptive_lighting_recessed_ceiling']?.attributes?.manual_control || []).includes('light.living_room_hallway_lights') ? '1.5px solid rgba(255, 255, 255, 0.9)' : 'none'} !important; box-shadow: ${(hass.states['switch.adaptive_lighting_recessed_ceiling']?.attributes?.manual_control || []).includes('light.living_room_hallway_lights') ? '0 0 4px rgba(255, 110, 90, 0.5)' : 'none'} !important; transition: all 0.2s ease !important; z-index: 25 !important; }
          .bubble-icon-container { min-width: 42px !important; min-height: 42px !important; grid-row: 1 !important; margin: 2px 0 4px 0 !important; border-radius: 50% !important; display: flex !important; align-items: center !important; justify-content: center !important; background: ${state === 'on' ? 'rgba(255, 149, 0, 0.12)' : 'rgba(150, 150, 155, 0.10)'} !important; border: ${state === 'on' ? '1.5px solid rgba(255, 149, 0, 0.25)' : '1.5px solid rgba(150, 150, 155, 0.18)'} !important; backdrop-filter: blur(4px) !important; -webkit-backdrop-filter: blur(4px) !important; transition: background 0.3s ease, border-color 0.3s ease !important; }
          .bubble-icon { --mdc-icon-size: 24px !important; color: ${state === 'on' ? 'rgb(255, 149, 0)' : 'rgba(80, 80, 80, 0.45)'} !important; filter: ${state === 'on' ? 'drop-shadow(0 0 6px rgba(255, 149, 0, 0.45))' : 'none'} !important; transition: color 0.3s ease, filter 0.3s ease !important; }
          .bubble-name-container { grid-row: 2 !important; margin: 0 !important; width: 100% !important; }
          .bubble-name { font-weight: 650 !important; font-size: 14px !important; line-height: 1.2 !important; justify-content: center !important; margin: 0 2px !important; color: ${state === 'on' ? 'rgba(25, 25, 25, 0.95)' : 'rgba(70, 70, 70, 0.65)'} !important; }
          .bubble-state { font-size: 13px !important; font-weight: 600 !important; margin-top: 1px !important; justify-content: center !important; color: ${state === 'on' ? 'rgb(255, 149, 0)' : 'rgba(100, 100, 100, 0.5)'} !important; }
          .bubble-attribute { font-size: 13px !important; font-weight: 600 !important; margin-top: 1px !important; justify-content: center !important; color: ${state === 'on' ? 'rgb(255, 149, 0)' : 'rgba(100, 100, 100, 0.5)'} !important; transition: opacity 0.15s ease !important; }
          .bubble-range-slider { position: absolute !important; bottom: 0 !important; left: 0 !important; right: 0 !important; width: 100% !important; height: 4px !important; border-radius: 0 0 14px 14px !important; z-index: 10 !important; background: rgba(0, 0, 0, 0.06) !important; overflow: visible !important; opacity: 1 !important; }
          .bubble-range-fill { height: 4px !important; border-radius: 0 0 14px 0 !important; background: rgb(255, 149, 0) !important; }
          .bubble-range-value { position: absolute !important; top: unset !important; right: unset !important; bottom: 50px !important; left: 50% !important; transform: translateX(-50%) !important; font-size: 14px !important; font-weight: 700 !important; color: rgb(255, 149, 0) !important; background: rgba(255, 255, 255, 0.92) !important; padding: 2px 8px !important; border-radius: 8px !important; box-shadow: 0 1px 6px rgba(0, 0, 0, 0.10) !important; opacity: 0 !important; pointer-events: none !important; transition: opacity 0.15s ease !important; z-index: 30 !important; white-space: nowrap !important; }
          .is-dragging .bubble-range-value { opacity: 1 !important; }
          .is-dragging .bubble-attribute { opacity: 0 !important; }
          .is-dragging .bubble-state { opacity: 0 !important; }
        sub_button:
          main: []
          bottom: []

  # ═══════════════════════════════════════════════════════════════════════
  # MEDIA GRID - Sonos, Apple TV, Samsung (3 columns, compact)
  # ═══════════════════════════════════════════════════════════════════════
  - type: custom:layout-card
    layout_type: custom:grid-layout
    layout:
      grid-template-columns: repeat(3, 1fr)
      gap: 8px
      padding: 2px 12px 4px 12px
      mediaquery:
        "(max-width: 400px)":
          grid-template-columns: repeat(2, 1fr)
    cards:
      # ─────────────────────────────────────────────────────────────────
      # Sonos Speaker - Frosted Glass (blue accent, slider for volume)
      # ─────────────────────────────────────────────────────────────────
      - type: custom:bubble-card
        card_type: button
        button_type: slider
        entity: media_player.living_room
        name: Sonos
        icon: mdi:speaker
        show_state: false
        show_attribute: true
        attribute: volume_level
        scrolling_effect: false
        tap_action:
          action: perform-action
          perform_action: media_player.media_play_pause
          target:
            entity_id: media_player.living_room
        hold_action:
          action: more-info
        double_tap_action:
          action: call-service
          service: script.sonos_toggle_group_membership
          data:
            target_speaker: media_player.living_room
        card_mod:
          style: |
            ha-card {
              background: transparent !important;
              border: none !important;
              box-shadow: none !important;
            }
        styles: |-
          ${(() => {
            const inGroup = hass.states['binary_sensor.sonos_living_room_in_playing_group']?.state === 'on';
            return `
              .bubble-button-card-container {
                position: relative !important;
                display: grid !important;
                grid-template-rows: auto auto 1fr auto !important;
                justify-items: center !important;
                align-items: center !important;
                text-align: center !important;
                min-height: 100px !important;
                padding: 10px 4px 8px 4px !important;
                border-radius: 14px !important;
                overflow: hidden !important;
                clip-path: inset(0 round 14px) !important;
                transition: transform 0.15s ease-out, border-color 0.3s ease, background 0.3s ease, box-shadow 0.3s ease !important;
                background: ${inGroup
                  ? 'linear-gradient(180deg, rgba(66, 133, 244, 0.13) 0%, rgba(255, 255, 255, 0.06) 100%)'
                  : 'rgba(255, 255, 255, 0.08)'} !important;
                backdrop-filter: ${inGroup
                  ? 'blur(12px) saturate(140%)'
                  : 'blur(8px) saturate(110%)'} !important;
                -webkit-backdrop-filter: ${inGroup
                  ? 'blur(12px) saturate(140%)'
                  : 'blur(8px) saturate(110%)'} !important;
                border: ${inGroup
                  ? '1px solid rgba(66, 133, 244, 0.40)'
                  : '1px solid rgba(160, 160, 165, 0.30)'} !important;
                box-shadow: ${inGroup
                  ? '0 4px 20px rgba(66, 133, 244, 0.10), inset 0 1px 0 rgba(255, 255, 255, 0.25)'
                  : '0 1px 6px rgba(0, 0, 0, 0.04), inset 0 1px 0 rgba(255, 255, 255, 0.15)'} !important;
              }
              .bubble-button-card-container:active { transform: scale(0.95) !important; }
              .bubble-button-card-container::after { content: '' !important; position: absolute !important; top: 5px !important; right: 5px !important; width: ${inGroup ? '7px' : '0px'} !important; height: ${inGroup ? '7px' : '0px'} !important; border-radius: 50% !important; background: ${inGroup ? 'rgb(66, 133, 244)' : 'transparent'} !important; border: ${inGroup ? '1.5px solid rgba(255, 255, 255, 0.9)' : 'none'} !important; box-shadow: ${inGroup ? '0 0 4px rgba(66, 133, 244, 0.5)' : 'none'} !important; transition: all 0.2s ease !important; z-index: 25 !important; }
              .bubble-content-container { display: grid !important; grid-template-rows: auto auto 1fr !important; justify-items: center !important; width: 100% !important; position: relative !important; z-index: 5 !important; padding-bottom: 10px !important; }
              .bubble-icon-container { min-width: 42px !important; min-height: 42px !important; grid-row: 1 !important; margin: 2px 0 4px 0 !important; border-radius: 50% !important; display: flex !important; align-items: center !important; justify-content: center !important; background: ${inGroup ? 'rgba(66, 133, 244, 0.12)' : 'rgba(150, 150, 155, 0.10)'} !important; border: ${inGroup ? '1.5px solid rgba(66, 133, 244, 0.25)' : '1.5px solid rgba(150, 150, 155, 0.18)'} !important; backdrop-filter: blur(4px) !important; -webkit-backdrop-filter: blur(4px) !important; transition: background 0.3s ease, border-color 0.3s ease !important; }
              .bubble-icon { --mdc-icon-size: 24px !important; color: ${inGroup ? 'rgb(66, 133, 244)' : 'rgba(80, 80, 80, 0.45)'} !important; filter: ${inGroup ? 'drop-shadow(0 0 6px rgba(66, 133, 244, 0.45))' : 'none'} !important; transition: color 0.3s ease, filter 0.3s ease !important; }
              .bubble-name-container { grid-row: 2 !important; margin: 0 !important; width: 100% !important; }
              .bubble-name { font-weight: 650 !important; font-size: 14px !important; line-height: 1.2 !important; justify-content: center !important; color: ${inGroup ? 'rgba(25, 25, 25, 0.95)' : 'rgba(70, 70, 70, 0.65)'} !important; }
              .bubble-state { font-size: 13px !important; font-weight: 600 !important; margin-top: 1px !important; justify-content: center !important; color: ${inGroup ? 'rgb(66, 133, 244)' : 'rgba(100, 100, 100, 0.5)'} !important; }
              .bubble-attribute { font-size: 13px !important; font-weight: 600 !important; margin-top: 1px !important; justify-content: center !important; color: ${inGroup ? 'rgb(66, 133, 244)' : 'rgba(100, 100, 100, 0.5)'} !important; transition: opacity 0.15s ease !important; }
              .bubble-range-slider { position: absolute !important; bottom: 0 !important; left: 0 !important; right: 0 !important; width: 100% !important; height: 4px !important; border-radius: 0 0 14px 14px !important; z-index: 10 !important; background: rgba(0, 0, 0, 0.06) !important; overflow: visible !important; opacity: 1 !important; }
              .bubble-range-fill { height: 4px !important; border-radius: 0 0 14px 0 !important; background: rgb(66, 133, 244) !important; }
              .bubble-range-value { position: absolute !important; top: unset !important; right: unset !important; bottom: 50px !important; left: 50% !important; transform: translateX(-50%) !important; font-size: 14px !important; font-weight: 700 !important; color: rgb(66, 133, 244) !important; background: rgba(255, 255, 255, 0.92) !important; padding: 2px 8px !important; border-radius: 8px !important; box-shadow: 0 1px 6px rgba(0, 0, 0, 0.10) !important; opacity: 0 !important; pointer-events: none !important; transition: opacity 0.15s ease !important; z-index: 30 !important; white-space: nowrap !important; }
              .is-dragging .bubble-range-value { opacity: 1 !important; }
              .is-dragging .bubble-attribute { opacity: 0 !important; }
              .is-dragging .bubble-state { opacity: 0 !important; }
            `;
          })()}
        sub_button:
          main: []
          bottom: []

      # ─────────────────────────────────────────────────────────────────
      # Apple TV - Frosted Glass (blue accent, state button)
      # ─────────────────────────────────────────────────────────────────
      - type: custom:bubble-card
        card_type: button
        button_type: state
        entity: media_player.living_room_apple_tv
        name: Apple TV
        icon: mdi:apple
        show_state: false
        tap_action:
          action: perform-action
          perform_action: media_player.media_play_pause
          target:
            entity_id: media_player.living_room_apple_tv
        hold_action:
          action: more-info
        card_mod:
          style: |
            ha-card {
              background: transparent !important;
              border: none !important;
              box-shadow: none !important;
            }
        styles: |-
          ${(() => {
            const isPlaying = hass.states['media_player.living_room_apple_tv']?.state === 'playing';
            return `
              .bubble-button-card-container {
                position: relative !important;
                display: grid !important;
                grid-template-rows: auto auto 1fr auto !important;
                justify-items: center !important;
                align-items: center !important;
                text-align: center !important;
                min-height: 100px !important;
                padding: 10px 4px 8px 4px !important;
                border-radius: 14px !important;
                overflow: hidden !important;
                clip-path: inset(0 round 14px) !important;
                transition: transform 0.15s ease-out, border-color 0.3s ease, background 0.3s ease, box-shadow 0.3s ease !important;
                background: ${isPlaying
                  ? 'linear-gradient(180deg, rgba(66, 133, 244, 0.13) 0%, rgba(255, 255, 255, 0.06) 100%)'
                  : 'rgba(255, 255, 255, 0.08)'} !important;
                backdrop-filter: ${isPlaying
                  ? 'blur(12px) saturate(140%)'
                  : 'blur(8px) saturate(110%)'} !important;
                -webkit-backdrop-filter: ${isPlaying
                  ? 'blur(12px) saturate(140%)'
                  : 'blur(8px) saturate(110%)'} !important;
                border: ${isPlaying
                  ? '1px solid rgba(66, 133, 244, 0.40)'
                  : '1px solid rgba(160, 160, 165, 0.30)'} !important;
                box-shadow: ${isPlaying
                  ? '0 4px 20px rgba(66, 133, 244, 0.10), inset 0 1px 0 rgba(255, 255, 255, 0.25)'
                  : '0 1px 6px rgba(0, 0, 0, 0.04), inset 0 1px 0 rgba(255, 255, 255, 0.15)'} !important;
              }
              .bubble-button-card-container:active { transform: scale(0.95) !important; }
              .bubble-content-container { display: grid !important; grid-template-rows: auto auto 1fr !important; justify-items: center !important; width: 100% !important; position: relative !important; z-index: 5 !important; padding-bottom: 10px !important; }
              .bubble-icon-container { min-width: 42px !important; min-height: 42px !important; grid-row: 1 !important; margin: 2px 0 4px 0 !important; border-radius: 50% !important; display: flex !important; align-items: center !important; justify-content: center !important; background: ${isPlaying ? 'rgba(66, 133, 244, 0.12)' : 'rgba(150, 150, 155, 0.10)'} !important; border: ${isPlaying ? '1.5px solid rgba(66, 133, 244, 0.25)' : '1.5px solid rgba(150, 150, 155, 0.18)'} !important; backdrop-filter: blur(4px) !important; -webkit-backdrop-filter: blur(4px) !important; transition: background 0.3s ease, border-color 0.3s ease !important; }
              .bubble-icon { --mdc-icon-size: 24px !important; color: ${isPlaying ? 'rgb(66, 133, 244)' : 'rgba(80, 80, 80, 0.45)'} !important; filter: ${isPlaying ? 'drop-shadow(0 0 6px rgba(66, 133, 244, 0.45))' : 'none'} !important; transition: color 0.3s ease, filter 0.3s ease !important; }
              .bubble-name-container { grid-row: 2 !important; margin: 0 !important; width: 100% !important; }
              .bubble-name { font-weight: 650 !important; font-size: 14px !important; line-height: 1.2 !important; justify-content: center !important; color: ${isPlaying ? 'rgba(25, 25, 25, 0.95)' : 'rgba(70, 70, 70, 0.65)'} !important; }
            `;
          })()}

      # ─────────────────────────────────────────────────────────────────
      # Samsung TV - Frosted Glass (blue accent, state button)
      # ─────────────────────────────────────────────────────────────────
      - type: custom:bubble-card
        card_type: button
        button_type: state
        entity: media_player.living_room_samsung_q60
        name: Samsung
        icon: mdi:television
        show_state: false
        tap_action:
          action: toggle
        hold_action:
          action: more-info
        card_mod:
          style: |
            ha-card {
              background: transparent !important;
              border: none !important;
              box-shadow: none !important;
            }
        styles: |-
          ${(() => {
            const isOn = hass.states['media_player.living_room_samsung_q60']?.state === 'on';
            return `
              .bubble-button-card-container {
                position: relative !important;
                display: grid !important;
                grid-template-rows: auto auto 1fr auto !important;
                justify-items: center !important;
                align-items: center !important;
                text-align: center !important;
                min-height: 100px !important;
                padding: 10px 4px 8px 4px !important;
                border-radius: 14px !important;
                overflow: hidden !important;
                clip-path: inset(0 round 14px) !important;
                transition: transform 0.15s ease-out, border-color 0.3s ease, background 0.3s ease, box-shadow 0.3s ease !important;
                background: ${isOn
                  ? 'linear-gradient(180deg, rgba(66, 133, 244, 0.13) 0%, rgba(255, 255, 255, 0.06) 100%)'
                  : 'rgba(255, 255, 255, 0.08)'} !important;
                backdrop-filter: ${isOn
                  ? 'blur(12px) saturate(140%)'
                  : 'blur(8px) saturate(110%)'} !important;
                -webkit-backdrop-filter: ${isOn
                  ? 'blur(12px) saturate(140%)'
                  : 'blur(8px) saturate(110%)'} !important;
                border: ${isOn
                  ? '1px solid rgba(66, 133, 244, 0.40)'
                  : '1px solid rgba(160, 160, 165, 0.30)'} !important;
                box-shadow: ${isOn
                  ? '0 4px 20px rgba(66, 133, 244, 0.10), inset 0 1px 0 rgba(255, 255, 255, 0.25)'
                  : '0 1px 6px rgba(0, 0, 0, 0.04), inset 0 1px 0 rgba(255, 255, 255, 0.15)'} !important;
              }
              .bubble-button-card-container:active { transform: scale(0.95) !important; }
              .bubble-content-container { display: grid !important; grid-template-rows: auto auto 1fr !important; justify-items: center !important; width: 100% !important; position: relative !important; z-index: 5 !important; padding-bottom: 10px !important; }
              .bubble-icon-container { min-width: 42px !important; min-height: 42px !important; grid-row: 1 !important; margin: 2px 0 4px 0 !important; border-radius: 50% !important; display: flex !important; align-items: center !important; justify-content: center !important; background: ${isOn ? 'rgba(66, 133, 244, 0.12)' : 'rgba(150, 150, 155, 0.10)'} !important; border: ${isOn ? '1.5px solid rgba(66, 133, 244, 0.25)' : '1.5px solid rgba(150, 150, 155, 0.18)'} !important; backdrop-filter: blur(4px) !important; -webkit-backdrop-filter: blur(4px) !important; transition: background 0.3s ease, border-color 0.3s ease !important; }
              .bubble-icon { --mdc-icon-size: 24px !important; color: ${isOn ? 'rgb(66, 133, 244)' : 'rgba(80, 80, 80, 0.45)'} !important; filter: ${isOn ? 'drop-shadow(0 0 6px rgba(66, 133, 244, 0.45))' : 'none'} !important; transition: color 0.3s ease, filter 0.3s ease !important; }
              .bubble-name-container { grid-row: 2 !important; margin: 0 !important; width: 100% !important; }
              .bubble-name { font-weight: 650 !important; font-size: 14px !important; line-height: 1.2 !important; justify-content: center !important; color: ${isOn ? 'rgba(25, 25, 25, 0.95)' : 'rgba(70, 70, 70, 0.65)'} !important; }
            `;
          })()}

# ═══════════════════════════════════════════════════════════════════════
# OUTER CARD CONTAINER - Clean gray card background
# ═══════════════════════════════════════════════════════════════════════
card_mod:
  style: |
    :host {
      display: block !important;
      background: rgba(248, 248, 250, 0.98) !important;
      border-radius: 22px !important;
      padding: 4px 0 6px 0 !important;
      margin-bottom: 12px !important;
      box-shadow: 0 2px 16px rgba(0, 0, 0, 0.06) !important;
      border: 1px solid rgba(0, 0, 0, 0.04) !important;
      overflow: hidden !important;
    }
    /* Collapse vertical-stack gaps between child cards */
    #root {
      gap: 0 !important;
    }
    #root > * {
      margin-top: 0 !important;
      margin-bottom: 0 !important;
    }
