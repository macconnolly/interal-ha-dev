# Climate Control Card
# ═══════════════════════════════════════════════════════════════════════
# HVAC control with heating/cooling state indicators
# Styled to match split-hero-v2.yaml and example_room_card.yaml
# Colors: Heating = warm orange, Cooling = blue, Auto = green, Idle = gray
# Shows: Current temp, target range (low-high), humidity, HVAC action
# ═══════════════════════════════════════════════════════════════════════

type: custom:bubble-card
card_type: button
button_type: state
entity: climate.dining_room
name: Climate
icon: mdi:thermostat
show_state: false
show_attribute: true
attribute: current_temperature
scrolling_effect: false
tap_action:
  action: more-info
hold_action:
  action: more-info
double_tap_action:
  action: more-info
sub_button:
  main:
    - name: Controls
      buttons_layout: inline
      group:
        # Cooler (temp down)
        - entity: script.climate_temp_down
          icon: mdi:minus
          show_name: false
          show_icon: true
          show_background: true
          state_background: false
          custom_height: 32
          tap_action:
            action: perform-action
            perform_action: script.turn_on
            target:
              entity_id: script.climate_temp_down
        # Warmer (temp up)
        - entity: script.climate_temp_up
          icon: mdi:plus
          show_name: false
          show_icon: true
          show_background: true
          state_background: false
          custom_height: 32
          tap_action:
            action: perform-action
            perform_action: script.turn_on
            target:
              entity_id: script.climate_temp_up
        # Heat Mode
        - entity: climate.dining_room
          icon: mdi:fire
          show_name: false
          show_icon: true
          show_background: true
          state_background: false
          custom_height: 32
          tap_action:
            action: perform-action
            perform_action: climate.set_hvac_mode
            target:
              entity_id: climate.dining_room
            data:
              hvac_mode: heat
        # Cool Mode
        - entity: climate.dining_room
          icon: mdi:snowflake
          show_name: false
          show_icon: true
          show_background: true
          state_background: false
          custom_height: 32
          tap_action:
            action: perform-action
            perform_action: climate.set_hvac_mode
            target:
              entity_id: climate.dining_room
            data:
              hvac_mode: cool
        # Auto Mode
        - entity: climate.dining_room
          icon: mdi:autorenew
          show_name: false
          show_icon: true
          show_background: true
          state_background: false
          custom_height: 32
          tap_action:
            action: perform-action
            perform_action: climate.set_hvac_mode
            target:
              entity_id: climate.dining_room
            data:
              hvac_mode: heat_cool
        # Power Off
        - entity: climate.dining_room
          icon: mdi:power
          show_name: false
          show_icon: true
          show_background: true
          state_background: false
          custom_height: 32
          tap_action:
            action: perform-action
            perform_action: climate.turn_off
            target:
              entity_id: climate.dining_room
card_mod:
  style: |
    ha-card {
      background: transparent !important;
      border: none !important;
      box-shadow: none !important;
    }
styles: |-
  ${(() => {
    const climate = hass.states['climate.dining_room'];
    const hvacState = climate?.state || 'off';
    const hvacAction = climate?.attributes?.hvac_action || 'idle';
    const currentTemp = climate?.attributes?.current_temperature;
    const targetTemp = climate?.attributes?.temperature;
    const targetLow = climate?.attributes?.target_temp_low;
    const targetHigh = climate?.attributes?.target_temp_high;
    const humidity = climate?.attributes?.current_humidity;
    const hvacMode = hvacState;

    // Determine accent color based on HVAC action (active) or mode (standby)
    let accentColor, accentBg, accentBorder;
    if (hvacAction === 'heating') {
      accentColor = 'rgb(255, 120, 50)';
      accentBg = 'rgba(255, 120, 50, 0.18)';
      accentBorder = 'rgba(255, 120, 50, 0.5)';
    } else if (hvacAction === 'cooling') {
      accentColor = 'rgb(66, 133, 244)';
      accentBg = 'rgba(66, 133, 244, 0.18)';
      accentBorder = 'rgba(66, 133, 244, 0.5)';
    } else if (hvacMode === 'heat') {
      accentColor = 'rgb(255, 149, 100)';
      accentBg = 'rgba(255, 149, 100, 0.12)';
      accentBorder = 'rgba(255, 149, 100, 0.35)';
    } else if (hvacMode === 'cool') {
      accentColor = 'rgb(100, 160, 220)';
      accentBg = 'rgba(100, 160, 220, 0.12)';
      accentBorder = 'rgba(100, 160, 220, 0.35)';
    } else if (hvacMode === 'heat_cool' || hvacMode === 'auto') {
      accentColor = 'rgb(76, 175, 80)';
      accentBg = 'rgba(76, 175, 80, 0.12)';
      accentBorder = 'rgba(76, 175, 80, 0.35)';
    } else {
      accentColor = 'rgba(80, 80, 80, 0.6)';
      accentBg = 'rgba(60, 60, 60, 0.08)';
      accentBorder = 'rgba(120, 120, 120, 0.25)';
    }

    const isActive = hvacAction === 'heating' || hvacAction === 'cooling';
    const isOn = hvacState !== 'off' && hvacState !== 'unavailable';

    // Format target temp label - show range for heat_cool, single for heat/cool
    let targetLabel = '--';
    if (hvacMode === 'heat_cool' || hvacMode === 'auto') {
      if (targetLow && targetHigh) {
        targetLabel = targetLow + '° - ' + targetHigh + '°';
      }
    } else if (targetTemp) {
      targetLabel = targetTemp + '°';
    }

    // Humidity label
    const humidityLabel = humidity ? humidity + '%' : '';

    return `
      .bubble-button-card-container {
        position: relative !important;
        display: flex !important;
        flex-direction: column !important;
        align-items: center !important;
        justify-content: flex-start !important;
        text-align: center !important;
        min-height: 140px !important;
        padding: 12px 12px 8px 12px !important;
        border-radius: 16px !important;
        overflow: visible !important;
        transition: transform 0.1s ease-out, border-color 0.15s ease, background 0.2s ease !important;
        background: ${isOn
          ? 'rgba(255, 255, 255, 0.95)'
          : 'rgba(255, 255, 255, 0.7)'} !important;
        border: ${isOn
          ? '2px solid ' + accentBorder
          : '2px solid rgba(200, 200, 200, 0.4)'} !important;
        box-shadow: ${isActive
          ? '0 4px 16px ' + accentBorder
          : '0 1px 4px rgba(0, 0, 0, 0.05)'} !important;
      }

      .bubble-button-card-container:active { transform: scale(0.97) !important; }

      .bubble-content-container {
        display: flex !important;
        flex-direction: column !important;
        align-items: center !important;
        width: 100% !important;
        position: relative !important;
        z-index: 5 !important;
      }

      /* HVAC Action indicator label (top-right) */
      .bubble-button-card-container::after {
        content: '${isActive ? (hvacAction === 'heating' ? 'HEATING' : 'COOLING') : ''}' !important;
        position: absolute !important;
        top: 6px !important;
        right: 8px !important;
        font-size: 8px !important;
        font-weight: 700 !important;
        letter-spacing: 0.5px !important;
        padding: ${isActive ? '2px 5px' : '0'} !important;
        border-radius: 4px !important;
        background: ${isActive ? accentBg : 'transparent'} !important;
        color: ${accentColor} !important;
        border: ${isActive ? '1px solid ' + accentBorder : 'none'} !important;
        z-index: 25 !important;
        ${isActive ? 'animation: pulse 2s ease-in-out infinite !important;' : ''}
      }

      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.6; }
      }

      /* Target temp range label (top-left) */
      .bubble-button-card-container::before {
        content: '${targetLabel}' !important;
        position: absolute !important;
        top: 6px !important;
        left: 8px !important;
        font-size: 10px !important;
        font-weight: 600 !important;
        color: ${isOn ? accentColor : 'rgba(80, 80, 80, 0.5)'} !important;
        z-index: 25 !important;
      }

      .bubble-icon-container {
        position: relative !important;
        min-width: 52px !important;
        min-height: 52px !important;
        margin: 16px 0 4px 0 !important;
        border-radius: 50% !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        background: ${isOn ? accentBg : 'rgba(180, 180, 180, 0.2)'} !important;
        border: ${isOn
          ? '2px solid ' + accentBorder
          : '2px solid rgba(180, 180, 180, 0.3)'} !important;
        transition: all 0.3s ease !important;
        overflow: visible !important;
      }

      /* Humidity badge - positioned inside icon area */
      .bubble-icon-container::after {
        content: '${humidityLabel}' !important;
        position: absolute !important;
        bottom: -6px !important;
        left: 50% !important;
        transform: translateX(-50%) !important;
        font-size: 8px !important;
        font-weight: 600 !important;
        padding: 1px 5px !important;
        border-radius: 6px !important;
        background: rgba(100, 160, 220, 0.2) !important;
        color: rgb(60, 110, 160) !important;
        border: 1px solid rgba(100, 160, 220, 0.35) !important;
        white-space: nowrap !important;
        ${humidity ? '' : 'display: none !important;'}
      }

      .bubble-icon {
        --mdc-icon-size: 28px !important;
        color: ${isOn ? accentColor : 'rgba(80, 80, 80, 0.6)'} !important;
        filter: ${isActive ? 'drop-shadow(0 0 6px ' + accentColor.replace('rgb', 'rgba').replace(')', ', 0.5)') + ')' : 'none'} !important;
      }

      .bubble-name-container {
        margin: 8px 0 0 0 !important;
        width: 100% !important;
      }

      .bubble-name {
        font-weight: 700 !important;
        font-size: 13px !important;
        line-height: 1.2 !important;
        justify-content: center !important;
        color: ${isOn
          ? 'rgba(30, 30, 30, 0.95)'
          : 'rgba(60, 60, 60, 0.7)'} !important;
      }

      .bubble-attribute {
        font-size: 20px !important;
        font-weight: 700 !important;
        margin-top: 0 !important;
        justify-content: center !important;
        color: ${isOn ? accentColor : 'rgba(100, 100, 100, 0.6)'} !important;
      }

      /* Sub-buttons container */
      .bubble-sub-button-container {
        background: ${accentBg} !important;
        backdrop-filter: blur(4px) !important;
        -webkit-backdrop-filter: blur(4px) !important;
        border-radius: 10px !important;
        border: 1px solid ${accentBorder} !important;
        padding: 3px 5px !important;
        margin-top: 6px !important;
        justify-content: center !important;
        gap: 3px !important;
        flex-wrap: wrap !important;
      }

      /* Base sub-button style */
      .bubble-sub-button-1,
      .bubble-sub-button-2,
      .bubble-sub-button-3,
      .bubble-sub-button-4,
      .bubble-sub-button-5,
      .bubble-sub-button-6 {
        background: rgba(255, 255, 255, 0.5) !important;
        border: 1px solid rgba(120, 120, 120, 0.2) !important;
        border-radius: 6px !important;
        min-width: 28px !important;
        min-height: 28px !important;
        transition: all 0.15s ease !important;
      }

      .bubble-sub-button-1:active,
      .bubble-sub-button-2:active,
      .bubble-sub-button-3:active,
      .bubble-sub-button-4:active,
      .bubble-sub-button-5:active,
      .bubble-sub-button-6:active {
        transform: scale(0.9) !important;
      }

      /* Temp down button */
      .bubble-sub-button-1 {
        background: rgba(100, 160, 220, 0.15) !important;
        border: 1px solid rgba(100, 160, 220, 0.35) !important;
      }
      .bubble-sub-button-1 .bubble-sub-button-icon {
        color: rgb(70, 130, 190) !important;
        --mdc-icon-size: 16px !important;
      }

      /* Temp up button */
      .bubble-sub-button-2 {
        background: rgba(255, 140, 80, 0.15) !important;
        border: 1px solid rgba(255, 140, 80, 0.35) !important;
      }
      .bubble-sub-button-2 .bubble-sub-button-icon {
        color: rgb(230, 110, 50) !important;
        --mdc-icon-size: 16px !important;
      }

      /* Heat button - highlight if heat mode */
      .bubble-sub-button-3 {
        background: ${hvacMode === 'heat' || hvacAction === 'heating' ? 'rgba(255, 120, 50, 0.25)' : 'rgba(255, 255, 255, 0.5)'} !important;
        border: ${hvacMode === 'heat' || hvacAction === 'heating' ? '1px solid rgba(255, 120, 50, 0.6)' : '1px solid rgba(120, 120, 120, 0.2)'} !important;
      }
      .bubble-sub-button-3 .bubble-sub-button-icon {
        color: ${hvacMode === 'heat' || hvacAction === 'heating' ? 'rgb(255, 100, 30)' : 'rgba(60, 60, 60, 0.6)'} !important;
        --mdc-icon-size: 16px !important;
      }

      /* Cool button - highlight if cool mode */
      .bubble-sub-button-4 {
        background: ${hvacMode === 'cool' || hvacAction === 'cooling' ? 'rgba(66, 133, 244, 0.25)' : 'rgba(255, 255, 255, 0.5)'} !important;
        border: ${hvacMode === 'cool' || hvacAction === 'cooling' ? '1px solid rgba(66, 133, 244, 0.6)' : '1px solid rgba(120, 120, 120, 0.2)'} !important;
      }
      .bubble-sub-button-4 .bubble-sub-button-icon {
        color: ${hvacMode === 'cool' || hvacAction === 'cooling' ? 'rgb(50, 120, 230)' : 'rgba(60, 60, 60, 0.6)'} !important;
        --mdc-icon-size: 16px !important;
      }

      /* Auto button - highlight if auto/heat_cool mode */
      .bubble-sub-button-5 {
        background: ${(hvacMode === 'heat_cool' || hvacMode === 'auto') ? 'rgba(76, 175, 80, 0.25)' : 'rgba(255, 255, 255, 0.5)'} !important;
        border: ${(hvacMode === 'heat_cool' || hvacMode === 'auto') ? '1px solid rgba(76, 175, 80, 0.6)' : '1px solid rgba(120, 120, 120, 0.2)'} !important;
      }
      .bubble-sub-button-5 .bubble-sub-button-icon {
        color: ${(hvacMode === 'heat_cool' || hvacMode === 'auto') ? 'rgb(60, 160, 65)' : 'rgba(60, 60, 60, 0.6)'} !important;
        --mdc-icon-size: 16px !important;
      }

      /* Power off button - highlight if off */
      .bubble-sub-button-6 {
        background: ${hvacState === 'off' ? 'rgba(120, 120, 120, 0.25)' : 'rgba(255, 255, 255, 0.5)'} !important;
        border: ${hvacState === 'off' ? '1px solid rgba(120, 120, 120, 0.5)' : '1px solid rgba(120, 120, 120, 0.2)'} !important;
      }
      .bubble-sub-button-6 .bubble-sub-button-icon {
        color: ${hvacState === 'off' ? 'rgba(60, 60, 60, 0.9)' : 'rgba(60, 60, 60, 0.6)'} !important;
        --mdc-icon-size: 16px !important;
      }
    `;
  })()}
