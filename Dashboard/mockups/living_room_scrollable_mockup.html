<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Tunet V5 – Integrated Refinement</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-25..200" rel="stylesheet">

  <style>
    :root {
      --bg: #f2f2f7;
      --card-bg: #ffffff;
      --parent-bg: rgba(255, 255, 255, 0.7);
      --text-main: #1c1c1e;
      --text-sub: #8e8e93;
      --amber: #d4850a;
      --amber-light: rgba(212, 133, 10, 0.1);
      --amber-border: rgba(212, 133, 10, 0.22);
      --gray-ghost: rgba(0, 0, 0, 0.035);
      --shadow: 0 4px 12px rgba(0,0,0,0.05), 0 1px 2px rgba(0,0,0,0.08);
      --shadow-active: 0 20px 40px rgba(0,0,0,0.12), 0 8px 16px rgba(0,0,0,0.06);
      --radius-parent: 36px;
      --radius: 24px;
      --radius-inner: 18px;
    }

    html.dark {
      --bg: #0f172a;
      --card-bg: #1e293b;
      --parent-bg: rgba(30, 41, 59, 0.55);
      --text-main: #f8fafc;
      --text-sub: #94a3b8;
      --amber: #fbbf24;
      --amber-light: rgba(251, 191, 36, 0.12);
      --amber-border: rgba(251, 191, 36, 0.25);
      --gray-ghost: rgba(255, 255, 255, 0.04);
      --shadow: 0 4px 15px rgba(0,0,0,0.3);
      --shadow-active: 0 24px 60px rgba(0,0,0,0.6);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { background-color: var(--bg); font-family: 'DM Sans', sans-serif; margin: 0; padding: 24px 16px; color: var(--text-main); }

    .dashboard { width: 100%; max-width: 500px; margin: 0 auto; display: flex; flex-direction: column; gap: 24px; }

    /* ═══════════════════════════════════════════
       CLEAN PARENT CONTAINER
       ═══════════════════════════════════════════ */
    .section-container {
      background: var(--parent-bg);
      backdrop-filter: blur(30px); -webkit-backdrop-filter: blur(30px);
      border-radius: var(--radius-parent);
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 24px 0 8px 0; /* Reduced bottom padding to fix wasted space */
      box-shadow: 0 10px 40px rgba(0,0,0,0.03);
      display: flex; flex-direction: column;
    }

    .section-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 24px; margin-bottom: 12px;
    }

    .header-left { display: flex; align-items: center; gap: 10px; font-weight: 700; font-size: 18px; }
    .header-left .icon { color: var(--amber); font-size: 22px; }

    .header-right { display: flex; align-items: center; gap: 14px; }

    /* Pagination Dots in Header */
    .header-dots { display: flex; gap: 5px; padding: 8px 12px; background: rgba(0,0,0,0.03); border-radius: 99px; }
    .dot { width: 6px; height: 6px; border-radius: 50%; background: var(--text-sub); opacity: 0.25; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
    .dot.active { width: 14px; border-radius: 99px; opacity: 1; background: var(--amber); }

    .all-off-btn {
      font-size: 13px; font-weight: 700; color: var(--amber);
      background: var(--card-bg);
      padding: 8px 16px; border-radius: 99px; cursor: pointer;
      box-shadow: var(--shadow); border: 1px solid rgba(0,0,0,0.05);
      transition: all 0.2s;
    }
    .all-off-btn:active { transform: scale(0.96); opacity: 0.8; }

    /* ═══════════════════════════════════════════
       GRID - Pixel Perfect Left Alignment
       ═══════════════════════════════════════════ */
    .grid {
      display: grid;
      grid-template-rows: repeat(2, 1fr);
      grid-auto-flow: column;
      grid-auto-columns: calc(33.333% - 12px);
      overflow-x: auto; scroll-snap-type: x mandatory;
      gap: 12px; row-gap: 20px;
      padding: 10px 24px 16px 24px; /* Matches header 24px left padding exactly */
      scrollbar-width: none;
      -webkit-overflow-scrolling: touch;
    }
    .grid::-webkit-scrollbar { display: none; }

    /* ═══════════════════════════════════════════
       TILES - Refined Balance
       ═══════════════════════════════════════════ */
    .l-tile {
      scroll-snap-align: start;
      background: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      aspect-ratio: 1 / 1.1; 
      display: flex; flex-direction: column; align-items: center;
      padding-top: 10px; /* Reduced top padding to move icon up slightly */
      position: relative; cursor: pointer;
      user-select: none; touch-action: pan-y;
      border: 1.5px solid transparent;
      transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s, border-color 0.2s, background-color 0.3s;
    }

    .l-tile.off { 
      background: var(--card-bg);
      border-color: rgba(0,0,0,0.02);
      opacity: 0.95;
    }
    .l-tile.on { border-color: transparent; }

    .icon-wrap {
      width: 48px; height: 48px;
      border-radius: var(--radius-inner);
      display: grid; place-items: center;
      margin-bottom: 6px; /* Tightened gap */
      transition: all 0.2s;
    }
    .l-tile.on .icon-wrap { background: var(--amber-light); color: var(--amber); border: 1px solid var(--amber-border); }
    .l-tile.off .icon-wrap { background: var(--gray-ghost); color: var(--text-sub); }

    .name { font-size: 15px; font-weight: 600; margin-bottom: 1px; color: var(--text-main); }
    .val { font-size: 13px; font-weight: 700; color: var(--amber); }
    .off .val { color: var(--text-sub); opacity: 0.5; }

    /* ═══════════════════════════════════════════
       INTERACTION - Floating Pill & Shadows
       ═══════════════════════════════════════════ */
    .l-tile.sliding {
      transform: scale(1.05);
      box-shadow: var(--shadow-active);
      border-color: var(--amber);
      z-index: 100;
    }

    /* Floating Pill - restored */
    .l-tile.sliding .val {
      position: absolute;
      top: -10px; left: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      color: var(--amber);
      padding: 6px 20px;
      border-radius: 99px;
      font-size: 14px;
      font-weight: 800;
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
      white-space: nowrap;
      z-index: 101;
      border: 1px solid rgba(0,0,0,0.02);
    }

    /* Slider Track */
    .progress-track {
      position: absolute; bottom: 12px; left: 16px; right: 16px;
      height: 4px; background: rgba(0,0,0,0.05); border-radius: 99px; overflow: hidden;
    }
    .progress-fill { height: 100%; width: 0%; background: var(--amber); opacity: 0.85; transition: width 0.1s linear; }
    .off .progress-fill { opacity: 0; }

    /* Status dot */
    .manual-dot {
      position: absolute; top: 10px; right: 10px; width: 8px; height: 8px;
      background: #ff453a; border-radius: 50%; display: none;
      box-shadow: 0 0 10px rgba(255, 69, 58, 0.4);
    }
    .l-tile[data-manual="true"] .manual-dot { display: block; }

    @media (max-width: 440px) {
      .grid { grid-auto-columns: calc(48% - 6px); padding: 10px 20px 20px 20px; }
      .section-header { padding: 0 20px; }
      .l-tile { aspect-ratio: 1/1.05; }
    }
  </style>
</head>
<body>

<div class="dashboard">
  <div class="section-container">
    <div class="section-header">
      <div class="header-left">
        <span class="icon filled">lightbulb</span>
        Lighting
      </div>
      <div class="header-right">
        <div class="header-dots">
          <div class="dot active"></div>
          <div class="dot"></div>
          <div class="dot"></div>
        </div>
        <div class="all-off-btn" onclick="allOff()">All Off</div>
      </div>
    </div>

    <div class="grid" id="lightGrid">
      <!-- Generated Tiles -->
    </div>
  </div>
</div>

<script>
  // Fixed icon names for Material Symbols Rounded
  const zones = [
    { name: 'Living', icon: 'floor_lamp', level: 49 },
    { name: 'Kitchen', icon: 'kitchen', level: 4 },
    { name: 'Bedroom', icon: 'bed', level: 83, manual: true },
    { name: 'Spots', icon: 'highlight', level: 100 },
    { name: 'Ceiling', icon: 'ceiling_light', level: 0 },
    { name: 'Columns', icon: 'view_column', level: 93 },
    { name: 'Hallway', icon: 'door_sliding', level: 12 },
    { name: 'Dining', icon: 'restaurant', level: 55 },
    { name: 'Office', icon: 'laptop_mac', level: 0 }
  ];

  const grid = document.getElementById('lightGrid');

  function createTile(zone) {
    const tile = document.createElement('div');
    tile.className = `l-tile ${zone.level > 0 ? 'on' : 'off'}`;
    tile.dataset.brightness = zone.level;
    tile.dataset.name = zone.name;
    if (zone.manual) tile.dataset.manual = "true";

    tile.innerHTML = `
      <div class="manual-dot"></div>
      <div class="icon-wrap"><span class="icon">${zone.icon}</span></div>
      <div class="name">${zone.name}</div>
      <div class="val">${zone.level > 0 ? zone.level + '%' : 'Off'}</div>
      <div class="progress-track"><div class="progress-fill" style="width: ${zone.level}%"></div></div>
    `;

    setupDragging(tile);
    grid.appendChild(tile);
  }

  function setupDragging(tile) {
    let startX = 0, startBrt = 0, isDragging = false;
    
    tile.addEventListener('pointerdown', (e) => {
      startX = e.clientX;
      startBrt = parseInt(tile.dataset.brightness);
      tile.setPointerCapture(e.pointerId);
    });

    tile.addEventListener('pointermove', (e) => {
      if (!e.buttons) return;
      const dx = e.clientX - startX;
      if (!isDragging && Math.abs(dx) > 10) {
        isDragging = true;
        tile.classList.add('sliding');
        grid.style.overflowX = 'hidden';
      }
      if (isDragging) {
        const width = tile.offsetWidth;
        let newBrt = Math.round(Math.max(0, Math.min(100, startBrt + (dx / width) * 100)));
        updateTileUI(tile, newBrt);
      }
    });

    tile.addEventListener('pointerup', (e) => {
      if (!isDragging) {
        const current = parseInt(tile.dataset.brightness);
        updateTileUI(tile, current > 0 ? 0 : 100);
      } else { 
        tile.dataset.manual = "true"; 
      }
      tile.classList.remove('sliding');
      grid.style.overflowX = 'auto'; 
      isDragging = false;
    });
  }

  function updateTileUI(tile, brt) {
    tile.dataset.brightness = brt;
    const fill = tile.querySelector('.progress-fill');
    const val = tile.querySelector('.val');
    fill.style.width = brt + '%';
    val.textContent = brt > 0 ? brt + '%' : 'Off';
    tile.classList.toggle('on', brt > 0);
    tile.classList.toggle('off', brt <= 0);
  }

  function allOff() { 
    document.querySelectorAll('.l-tile').forEach(t => updateTileUI(t, 0)); 
  }

  zones.forEach(createTile);

  // Pagination sync
  grid.addEventListener('scroll', () => {
    const dots = document.querySelectorAll('.dot');
    const scrollPct = grid.scrollLeft / (grid.scrollWidth - grid.clientWidth);
    const index = Math.round(scrollPct * (dots.length - 1));
    dots.forEach((d, i) => d.classList.toggle('active', i === index));
  });
</script>
</body>
</html>