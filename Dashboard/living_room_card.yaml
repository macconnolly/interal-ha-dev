# Living Room Card - Spec V2
# ═══════════════════════════════════════════════════════════════════════
# Generated from living-room-spec.md
# - Two-row header: title separator + control strip
# - 3-column light grid with drag-to-dim tiles, manual control red dots
# - 3-column media grid (Sonos volume slider, Apple TV toggle, Samsung toggle)
# - Full light/dark mode support via hass.themes?.darkMode
# ═══════════════════════════════════════════════════════════════════════

type: vertical-stack
cards:
  # ═══════════════════════════════════════════════════════════════════════
  # HEADER ROW 1 - Title separator (no sub-buttons, never truncates)
  # ═══════════════════════════════════════════════════════════════════════
  - type: custom:bubble-card
    card_type: separator
    entity: light.living_room_lights
    name: Living Room
    icon: mdi:sofa
    styles: |-
      ${(() => {
        const isDark = hass.themes?.darkMode;
        const roomState = hass.states['sensor.room_living_state']?.state || 'idle';
        const lightsOn = parseInt(hass.states['sensor.room_living_state']?.attributes?.lights_on || '0');
        let iconColor, iconBg;
        if (roomState === 'playing') {
          iconColor = 'rgb(66, 133, 244)';
          iconBg = 'rgba(66, 133, 244, 0.18)';
        } else if (roomState === 'active' || lightsOn > 0) {
          iconColor = 'rgb(255, 149, 0)';
          iconBg = 'rgba(255, 149, 0, 0.18)';
        } else {
          iconColor = isDark ? 'rgba(255, 255, 255, 0.35)' : 'rgba(50, 50, 50, 0.55)';
          iconBg = isDark ? 'rgba(255, 255, 255, 0.06)' : 'rgba(80, 80, 80, 0.10)';
        }
        return `
          ha-card {
            background: transparent !important;
            border: none !important;
            box-shadow: none !important;
            margin: 0 !important;
            padding: 8px 14px 0 14px !important;
          }
          .bubble-icon-container {
            min-width: 44px !important;
            min-height: 44px !important;
            border-radius: 50% !important;
            background: ${iconBg} !important;
            border: 1.5px solid ${iconColor}40 !important;
          }
          .bubble-icon {
            --mdc-icon-size: 26px !important;
            color: ${iconColor} !important;
            ${roomState !== 'idle' ? `filter: drop-shadow(0 0 4px ${iconColor}66) !important;` : ''}
          }
          .bubble-name {
            font-size: 20px !important;
            font-weight: 700 !important;
            letter-spacing: -0.3px !important;
            white-space: normal !important;
            overflow: visible !important;
            color: ${isDark ? 'rgba(255, 255, 255, 0.95)' : 'rgba(25, 25, 25, 0.95)'} !important;
          }
        `;
      })()}

  # ═══════════════════════════════════════════════════════════════════════
  # HEADER ROW 2 - Control strip (slider + action buttons)
  # ═══════════════════════════════════════════════════════════════════════
  - type: custom:layout-card
    layout_type: custom:grid-layout
    layout:
      grid-template-columns: 1fr 40px 40px 40px
      gap: 6px
      padding: 2px 14px 6px 14px
      align-items: center
    card_mod:
      style: |
        ha-card {
          background: transparent !important;
          border: none !important;
          box-shadow: none !important;
          margin: 0 !important;
        }
    cards:
      # Column 1: Room brightness slider
      - type: custom:bubble-card
        card_type: button
        button_type: slider
        entity: light.living_room_lights
        name: ""
        icon: mdi:brightness-7
        show_name: false
        show_state: true
        scrolling_effect: false
        tap_action:
          action: toggle
        hold_action:
          action: more-info
        card_mod:
          style: |
            ha-card {
              background: transparent !important;
              border: none !important;
              box-shadow: none !important;
            }
        styles: |-
          ${(() => {
            const isOn = state === 'on';
            const isDark = hass.themes?.darkMode;
            return `
              .bubble-button-card-container {
                min-height: 38px !important;
                max-height: 38px !important;
                border-radius: 12px !important;
                background: ${isDark ? 'rgba(255, 255, 255, 0.06)' : 'rgba(0, 0, 0, 0.04)'} !important;
                border: ${isDark ? '1px solid rgba(255, 255, 255, 0.04)' : '1px solid rgba(0, 0, 0, 0.06)'} !important;
              }
              .bubble-icon {
                --mdc-icon-size: 18px !important;
                color: ${isOn ? 'rgb(255, 149, 0)' : (isDark ? 'rgba(255, 255, 255, 0.30)' : 'rgba(80, 80, 80, 0.40)')} !important;
              }
              .bubble-state {
                font-size: 13px !important;
                font-weight: 600 !important;
                font-variant-numeric: tabular-nums !important;
              }
              .bubble-range-fill {
                background: ${isDark ? 'rgba(255, 149, 0, 0.30)' : 'rgba(255, 149, 0, 0.25)'} !important;
              }
            `;
          })()}

      # Column 2: All lights toggle
      - type: custom:bubble-card
        card_type: button
        button_type: state
        entity: light.living_room_lights
        name: ""
        icon: mdi:lightbulb-group
        show_name: false
        show_state: false
        tap_action:
          action: toggle
        hold_action:
          action: more-info
        card_mod:
          style: |
            ha-card {
              background: transparent !important;
              border: none !important;
              box-shadow: none !important;
            }
        styles: |-
          ${(() => {
            const isOn = state === 'on';
            const isDark = hass.themes?.darkMode;
            return `
              .bubble-button-card-container {
                min-height: 38px !important;
                max-height: 38px !important;
                border-radius: 10px !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                background: ${isOn
                  ? 'rgba(255, 149, 0, 0.14)'
                  : (isDark ? 'rgba(255, 255, 255, 0.06)' : 'rgba(60, 60, 60, 0.07)')} !important;
                border: ${isOn
                  ? '1px solid rgba(255, 149, 0, 0.30)'
                  : (isDark ? '1px solid rgba(255, 255, 255, 0.04)' : '1px solid rgba(60, 60, 60, 0.10)')} !important;
                transition: transform 0.1s ease, background 0.15s ease !important;
              }
              .bubble-button-card-container:active {
                transform: scale(0.90) !important;
              }
              .bubble-icon {
                --mdc-icon-size: 20px !important;
                color: ${isOn ? 'rgb(255, 149, 0)' : (isDark ? 'rgba(255, 255, 255, 0.30)' : 'rgba(60, 60, 60, 0.45)')} !important;
              }
              .bubble-name-container { display: none !important; }
            `;
          })()}

      # Column 3: Alarm chip (conditional)
      - type: conditional
        conditions:
          - entity: sensor.room_living_state
            attribute: has_upcoming_alarm
            state: "true"
        card:
          type: custom:bubble-card
          card_type: button
          button_type: state
          entity: sensor.room_living_state
          name: ""
          icon: mdi:alarm
          show_name: false
          show_state: false
          tap_action:
            action: more-info
          card_mod:
            style: |
              ha-card {
                background: transparent !important;
                border: none !important;
                box-shadow: none !important;
              }
          styles: |-
            ${(() => {
              const isDark = hass.themes?.darkMode;
              return `
                .bubble-button-card-container {
                  min-height: 38px !important;
                  max-height: 38px !important;
                  border-radius: 10px !important;
                  display: flex !important;
                  align-items: center !important;
                  justify-content: center !important;
                  background: ${isDark ? 'rgba(66, 133, 244, 0.18)' : 'rgba(66, 133, 244, 0.14)'} !important;
                  border: 1px solid rgba(66, 133, 244, 0.30) !important;
                  transition: transform 0.1s ease !important;
                }
                .bubble-button-card-container:active {
                  transform: scale(0.90) !important;
                }
                .bubble-icon {
                  --mdc-icon-size: 20px !important;
                  color: rgb(66, 133, 244) !important;
                }
                .bubble-name-container { display: none !important; }
              `;
            })()}

      # Column 4: Settings gear icon
      - type: custom:bubble-card
        card_type: button
        button_type: state
        entity: light.living_room_lights
        name: ""
        icon: mdi:cog
        show_name: false
        show_state: false
        tap_action:
          action: fire-dom-event
          browser_mod:
            service: browser_mod.popup
            data:
              content:
                type: vertical-stack
                cards:
                  # Room brightness slider
                  - type: custom:bubble-card
                    card_type: button
                    button_type: slider
                    entity: light.living_room_lights
                    name: Room Brightness
                    icon: mdi:brightness-7
                    show_state: false
                    show_attribute: true
                    attribute: brightness
                    scrolling_effect: false
                    tap_action:
                      action: toggle
                    hold_action:
                      action: more-info
                  # All On/Off toggle
                  - type: custom:bubble-card
                    card_type: button
                    button_type: state
                    entity: light.living_room_lights
                    name: "Turn All Off"
                    icon: mdi:lightbulb-group
                    show_name: true
                    show_state: false
                    tap_action:
                      action: toggle
                    styles: |-
                      ${(() => {
                        const isOn = state === 'on';
                        const isDark = hass.themes?.darkMode;
                        return `
                          .bubble-button-card-container {
                            height: 48px !important;
                            border-radius: 14px !important;
                            background: ${isOn
                              ? (isDark ? 'rgba(255, 149, 0, 0.10)' : 'rgba(255, 149, 0, 0.06)')
                              : (isDark ? 'rgba(255, 255, 255, 0.06)' : 'rgba(0, 0, 0, 0.04)')} !important;
                            display: flex !important;
                            align-items: center !important;
                            padding: 0 16px !important;
                          }
                          .bubble-icon {
                            --mdc-icon-size: 18px !important;
                            color: ${isOn ? 'rgb(255, 149, 0)' : (isDark ? 'rgba(255, 255, 255, 0.30)' : 'rgba(60, 60, 60, 0.45)')} !important;
                          }
                          .bubble-name {
                            font-size: 14px !important;
                            font-weight: 500 !important;
                            color: var(--primary-text-color) !important;
                          }
                        `;
                      })()}
                  # Reset Manual Overrides (conditional)
                  - type: custom:bubble-card
                    card_type: button
                    button_type: state
                    entity: sensor.room_living_state
                    name: "Reset Manual Overrides"
                    icon: mdi:restore
                    show_name: true
                    show_state: false
                    tap_action:
                      action: call-service
                      service: adaptive_lighting.set_manual_control
                      data:
                        entity_id:
                          - switch.adaptive_lighting_main_living
                          - switch.adaptive_lighting_accent_spots
                          - switch.adaptive_lighting_column_lights
                          - switch.adaptive_lighting_recessed_ceiling
                        manual_control: false
                    styles: |-
                      ${(() => {
                        const isDark = hass.themes?.darkMode;
                        const n = (hass.states['sensor.room_living_state']?.attributes?.manually_controlled_lights || []).length;
                        if (n === 0) return `.bubble-button-card-container { display: none !important; }`;
                        return `
                          .bubble-button-card-container {
                            height: 48px !important;
                            border-radius: 14px !important;
                            background: ${isDark ? 'rgba(255, 59, 48, 0.08)' : 'rgba(255, 59, 48, 0.05)'} !important;
                            display: flex !important;
                            align-items: center !important;
                            padding: 0 16px !important;
                          }
                          .bubble-icon {
                            --mdc-icon-size: 18px !important;
                            color: #ff3b30 !important;
                          }
                          .bubble-name {
                            font-size: 14px !important;
                            font-weight: 500 !important;
                            color: var(--primary-text-color) !important;
                          }
                          .bubble-button-card-container::after {
                            content: '${n}' !important;
                            position: absolute !important;
                            right: 16px !important;
                            min-width: 20px !important;
                            height: 20px !important;
                            border-radius: 10px !important;
                            background: #ff3b30 !important;
                            color: white !important;
                            font-size: 11px !important;
                            font-weight: 700 !important;
                            display: flex !important;
                            align-items: center !important;
                            justify-content: center !important;
                            padding: 0 6px !important;
                          }
                        `;
                      })()}
                  # Brighten / Dim side by side
                  - type: horizontal-stack
                    cards:
                      - type: custom:bubble-card
                        card_type: button
                        button_type: state
                        entity: light.living_room_lights
                        name: "Brighten"
                        icon: mdi:weather-sunny
                        show_name: true
                        show_state: false
                        tap_action:
                          action: call-service
                          service: script.oal_global_manual_brighter
                          data:
                            lights: light.living_room_lights
                        styles: |
                          .bubble-button-card-container {
                            height: 48px !important;
                            border-radius: 14px !important;
                            background: rgba(0, 0, 0, 0.04) !important;
                            display: flex !important;
                            align-items: center !important;
                            justify-content: center !important;
                            padding: 0 12px !important;
                            gap: 8px !important;
                          }
                          .bubble-icon { --mdc-icon-size: 18px !important; color: rgba(120, 80, 180, 0.85) !important; }
                          .bubble-name { font-size: 13px !important; font-weight: 500 !important; }
                      - type: custom:bubble-card
                        card_type: button
                        button_type: state
                        entity: light.living_room_lights
                        name: "Dim"
                        icon: mdi:weather-night
                        show_name: true
                        show_state: false
                        tap_action:
                          action: call-service
                          service: script.oal_global_manual_dimmer
                          data:
                            lights: light.living_room_lights
                        styles: |
                          .bubble-button-card-container {
                            height: 48px !important;
                            border-radius: 14px !important;
                            background: rgba(0, 0, 0, 0.04) !important;
                            display: flex !important;
                            align-items: center !important;
                            justify-content: center !important;
                            padding: 0 12px !important;
                            gap: 8px !important;
                          }
                          .bubble-icon { --mdc-icon-size: 18px !important; color: rgba(120, 80, 180, 0.85) !important; }
                          .bubble-name { font-size: 13px !important; font-weight: 500 !important; }
                  # Movie Mode
                  - type: custom:bubble-card
                    card_type: button
                    button_type: state
                    entity: input_boolean.oal_movie_mode_active
                    name: "Movie Mode"
                    icon: mdi:movie-open
                    show_name: true
                    show_state: false
                    tap_action:
                      action: toggle
                    styles: |-
                      ${(() => {
                        const isActive = state === 'on';
                        const isDark = hass.themes?.darkMode;
                        return `
                          .bubble-button-card-container {
                            height: 48px !important;
                            border-radius: 14px !important;
                            background: ${isActive
                              ? (isDark ? 'rgba(175, 82, 222, 0.12)' : 'rgba(175, 82, 222, 0.06)')
                              : (isDark ? 'rgba(255, 255, 255, 0.06)' : 'rgba(0, 0, 0, 0.04)')} !important;
                            display: flex !important;
                            align-items: center !important;
                            padding: 0 16px !important;
                          }
                          .bubble-icon {
                            --mdc-icon-size: 18px !important;
                            color: ${isActive ? '#af52de' : (isDark ? 'rgba(255, 255, 255, 0.30)' : 'rgba(60, 60, 60, 0.45)')} !important;
                          }
                          .bubble-name {
                            font-size: 14px !important;
                            font-weight: 500 !important;
                            color: var(--primary-text-color) !important;
                          }
                          .bubble-button-card-container::after {
                            content: '${isActive ? 'On' : 'Off'}' !important;
                            position: absolute !important;
                            right: 16px !important;
                            font-size: 13px !important;
                            font-weight: 600 !important;
                            color: ${isActive ? '#af52de' : (isDark ? 'rgba(255, 255, 255, 0.25)' : 'rgba(60, 60, 60, 0.35)')} !important;
                          }
                        `;
                      })()}
              style:
                --popup-border-radius: 24px 24px 0 0
                --popup-padding: 0
              right_button: Close
              dismissable: true
              autoclose: true
        card_mod:
          style: |
            ha-card {
              background: transparent !important;
              border: none !important;
              box-shadow: none !important;
            }
        styles: |-
          ${(() => {
            const isDark = hass.themes?.darkMode;
            return `
              .bubble-button-card-container {
                min-height: 38px !important;
                max-height: 38px !important;
                border-radius: 10px !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                background: ${isDark ? 'rgba(255, 255, 255, 0.06)' : 'rgba(60, 60, 60, 0.07)'} !important;
                border: ${isDark ? '1px solid rgba(255, 255, 255, 0.04)' : '1px solid rgba(60, 60, 60, 0.10)'} !important;
                transition: transform 0.1s ease, background 0.15s ease !important;
              }
              .bubble-button-card-container:active {
                transform: scale(0.90) !important;
              }
              .bubble-icon {
                --mdc-icon-size: 20px !important;
                color: ${isDark ? 'rgba(255, 255, 255, 0.45)' : 'rgba(60, 60, 60, 0.55)'} !important;
              }
              .bubble-name-container { display: none !important; }
            `;
          })()}

  # ═══════════════════════════════════════════════════════════════════════
  # LIGHTS GRID - 6 lights in 3 columns
  # ═══════════════════════════════════════════════════════════════════════
  - type: custom:layout-card
    layout_type: custom:grid-layout
    layout:
      grid-template-columns: repeat(3, 1fr)
      gap: 8px
      padding: 2px 12px 4px 12px
      mediaquery:
        "(max-width: 400px)":
          grid-template-columns: repeat(2, 1fr)
    card_mod:
      style: |
        ha-card {
          background: transparent !important;
          border: none !important;
          box-shadow: none !important;
          margin: 0 !important;
        }
    cards:
      # ─────────────────────────────────────────────────────────────────
      # Floor Lamp (main_living zone)
      # ─────────────────────────────────────────────────────────────────
      - type: custom:bubble-card
        card_type: button
        button_type: slider
        entity: light.living_room_floor_lamp
        name: Floor
        icon: mdi:floor-lamp
        show_state: false
        show_attribute: true
        attribute: brightness
        scrolling_effect: false
        tap_action:
          action: toggle
        hold_action:
          action: more-info
        double_tap_action:
          action: call-service
          service: light.turn_on
          target:
            entity_id: light.living_room_floor_lamp
          data:
            brightness_pct: 100
        card_mod:
          style: |
            ha-card {
              background: transparent !important;
              border: none !important;
              box-shadow: none !important;
            }
        styles: |-
          ${(() => {
            const isOn = state === 'on';
            const isDark = hass.themes?.darkMode;
            const manualLights = hass.states['switch.adaptive_lighting_main_living']?.attributes?.manual_control || [];
            const isManual = Array.isArray(manualLights) && manualLights.includes('light.living_room_floor_lamp');
            const brightness = hass.states['light.living_room_floor_lamp']?.attributes?.brightness || 0;
            const brightnessPct = Math.round((brightness / 255) * 100);
            const brightnessLabel = isOn ? `${brightnessPct}%` : 'Off';
            const surfaceOn = isDark
              ? 'linear-gradient(180deg, rgba(48, 40, 28, 0.95) 0%, rgba(36, 33, 28, 0.93) 100%)'
              : 'linear-gradient(180deg, rgba(255, 149, 0, 0.13) 0%, rgba(255, 255, 255, 0.06) 100%)';
            const surfaceOff = isDark ? 'rgba(32, 32, 34, 0.7)' : 'rgba(255, 255, 255, 0.08)';
            const borderOn = isDark ? '1.5px solid rgba(255, 149, 0, 0.14)' : '1px solid rgba(255, 149, 0, 0.40)';
            const borderOff = isDark ? '1.5px solid rgba(255, 255, 255, 0.04)' : '1px solid rgba(160, 160, 165, 0.30)';
            const nameOn = isDark ? 'rgba(255, 255, 255, 0.92)' : 'rgba(25, 25, 25, 0.95)';
            const nameOff = isDark ? 'rgba(255, 255, 255, 0.45)' : 'rgba(40, 40, 40, 0.85)';
            const attrOn = isDark ? 'rgba(255, 149, 0, 0.85)' : 'rgb(255, 149, 0)';
            const attrOff = isDark ? 'rgba(255, 255, 255, 0.30)' : 'rgba(60, 60, 60, 0.45)';
            const iconBgOn = 'rgba(255, 149, 0, 0.12)';
            const iconBgOff = isDark ? 'rgba(128, 128, 128, 0.06)' : 'rgba(120, 120, 125, 0.12)';
            const iconColorOn = 'rgb(255, 149, 0)';
            const iconColorOff = isDark ? 'rgba(255, 255, 255, 0.40)' : 'rgba(60, 60, 60, 0.55)';
            const sliderTrack = isDark ? 'rgba(255, 255, 255, 0.04)' : 'rgba(0, 0, 0, 0.06)';
            const tooltipBg = isDark ? 'rgba(30, 30, 32, 0.92)' : 'rgba(255, 255, 255, 0.92)';
            const boxShadowOn = isDark
              ? '0 2px 10px rgba(0, 0, 0, 0.3)'
              : '0 4px 20px rgba(255, 149, 0, 0.10), inset 0 1px 0 rgba(255, 255, 255, 0.25)';
            const boxShadowOff = isDark
              ? '0 1px 4px rgba(0, 0, 0, 0.15)'
              : '0 1px 6px rgba(0, 0, 0, 0.04), inset 0 1px 0 rgba(255, 255, 255, 0.15)';

            return `
              .bubble-button-card-container {
                position: relative !important;
                display: grid !important;
                grid-template-rows: auto auto 1fr auto !important;
                justify-items: center !important;
                align-items: center !important;
                text-align: center !important;
                min-height: 100px !important;
                padding: 8px 4px 8px 4px !important;
                border-radius: 14px !important;
                overflow: hidden !important;
                clip-path: inset(0 round 14px) !important;
                transition: transform 0.15s ease-out, border-color 0.3s ease, background 0.3s ease, box-shadow 0.3s ease !important;
                background: ${isOn ? surfaceOn : surfaceOff} !important;
                backdrop-filter: ${isOn ? 'blur(12px) saturate(140%)' : 'blur(8px) saturate(110%)'} !important;
                -webkit-backdrop-filter: ${isOn ? 'blur(12px) saturate(140%)' : 'blur(8px) saturate(110%)'} !important;
                border: ${isOn ? borderOn : borderOff} !important;
                box-shadow: ${isOn ? boxShadowOn : boxShadowOff} !important;
              }
              .bubble-button-card-container.is-dragging {
                border: 1.5px solid rgba(255, 149, 0, 0.45) !important;
              }
              .bubble-button-card-container:active {
                transform: scale(0.95) !important;
              }
              .bubble-content-container {
                display: grid !important;
                grid-template-rows: auto auto 1fr !important;
                justify-items: center !important;
                width: 100% !important;
                position: relative !important;
                z-index: 5 !important;
                padding-bottom: 10px !important;
              }
              .bubble-button-card-container::after {
                content: '' !important;
                position: absolute !important;
                top: 5px !important;
                right: 5px !important;
                width: ${isManual ? '7px' : '0px'} !important;
                height: ${isManual ? '7px' : '0px'} !important;
                border-radius: 50% !important;
                background: ${isManual ? 'rgb(255, 110, 90)' : 'transparent'} !important;
                border: ${isManual ? '1.5px solid rgba(255, 255, 255, 0.9)' : 'none'} !important;
                box-shadow: ${isManual ? '0 0 4px rgba(255, 110, 90, 0.5)' : 'none'} !important;
                transition: all 0.2s ease !important;
                z-index: 25 !important;
                pointer-events: none !important;
              }
              .bubble-icon-container {
                min-width: 36px !important;
                min-height: 36px !important;
                grid-row: 1 !important;
                margin: 0 0 4px 0 !important;
                border-radius: 50% !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                background: ${isOn ? iconBgOn : iconBgOff} !important;
                border: ${isOn ? '1.5px solid rgba(255, 149, 0, 0.25)' : '1.5px solid rgba(120, 120, 125, 0.22)'} !important;
                backdrop-filter: blur(4px) !important;
                -webkit-backdrop-filter: blur(4px) !important;
                transition: background 0.3s ease, border-color 0.3s ease !important;
              }
              .bubble-icon {
                --mdc-icon-size: 24px !important;
                color: ${isOn ? iconColorOn : iconColorOff} !important;
                filter: ${isOn ? 'drop-shadow(0 0 6px rgba(255, 149, 0, 0.45))' : 'none'} !important;
                transition: color 0.3s ease, filter 0.3s ease !important;
              }
              .bubble-name-container {
                grid-row: 2 !important;
                margin: 0 !important;
                width: 100% !important;
              }
              .bubble-name {
                font-weight: 650 !important;
                font-size: 14px !important;
                line-height: 1.2 !important;
                justify-content: center !important;
                color: ${isOn ? nameOn : nameOff} !important;
                transition: color 0.3s ease !important;
              }
              .bubble-attribute {
                font-size: 0 !important;
                font-weight: 600 !important;
                margin-top: 1px !important;
                justify-content: center !important;
              }
              .bubble-attribute::after {
                content: '${brightnessLabel}' !important;
                font-size: 13px !important;
                font-weight: 600 !important;
                font-variant-numeric: tabular-nums !important;
                color: ${isOn ? attrOn : attrOff} !important;
                transition: color 0.3s ease !important;
              }
              .bubble-range-slider {
                position: absolute !important;
                bottom: 0 !important;
                left: 0 !important;
                right: 0 !important;
                width: 100% !important;
                height: 4px !important;
                border-radius: 0 0 14px 14px !important;
                z-index: 10 !important;
                background: ${sliderTrack} !important;
                overflow: visible !important;
                opacity: 1 !important;
              }
              .bubble-range-fill {
                height: 4px !important;
                border-radius: 0 2px 0 0 !important;
                background: rgb(255, 149, 0) !important;
                transition: width 0.3s ease !important;
              }
              .bubble-button-card-container.is-dragging .bubble-range-fill {
                transition: width 0.04s linear !important;
              }
              .bubble-range-value {
                position: absolute !important;
                top: unset !important;
                right: unset !important;
                bottom: 50px !important;
                left: 50% !important;
                transform: translateX(-50%) !important;
                font-size: 14px !important;
                font-weight: 700 !important;
                color: rgb(255, 149, 0) !important;
                background: ${tooltipBg} !important;
                padding: 2px 8px !important;
                border-radius: 8px !important;
                box-shadow: 0 1px 6px rgba(0, 0, 0, 0.10) !important;
                opacity: 0 !important;
                pointer-events: none !important;
                transition: opacity 0.15s ease !important;
                z-index: 30 !important;
                white-space: nowrap !important;
              }
              .is-dragging .bubble-range-value {
                opacity: 1 !important;
              }
              .is-dragging .bubble-attribute {
                opacity: 0 !important;
              }
            `;
          })()}

      # ─────────────────────────────────────────────────────────────────
      # Couch Lamp (main_living zone)
      # ─────────────────────────────────────────────────────────────────
      - type: custom:bubble-card
        card_type: button
        button_type: slider
        entity: light.living_room_couch_lamp
        name: Couch
        icon: mdi:lamp
        show_state: false
        show_attribute: true
        attribute: brightness
        scrolling_effect: false
        tap_action:
          action: toggle
        hold_action:
          action: more-info
        double_tap_action:
          action: call-service
          service: light.turn_on
          target:
            entity_id: light.living_room_couch_lamp
          data:
            brightness_pct: 100
        card_mod:
          style: |
            ha-card {
              background: transparent !important;
              border: none !important;
              box-shadow: none !important;
            }
        styles: |-
          ${(() => {
            const isOn = state === 'on';
            const isDark = hass.themes?.darkMode;
            const manualLights = hass.states['switch.adaptive_lighting_main_living']?.attributes?.manual_control || [];
            const isManual = Array.isArray(manualLights) && manualLights.includes('light.living_room_couch_lamp');
            const brightness = hass.states['light.living_room_couch_lamp']?.attributes?.brightness || 0;
            const brightnessPct = Math.round((brightness / 255) * 100);
            const brightnessLabel = isOn ? `${brightnessPct}%` : 'Off';
            const surfaceOn = isDark
              ? 'linear-gradient(180deg, rgba(48, 40, 28, 0.95) 0%, rgba(36, 33, 28, 0.93) 100%)'
              : 'linear-gradient(180deg, rgba(255, 149, 0, 0.13) 0%, rgba(255, 255, 255, 0.06) 100%)';
            const surfaceOff = isDark ? 'rgba(32, 32, 34, 0.7)' : 'rgba(255, 255, 255, 0.08)';
            const borderOn = isDark ? '1.5px solid rgba(255, 149, 0, 0.14)' : '1px solid rgba(255, 149, 0, 0.40)';
            const borderOff = isDark ? '1.5px solid rgba(255, 255, 255, 0.04)' : '1px solid rgba(160, 160, 165, 0.30)';
            const nameOn = isDark ? 'rgba(255, 255, 255, 0.92)' : 'rgba(25, 25, 25, 0.95)';
            const nameOff = isDark ? 'rgba(255, 255, 255, 0.45)' : 'rgba(40, 40, 40, 0.85)';
            const attrOn = isDark ? 'rgba(255, 149, 0, 0.85)' : 'rgb(255, 149, 0)';
            const attrOff = isDark ? 'rgba(255, 255, 255, 0.30)' : 'rgba(60, 60, 60, 0.45)';
            const iconBgOn = 'rgba(255, 149, 0, 0.12)';
            const iconBgOff = isDark ? 'rgba(128, 128, 128, 0.06)' : 'rgba(120, 120, 125, 0.12)';
            const iconColorOn = 'rgb(255, 149, 0)';
            const iconColorOff = isDark ? 'rgba(255, 255, 255, 0.40)' : 'rgba(60, 60, 60, 0.55)';
            const sliderTrack = isDark ? 'rgba(255, 255, 255, 0.04)' : 'rgba(0, 0, 0, 0.06)';
            const tooltipBg = isDark ? 'rgba(30, 30, 32, 0.92)' : 'rgba(255, 255, 255, 0.92)';
            const boxShadowOn = isDark ? '0 2px 10px rgba(0, 0, 0, 0.3)' : '0 4px 20px rgba(255, 149, 0, 0.10), inset 0 1px 0 rgba(255, 255, 255, 0.25)';
            const boxShadowOff = isDark ? '0 1px 4px rgba(0, 0, 0, 0.15)' : '0 1px 6px rgba(0, 0, 0, 0.04), inset 0 1px 0 rgba(255, 255, 255, 0.15)';

            return `.bubble-button-card-container { position: relative !important; display: grid !important; grid-template-rows: auto auto 1fr auto !important; justify-items: center !important; align-items: center !important; text-align: center !important; min-height: 100px !important; padding: 8px 4px 8px 4px !important; border-radius: 14px !important; overflow: hidden !important; clip-path: inset(0 round 14px) !important; transition: transform 0.15s ease-out, border-color 0.3s ease, background 0.3s ease, box-shadow 0.3s ease !important; background: ${isOn ? surfaceOn : surfaceOff} !important; backdrop-filter: ${isOn ? 'blur(12px) saturate(140%)' : 'blur(8px) saturate(110%)'} !important; -webkit-backdrop-filter: ${isOn ? 'blur(12px) saturate(140%)' : 'blur(8px) saturate(110%)'} !important; border: ${isOn ? borderOn : borderOff} !important; box-shadow: ${isOn ? boxShadowOn : boxShadowOff} !important; } .bubble-button-card-container.is-dragging { border: 1.5px solid rgba(255, 149, 0, 0.45) !important; } .bubble-button-card-container:active { transform: scale(0.95) !important; } .bubble-content-container { display: grid !important; grid-template-rows: auto auto 1fr !important; justify-items: center !important; width: 100% !important; position: relative !important; z-index: 5 !important; padding-bottom: 10px !important; } .bubble-button-card-container::after { content: '' !important; position: absolute !important; top: 5px !important; right: 5px !important; width: ${isManual ? '7px' : '0px'} !important; height: ${isManual ? '7px' : '0px'} !important; border-radius: 50% !important; background: ${isManual ? 'rgb(255, 110, 90)' : 'transparent'} !important; border: ${isManual ? '1.5px solid rgba(255, 255, 255, 0.9)' : 'none'} !important; box-shadow: ${isManual ? '0 0 4px rgba(255, 110, 90, 0.5)' : 'none'} !important; transition: all 0.2s ease !important; z-index: 25 !important; pointer-events: none !important; } .bubble-icon-container { min-width: 36px !important; min-height: 36px !important; grid-row: 1 !important; margin: 0 0 4px 0 !important; border-radius: 50% !important; display: flex !important; align-items: center !important; justify-content: center !important; background: ${isOn ? iconBgOn : iconBgOff} !important; border: ${isOn ? '1.5px solid rgba(255, 149, 0, 0.25)' : '1.5px solid rgba(120, 120, 125, 0.22)'} !important; backdrop-filter: blur(4px) !important; -webkit-backdrop-filter: blur(4px) !important; } .bubble-icon { --mdc-icon-size: 24px !important; color: ${isOn ? iconColorOn : iconColorOff} !important; filter: ${isOn ? 'drop-shadow(0 0 6px rgba(255, 149, 0, 0.45))' : 'none'} !important; } .bubble-name-container { grid-row: 2 !important; margin: 0 !important; width: 100% !important; } .bubble-name { font-weight: 650 !important; font-size: 14px !important; line-height: 1.2 !important; justify-content: center !important; color: ${isOn ? nameOn : nameOff} !important; } .bubble-attribute { font-size: 0 !important; font-weight: 600 !important; margin-top: 1px !important; justify-content: center !important; } .bubble-attribute::after { content: '${brightnessLabel}' !important; font-size: 13px !important; font-weight: 600 !important; font-variant-numeric: tabular-nums !important; color: ${isOn ? attrOn : attrOff} !important; } .bubble-range-slider { position: absolute !important; bottom: 0 !important; left: 0 !important; right: 0 !important; width: 100% !important; height: 4px !important; border-radius: 0 0 14px 14px !important; z-index: 10 !important; background: ${sliderTrack} !important; overflow: visible !important; opacity: 1 !important; } .bubble-range-fill { height: 4px !important; border-radius: 0 2px 0 0 !important; background: rgb(255, 149, 0) !important; transition: width 0.3s ease !important; } .bubble-button-card-container.is-dragging .bubble-range-fill { transition: width 0.04s linear !important; } .bubble-range-value { position: absolute !important; top: unset !important; right: unset !important; bottom: 50px !important; left: 50% !important; transform: translateX(-50%) !important; font-size: 14px !important; font-weight: 700 !important; color: rgb(255, 149, 0) !important; background: ${tooltipBg} !important; padding: 2px 8px !important; border-radius: 8px !important; box-shadow: 0 1px 6px rgba(0, 0, 0, 0.10) !important; opacity: 0 !important; pointer-events: none !important; transition: opacity 0.15s ease !important; z-index: 30 !important; white-space: nowrap !important; } .is-dragging .bubble-range-value { opacity: 1 !important; } .is-dragging .bubble-attribute { opacity: 0 !important; }`;
          })()}

      # ─────────────────────────────────────────────────────────────────
      # Entry Lamp (main_living zone)
      # ─────────────────────────────────────────────────────────────────
      - type: custom:bubble-card
        card_type: button
        button_type: slider
        entity: light.entryway_lamp
        name: Entry
        icon: mdi:desk-lamp
        show_state: false
        show_attribute: true
        attribute: brightness
        scrolling_effect: false
        tap_action:
          action: toggle
        hold_action:
          action: more-info
        double_tap_action:
          action: call-service
          service: light.turn_on
          target:
            entity_id: light.entryway_lamp
          data:
            brightness_pct: 100
        card_mod:
          style: |
            ha-card {
              background: transparent !important;
              border: none !important;
              box-shadow: none !important;
            }
        styles: |-
          ${(() => {
            const isOn = state === 'on';
            const isDark = hass.themes?.darkMode;
            const manualLights = hass.states['switch.adaptive_lighting_main_living']?.attributes?.manual_control || [];
            const isManual = Array.isArray(manualLights) && manualLights.includes('light.entryway_lamp');
            const brightness = hass.states['light.entryway_lamp']?.attributes?.brightness || 0;
            const brightnessPct = Math.round((brightness / 255) * 100);
            const brightnessLabel = isOn ? `${brightnessPct}%` : 'Off';
            const surfaceOn = isDark ? 'linear-gradient(180deg, rgba(48, 40, 28, 0.95) 0%, rgba(36, 33, 28, 0.93) 100%)' : 'linear-gradient(180deg, rgba(255, 149, 0, 0.13) 0%, rgba(255, 255, 255, 0.06) 100%)';
            const surfaceOff = isDark ? 'rgba(32, 32, 34, 0.7)' : 'rgba(255, 255, 255, 0.08)';
            const borderOn = isDark ? '1.5px solid rgba(255, 149, 0, 0.14)' : '1px solid rgba(255, 149, 0, 0.40)';
            const borderOff = isDark ? '1.5px solid rgba(255, 255, 255, 0.04)' : '1px solid rgba(160, 160, 165, 0.30)';
            const nameOn = isDark ? 'rgba(255, 255, 255, 0.92)' : 'rgba(25, 25, 25, 0.95)';
            const nameOff = isDark ? 'rgba(255, 255, 255, 0.45)' : 'rgba(40, 40, 40, 0.85)';
            const attrOn = isDark ? 'rgba(255, 149, 0, 0.85)' : 'rgb(255, 149, 0)';
            const attrOff = isDark ? 'rgba(255, 255, 255, 0.30)' : 'rgba(60, 60, 60, 0.45)';
            const iconBgOn = 'rgba(255, 149, 0, 0.12)';
            const iconBgOff = isDark ? 'rgba(128, 128, 128, 0.06)' : 'rgba(120, 120, 125, 0.12)';
            const iconColorOn = 'rgb(255, 149, 0)';
            const iconColorOff = isDark ? 'rgba(255, 255, 255, 0.40)' : 'rgba(60, 60, 60, 0.55)';
            const sliderTrack = isDark ? 'rgba(255, 255, 255, 0.04)' : 'rgba(0, 0, 0, 0.06)';
            const tooltipBg = isDark ? 'rgba(30, 30, 32, 0.92)' : 'rgba(255, 255, 255, 0.92)';
            const boxShadowOn = isDark ? '0 2px 10px rgba(0, 0, 0, 0.3)' : '0 4px 20px rgba(255, 149, 0, 0.10), inset 0 1px 0 rgba(255, 255, 255, 0.25)';
            const boxShadowOff = isDark ? '0 1px 4px rgba(0, 0, 0, 0.15)' : '0 1px 6px rgba(0, 0, 0, 0.04), inset 0 1px 0 rgba(255, 255, 255, 0.15)';

            return `.bubble-button-card-container { position: relative !important; display: grid !important; grid-template-rows: auto auto 1fr auto !important; justify-items: center !important; align-items: center !important; text-align: center !important; min-height: 100px !important; padding: 8px 4px 8px 4px !important; border-radius: 14px !important; overflow: hidden !important; clip-path: inset(0 round 14px) !important; transition: transform 0.15s ease-out, border-color 0.3s ease, background 0.3s ease, box-shadow 0.3s ease !important; background: ${isOn ? surfaceOn : surfaceOff} !important; backdrop-filter: ${isOn ? 'blur(12px) saturate(140%)' : 'blur(8px) saturate(110%)'} !important; -webkit-backdrop-filter: ${isOn ? 'blur(12px) saturate(140%)' : 'blur(8px) saturate(110%)'} !important; border: ${isOn ? borderOn : borderOff} !important; box-shadow: ${isOn ? boxShadowOn : boxShadowOff} !important; } .bubble-button-card-container.is-dragging { border: 1.5px solid rgba(255, 149, 0, 0.45) !important; } .bubble-button-card-container:active { transform: scale(0.95) !important; } .bubble-content-container { display: grid !important; grid-template-rows: auto auto 1fr !important; justify-items: center !important; width: 100% !important; position: relative !important; z-index: 5 !important; padding-bottom: 10px !important; } .bubble-button-card-container::after { content: '' !important; position: absolute !important; top: 5px !important; right: 5px !important; width: ${isManual ? '7px' : '0px'} !important; height: ${isManual ? '7px' : '0px'} !important; border-radius: 50% !important; background: ${isManual ? 'rgb(255, 110, 90)' : 'transparent'} !important; border: ${isManual ? '1.5px solid rgba(255, 255, 255, 0.9)' : 'none'} !important; box-shadow: ${isManual ? '0 0 4px rgba(255, 110, 90, 0.5)' : 'none'} !important; transition: all 0.2s ease !important; z-index: 25 !important; pointer-events: none !important; } .bubble-icon-container { min-width: 36px !important; min-height: 36px !important; grid-row: 1 !important; margin: 0 0 4px 0 !important; border-radius: 50% !important; display: flex !important; align-items: center !important; justify-content: center !important; background: ${isOn ? iconBgOn : iconBgOff} !important; border: ${isOn ? '1.5px solid rgba(255, 149, 0, 0.25)' : '1.5px solid rgba(120, 120, 125, 0.22)'} !important; backdrop-filter: blur(4px) !important; -webkit-backdrop-filter: blur(4px) !important; } .bubble-icon { --mdc-icon-size: 24px !important; color: ${isOn ? iconColorOn : iconColorOff} !important; filter: ${isOn ? 'drop-shadow(0 0 6px rgba(255, 149, 0, 0.45))' : 'none'} !important; } .bubble-name-container { grid-row: 2 !important; margin: 0 !important; width: 100% !important; } .bubble-name { font-weight: 650 !important; font-size: 14px !important; line-height: 1.2 !important; justify-content: center !important; color: ${isOn ? nameOn : nameOff} !important; } .bubble-attribute { font-size: 0 !important; font-weight: 600 !important; margin-top: 1px !important; justify-content: center !important; } .bubble-attribute::after { content: '${brightnessLabel}' !important; font-size: 13px !important; font-weight: 600 !important; font-variant-numeric: tabular-nums !important; color: ${isOn ? attrOn : attrOff} !important; } .bubble-range-slider { position: absolute !important; bottom: 0 !important; left: 0 !important; right: 0 !important; width: 100% !important; height: 4px !important; border-radius: 0 0 14px 14px !important; z-index: 10 !important; background: ${sliderTrack} !important; overflow: visible !important; opacity: 1 !important; } .bubble-range-fill { height: 4px !important; border-radius: 0 2px 0 0 !important; background: rgb(255, 149, 0) !important; transition: width 0.3s ease !important; } .bubble-button-card-container.is-dragging .bubble-range-fill { transition: width 0.04s linear !important; } .bubble-range-value { position: absolute !important; top: unset !important; right: unset !important; bottom: 50px !important; left: 50% !important; transform: translateX(-50%) !important; font-size: 14px !important; font-weight: 700 !important; color: rgb(255, 149, 0) !important; background: ${tooltipBg} !important; padding: 2px 8px !important; border-radius: 8px !important; box-shadow: 0 1px 6px rgba(0, 0, 0, 0.10) !important; opacity: 0 !important; pointer-events: none !important; transition: opacity 0.15s ease !important; z-index: 30 !important; white-space: nowrap !important; } .is-dragging .bubble-range-value { opacity: 1 !important; } .is-dragging .bubble-attribute { opacity: 0 !important; }`;
          })()}

      # ─────────────────────────────────────────────────────────────────
      # Spot Lights (accent_spots zone)
      # ─────────────────────────────────────────────────────────────────
      - type: custom:bubble-card
        card_type: button
        button_type: slider
        entity: light.living_room_spot_lights
        name: Spots
        icon: mdi:spotlight-beam
        show_state: false
        show_attribute: true
        attribute: brightness
        scrolling_effect: false
        tap_action:
          action: toggle
        hold_action:
          action: more-info
        double_tap_action:
          action: call-service
          service: light.turn_on
          target:
            entity_id: light.living_room_spot_lights
          data:
            brightness_pct: 100
        card_mod:
          style: |
            ha-card {
              background: transparent !important;
              border: none !important;
              box-shadow: none !important;
            }
        styles: |-
          ${(() => {
            const isOn = state === 'on';
            const isDark = hass.themes?.darkMode;
            const manualLights = hass.states['switch.adaptive_lighting_accent_spots']?.attributes?.manual_control || [];
            const isManual = Array.isArray(manualLights) && manualLights.includes('light.living_room_spot_lights');
            const brightness = hass.states['light.living_room_spot_lights']?.attributes?.brightness || 0;
            const brightnessPct = Math.round((brightness / 255) * 100);
            const brightnessLabel = isOn ? `${brightnessPct}%` : 'Off';
            const surfaceOn = isDark ? 'linear-gradient(180deg, rgba(48, 40, 28, 0.95) 0%, rgba(36, 33, 28, 0.93) 100%)' : 'linear-gradient(180deg, rgba(255, 149, 0, 0.13) 0%, rgba(255, 255, 255, 0.06) 100%)';
            const surfaceOff = isDark ? 'rgba(32, 32, 34, 0.7)' : 'rgba(255, 255, 255, 0.08)';
            const borderOn = isDark ? '1.5px solid rgba(255, 149, 0, 0.14)' : '1px solid rgba(255, 149, 0, 0.40)';
            const borderOff = isDark ? '1.5px solid rgba(255, 255, 255, 0.04)' : '1px solid rgba(160, 160, 165, 0.30)';
            const nameOn = isDark ? 'rgba(255, 255, 255, 0.92)' : 'rgba(25, 25, 25, 0.95)';
            const nameOff = isDark ? 'rgba(255, 255, 255, 0.45)' : 'rgba(40, 40, 40, 0.85)';
            const attrOn = isDark ? 'rgba(255, 149, 0, 0.85)' : 'rgb(255, 149, 0)';
            const attrOff = isDark ? 'rgba(255, 255, 255, 0.30)' : 'rgba(60, 60, 60, 0.45)';
            const iconBgOn = 'rgba(255, 149, 0, 0.12)';
            const iconBgOff = isDark ? 'rgba(128, 128, 128, 0.06)' : 'rgba(120, 120, 125, 0.12)';
            const iconColorOn = 'rgb(255, 149, 0)';
            const iconColorOff = isDark ? 'rgba(255, 255, 255, 0.40)' : 'rgba(60, 60, 60, 0.55)';
            const sliderTrack = isDark ? 'rgba(255, 255, 255, 0.04)' : 'rgba(0, 0, 0, 0.06)';
            const tooltipBg = isDark ? 'rgba(30, 30, 32, 0.92)' : 'rgba(255, 255, 255, 0.92)';
            const boxShadowOn = isDark ? '0 2px 10px rgba(0, 0, 0, 0.3)' : '0 4px 20px rgba(255, 149, 0, 0.10), inset 0 1px 0 rgba(255, 255, 255, 0.25)';
            const boxShadowOff = isDark ? '0 1px 4px rgba(0, 0, 0, 0.15)' : '0 1px 6px rgba(0, 0, 0, 0.04), inset 0 1px 0 rgba(255, 255, 255, 0.15)';

            return `.bubble-button-card-container { position: relative !important; display: grid !important; grid-template-rows: auto auto 1fr auto !important; justify-items: center !important; align-items: center !important; text-align: center !important; min-height: 100px !important; padding: 8px 4px 8px 4px !important; border-radius: 14px !important; overflow: hidden !important; clip-path: inset(0 round 14px) !important; transition: transform 0.15s ease-out, border-color 0.3s ease, background 0.3s ease, box-shadow 0.3s ease !important; background: ${isOn ? surfaceOn : surfaceOff} !important; backdrop-filter: ${isOn ? 'blur(12px) saturate(140%)' : 'blur(8px) saturate(110%)'} !important; -webkit-backdrop-filter: ${isOn ? 'blur(12px) saturate(140%)' : 'blur(8px) saturate(110%)'} !important; border: ${isOn ? borderOn : borderOff} !important; box-shadow: ${isOn ? boxShadowOn : boxShadowOff} !important; } .bubble-button-card-container.is-dragging { border: 1.5px solid rgba(255, 149, 0, 0.45) !important; } .bubble-button-card-container:active { transform: scale(0.95) !important; } .bubble-content-container { display: grid !important; grid-template-rows: auto auto 1fr !important; justify-items: center !important; width: 100% !important; position: relative !important; z-index: 5 !important; padding-bottom: 10px !important; } .bubble-button-card-container::after { content: '' !important; position: absolute !important; top: 5px !important; right: 5px !important; width: ${isManual ? '7px' : '0px'} !important; height: ${isManual ? '7px' : '0px'} !important; border-radius: 50% !important; background: ${isManual ? 'rgb(255, 110, 90)' : 'transparent'} !important; border: ${isManual ? '1.5px solid rgba(255, 255, 255, 0.9)' : 'none'} !important; box-shadow: ${isManual ? '0 0 4px rgba(255, 110, 90, 0.5)' : 'none'} !important; transition: all 0.2s ease !important; z-index: 25 !important; pointer-events: none !important; } .bubble-icon-container { min-width: 36px !important; min-height: 36px !important; grid-row: 1 !important; margin: 0 0 4px 0 !important; border-radius: 50% !important; display: flex !important; align-items: center !important; justify-content: center !important; background: ${isOn ? iconBgOn : iconBgOff} !important; border: ${isOn ? '1.5px solid rgba(255, 149, 0, 0.25)' : '1.5px solid rgba(120, 120, 125, 0.22)'} !important; backdrop-filter: blur(4px) !important; -webkit-backdrop-filter: blur(4px) !important; } .bubble-icon { --mdc-icon-size: 24px !important; color: ${isOn ? iconColorOn : iconColorOff} !important; filter: ${isOn ? 'drop-shadow(0 0 6px rgba(255, 149, 0, 0.45))' : 'none'} !important; } .bubble-name-container { grid-row: 2 !important; margin: 0 !important; width: 100% !important; } .bubble-name { font-weight: 650 !important; font-size: 14px !important; line-height: 1.2 !important; justify-content: center !important; color: ${isOn ? nameOn : nameOff} !important; } .bubble-attribute { font-size: 0 !important; font-weight: 600 !important; margin-top: 1px !important; justify-content: center !important; } .bubble-attribute::after { content: '${brightnessLabel}' !important; font-size: 13px !important; font-weight: 600 !important; font-variant-numeric: tabular-nums !important; color: ${isOn ? attrOn : attrOff} !important; } .bubble-range-slider { position: absolute !important; bottom: 0 !important; left: 0 !important; right: 0 !important; width: 100% !important; height: 4px !important; border-radius: 0 0 14px 14px !important; z-index: 10 !important; background: ${sliderTrack} !important; overflow: visible !important; opacity: 1 !important; } .bubble-range-fill { height: 4px !important; border-radius: 0 2px 0 0 !important; background: rgb(255, 149, 0) !important; transition: width 0.3s ease !important; } .bubble-button-card-container.is-dragging .bubble-range-fill { transition: width 0.04s linear !important; } .bubble-range-value { position: absolute !important; top: unset !important; right: unset !important; bottom: 50px !important; left: 50% !important; transform: translateX(-50%) !important; font-size: 14px !important; font-weight: 700 !important; color: rgb(255, 149, 0) !important; background: ${tooltipBg} !important; padding: 2px 8px !important; border-radius: 8px !important; box-shadow: 0 1px 6px rgba(0, 0, 0, 0.10) !important; opacity: 0 !important; pointer-events: none !important; transition: opacity 0.15s ease !important; z-index: 30 !important; white-space: nowrap !important; } .is-dragging .bubble-range-value { opacity: 1 !important; } .is-dragging .bubble-attribute { opacity: 0 !important; }`;
          })()}

      # ─────────────────────────────────────────────────────────────────
      # Column Lights (column_lights zone)
      # ─────────────────────────────────────────────────────────────────
      - type: custom:bubble-card
        card_type: button
        button_type: slider
        entity: light.column_lights
        name: Columns
        icon: mdi:led-strip-variant
        show_state: false
        show_attribute: true
        attribute: brightness
        scrolling_effect: false
        tap_action:
          action: toggle
        hold_action:
          action: more-info
        double_tap_action:
          action: call-service
          service: light.turn_on
          target:
            entity_id: light.column_lights
          data:
            brightness_pct: 100
        card_mod:
          style: |
            ha-card {
              background: transparent !important;
              border: none !important;
              box-shadow: none !important;
            }
        styles: |-
          ${(() => {
            const isOn = state === 'on';
            const isDark = hass.themes?.darkMode;
            const manualLights = hass.states['switch.adaptive_lighting_column_lights']?.attributes?.manual_control || [];
            const isManual = Array.isArray(manualLights) && manualLights.length > 0;
            const brightness = hass.states['light.column_lights']?.attributes?.brightness || 0;
            const brightnessPct = Math.round((brightness / 255) * 100);
            const brightnessLabel = isOn ? `${brightnessPct}%` : 'Off';
            const surfaceOn = isDark ? 'linear-gradient(180deg, rgba(48, 40, 28, 0.95) 0%, rgba(36, 33, 28, 0.93) 100%)' : 'linear-gradient(180deg, rgba(255, 149, 0, 0.13) 0%, rgba(255, 255, 255, 0.06) 100%)';
            const surfaceOff = isDark ? 'rgba(32, 32, 34, 0.7)' : 'rgba(255, 255, 255, 0.08)';
            const borderOn = isDark ? '1.5px solid rgba(255, 149, 0, 0.14)' : '1px solid rgba(255, 149, 0, 0.40)';
            const borderOff = isDark ? '1.5px solid rgba(255, 255, 255, 0.04)' : '1px solid rgba(160, 160, 165, 0.30)';
            const nameOn = isDark ? 'rgba(255, 255, 255, 0.92)' : 'rgba(25, 25, 25, 0.95)';
            const nameOff = isDark ? 'rgba(255, 255, 255, 0.45)' : 'rgba(40, 40, 40, 0.85)';
            const attrOn = isDark ? 'rgba(255, 149, 0, 0.85)' : 'rgb(255, 149, 0)';
            const attrOff = isDark ? 'rgba(255, 255, 255, 0.30)' : 'rgba(60, 60, 60, 0.45)';
            const iconBgOn = 'rgba(255, 149, 0, 0.12)';
            const iconBgOff = isDark ? 'rgba(128, 128, 128, 0.06)' : 'rgba(120, 120, 125, 0.12)';
            const iconColorOn = 'rgb(255, 149, 0)';
            const iconColorOff = isDark ? 'rgba(255, 255, 255, 0.40)' : 'rgba(60, 60, 60, 0.55)';
            const sliderTrack = isDark ? 'rgba(255, 255, 255, 0.04)' : 'rgba(0, 0, 0, 0.06)';
            const tooltipBg = isDark ? 'rgba(30, 30, 32, 0.92)' : 'rgba(255, 255, 255, 0.92)';
            const boxShadowOn = isDark ? '0 2px 10px rgba(0, 0, 0, 0.3)' : '0 4px 20px rgba(255, 149, 0, 0.10), inset 0 1px 0 rgba(255, 255, 255, 0.25)';
            const boxShadowOff = isDark ? '0 1px 4px rgba(0, 0, 0, 0.15)' : '0 1px 6px rgba(0, 0, 0, 0.04), inset 0 1px 0 rgba(255, 255, 255, 0.15)';

            return `.bubble-button-card-container { position: relative !important; display: grid !important; grid-template-rows: auto auto 1fr auto !important; justify-items: center !important; align-items: center !important; text-align: center !important; min-height: 100px !important; padding: 8px 4px 8px 4px !important; border-radius: 14px !important; overflow: hidden !important; clip-path: inset(0 round 14px) !important; transition: transform 0.15s ease-out, border-color 0.3s ease, background 0.3s ease, box-shadow 0.3s ease !important; background: ${isOn ? surfaceOn : surfaceOff} !important; backdrop-filter: ${isOn ? 'blur(12px) saturate(140%)' : 'blur(8px) saturate(110%)'} !important; -webkit-backdrop-filter: ${isOn ? 'blur(12px) saturate(140%)' : 'blur(8px) saturate(110%)'} !important; border: ${isOn ? borderOn : borderOff} !important; box-shadow: ${isOn ? boxShadowOn : boxShadowOff} !important; } .bubble-button-card-container.is-dragging { border: 1.5px solid rgba(255, 149, 0, 0.45) !important; } .bubble-button-card-container:active { transform: scale(0.95) !important; } .bubble-content-container { display: grid !important; grid-template-rows: auto auto 1fr !important; justify-items: center !important; width: 100% !important; position: relative !important; z-index: 5 !important; padding-bottom: 10px !important; } .bubble-button-card-container::after { content: '' !important; position: absolute !important; top: 5px !important; right: 5px !important; width: ${isManual ? '7px' : '0px'} !important; height: ${isManual ? '7px' : '0px'} !important; border-radius: 50% !important; background: ${isManual ? 'rgb(255, 110, 90)' : 'transparent'} !important; border: ${isManual ? '1.5px solid rgba(255, 255, 255, 0.9)' : 'none'} !important; box-shadow: ${isManual ? '0 0 4px rgba(255, 110, 90, 0.5)' : 'none'} !important; transition: all 0.2s ease !important; z-index: 25 !important; pointer-events: none !important; } .bubble-icon-container { min-width: 36px !important; min-height: 36px !important; grid-row: 1 !important; margin: 0 0 4px 0 !important; border-radius: 50% !important; display: flex !important; align-items: center !important; justify-content: center !important; background: ${isOn ? iconBgOn : iconBgOff} !important; border: ${isOn ? '1.5px solid rgba(255, 149, 0, 0.25)' : '1.5px solid rgba(120, 120, 125, 0.22)'} !important; backdrop-filter: blur(4px) !important; -webkit-backdrop-filter: blur(4px) !important; } .bubble-icon { --mdc-icon-size: 24px !important; color: ${isOn ? iconColorOn : iconColorOff} !important; filter: ${isOn ? 'drop-shadow(0 0 6px rgba(255, 149, 0, 0.45))' : 'none'} !important; } .bubble-name-container { grid-row: 2 !important; margin: 0 !important; width: 100% !important; } .bubble-name { font-weight: 650 !important; font-size: 14px !important; line-height: 1.2 !important; justify-content: center !important; color: ${isOn ? nameOn : nameOff} !important; } .bubble-attribute { font-size: 0 !important; font-weight: 600 !important; margin-top: 1px !important; justify-content: center !important; } .bubble-attribute::after { content: '${brightnessLabel}' !important; font-size: 13px !important; font-weight: 600 !important; font-variant-numeric: tabular-nums !important; color: ${isOn ? attrOn : attrOff} !important; } .bubble-range-slider { position: absolute !important; bottom: 0 !important; left: 0 !important; right: 0 !important; width: 100% !important; height: 4px !important; border-radius: 0 0 14px 14px !important; z-index: 10 !important; background: ${sliderTrack} !important; overflow: visible !important; opacity: 1 !important; } .bubble-range-fill { height: 4px !important; border-radius: 0 2px 0 0 !important; background: rgb(255, 149, 0) !important; transition: width 0.3s ease !important; } .bubble-button-card-container.is-dragging .bubble-range-fill { transition: width 0.04s linear !important; } .bubble-range-value { position: absolute !important; top: unset !important; right: unset !important; bottom: 50px !important; left: 50% !important; transform: translateX(-50%) !important; font-size: 14px !important; font-weight: 700 !important; color: rgb(255, 149, 0) !important; background: ${tooltipBg} !important; padding: 2px 8px !important; border-radius: 8px !important; box-shadow: 0 1px 6px rgba(0, 0, 0, 0.10) !important; opacity: 0 !important; pointer-events: none !important; transition: opacity 0.15s ease !important; z-index: 30 !important; white-space: nowrap !important; } .is-dragging .bubble-range-value { opacity: 1 !important; } .is-dragging .bubble-attribute { opacity: 0 !important; }`;
          })()}

      # ─────────────────────────────────────────────────────────────────
      # Recessed / Hallway Lights (recessed_ceiling zone)
      # ─────────────────────────────────────────────────────────────────
      - type: custom:bubble-card
        card_type: button
        button_type: slider
        entity: light.living_room_hallway_lights
        name: Recessed
        icon: mdi:light-recessed
        show_state: false
        show_attribute: true
        attribute: brightness
        scrolling_effect: false
        tap_action:
          action: toggle
        hold_action:
          action: more-info
        double_tap_action:
          action: call-service
          service: light.turn_on
          target:
            entity_id: light.living_room_hallway_lights
          data:
            brightness_pct: 100
        card_mod:
          style: |
            ha-card {
              background: transparent !important;
              border: none !important;
              box-shadow: none !important;
            }
        styles: |-
          ${(() => {
            const isOn = state === 'on';
            const isDark = hass.themes?.darkMode;
            const manualLights = hass.states['switch.adaptive_lighting_recessed_ceiling']?.attributes?.manual_control || [];
            const isManual = Array.isArray(manualLights) && manualLights.includes('light.living_room_hallway_lights');
            const brightness = hass.states['light.living_room_hallway_lights']?.attributes?.brightness || 0;
            const brightnessPct = Math.round((brightness / 255) * 100);
            const brightnessLabel = isOn ? `${brightnessPct}%` : 'Off';
            const surfaceOn = isDark ? 'linear-gradient(180deg, rgba(48, 40, 28, 0.95) 0%, rgba(36, 33, 28, 0.93) 100%)' : 'linear-gradient(180deg, rgba(255, 149, 0, 0.13) 0%, rgba(255, 255, 255, 0.06) 100%)';
            const surfaceOff = isDark ? 'rgba(32, 32, 34, 0.7)' : 'rgba(255, 255, 255, 0.08)';
            const borderOn = isDark ? '1.5px solid rgba(255, 149, 0, 0.14)' : '1px solid rgba(255, 149, 0, 0.40)';
            const borderOff = isDark ? '1.5px solid rgba(255, 255, 255, 0.04)' : '1px solid rgba(160, 160, 165, 0.30)';
            const nameOn = isDark ? 'rgba(255, 255, 255, 0.92)' : 'rgba(25, 25, 25, 0.95)';
            const nameOff = isDark ? 'rgba(255, 255, 255, 0.45)' : 'rgba(40, 40, 40, 0.85)';
            const attrOn = isDark ? 'rgba(255, 149, 0, 0.85)' : 'rgb(255, 149, 0)';
            const attrOff = isDark ? 'rgba(255, 255, 255, 0.30)' : 'rgba(60, 60, 60, 0.45)';
            const iconBgOn = 'rgba(255, 149, 0, 0.12)';
            const iconBgOff = isDark ? 'rgba(128, 128, 128, 0.06)' : 'rgba(120, 120, 125, 0.12)';
            const iconColorOn = 'rgb(255, 149, 0)';
            const iconColorOff = isDark ? 'rgba(255, 255, 255, 0.40)' : 'rgba(60, 60, 60, 0.55)';
            const sliderTrack = isDark ? 'rgba(255, 255, 255, 0.04)' : 'rgba(0, 0, 0, 0.06)';
            const tooltipBg = isDark ? 'rgba(30, 30, 32, 0.92)' : 'rgba(255, 255, 255, 0.92)';
            const boxShadowOn = isDark ? '0 2px 10px rgba(0, 0, 0, 0.3)' : '0 4px 20px rgba(255, 149, 0, 0.10), inset 0 1px 0 rgba(255, 255, 255, 0.25)';
            const boxShadowOff = isDark ? '0 1px 4px rgba(0, 0, 0, 0.15)' : '0 1px 6px rgba(0, 0, 0, 0.04), inset 0 1px 0 rgba(255, 255, 255, 0.15)';

            return `.bubble-button-card-container { position: relative !important; display: grid !important; grid-template-rows: auto auto 1fr auto !important; justify-items: center !important; align-items: center !important; text-align: center !important; min-height: 100px !important; padding: 8px 4px 8px 4px !important; border-radius: 14px !important; overflow: hidden !important; clip-path: inset(0 round 14px) !important; transition: transform 0.15s ease-out, border-color 0.3s ease, background 0.3s ease, box-shadow 0.3s ease !important; background: ${isOn ? surfaceOn : surfaceOff} !important; backdrop-filter: ${isOn ? 'blur(12px) saturate(140%)' : 'blur(8px) saturate(110%)'} !important; -webkit-backdrop-filter: ${isOn ? 'blur(12px) saturate(140%)' : 'blur(8px) saturate(110%)'} !important; border: ${isOn ? borderOn : borderOff} !important; box-shadow: ${isOn ? boxShadowOn : boxShadowOff} !important; } .bubble-button-card-container.is-dragging { border: 1.5px solid rgba(255, 149, 0, 0.45) !important; } .bubble-button-card-container:active { transform: scale(0.95) !important; } .bubble-content-container { display: grid !important; grid-template-rows: auto auto 1fr !important; justify-items: center !important; width: 100% !important; position: relative !important; z-index: 5 !important; padding-bottom: 10px !important; } .bubble-button-card-container::after { content: '' !important; position: absolute !important; top: 5px !important; right: 5px !important; width: ${isManual ? '7px' : '0px'} !important; height: ${isManual ? '7px' : '0px'} !important; border-radius: 50% !important; background: ${isManual ? 'rgb(255, 110, 90)' : 'transparent'} !important; border: ${isManual ? '1.5px solid rgba(255, 255, 255, 0.9)' : 'none'} !important; box-shadow: ${isManual ? '0 0 4px rgba(255, 110, 90, 0.5)' : 'none'} !important; transition: all 0.2s ease !important; z-index: 25 !important; pointer-events: none !important; } .bubble-icon-container { min-width: 36px !important; min-height: 36px !important; grid-row: 1 !important; margin: 0 0 4px 0 !important; border-radius: 50% !important; display: flex !important; align-items: center !important; justify-content: center !important; background: ${isOn ? iconBgOn : iconBgOff} !important; border: ${isOn ? '1.5px solid rgba(255, 149, 0, 0.25)' : '1.5px solid rgba(120, 120, 125, 0.22)'} !important; backdrop-filter: blur(4px) !important; -webkit-backdrop-filter: blur(4px) !important; } .bubble-icon { --mdc-icon-size: 24px !important; color: ${isOn ? iconColorOn : iconColorOff} !important; filter: ${isOn ? 'drop-shadow(0 0 6px rgba(255, 149, 0, 0.45))' : 'none'} !important; } .bubble-name-container { grid-row: 2 !important; margin: 0 !important; width: 100% !important; } .bubble-name { font-weight: 650 !important; font-size: 14px !important; line-height: 1.2 !important; justify-content: center !important; color: ${isOn ? nameOn : nameOff} !important; } .bubble-attribute { font-size: 0 !important; font-weight: 600 !important; margin-top: 1px !important; justify-content: center !important; } .bubble-attribute::after { content: '${brightnessLabel}' !important; font-size: 13px !important; font-weight: 600 !important; font-variant-numeric: tabular-nums !important; color: ${isOn ? attrOn : attrOff} !important; } .bubble-range-slider { position: absolute !important; bottom: 0 !important; left: 0 !important; right: 0 !important; width: 100% !important; height: 4px !important; border-radius: 0 0 14px 14px !important; z-index: 10 !important; background: ${sliderTrack} !important; overflow: visible !important; opacity: 1 !important; } .bubble-range-fill { height: 4px !important; border-radius: 0 2px 0 0 !important; background: rgb(255, 149, 0) !important; transition: width 0.3s ease !important; } .bubble-button-card-container.is-dragging .bubble-range-fill { transition: width 0.04s linear !important; } .bubble-range-value { position: absolute !important; top: unset !important; right: unset !important; bottom: 50px !important; left: 50% !important; transform: translateX(-50%) !important; font-size: 14px !important; font-weight: 700 !important; color: rgb(255, 149, 0) !important; background: ${tooltipBg} !important; padding: 2px 8px !important; border-radius: 8px !important; box-shadow: 0 1px 6px rgba(0, 0, 0, 0.10) !important; opacity: 0 !important; pointer-events: none !important; transition: opacity 0.15s ease !important; z-index: 30 !important; white-space: nowrap !important; } .is-dragging .bubble-range-value { opacity: 1 !important; } .is-dragging .bubble-attribute { opacity: 0 !important; }`;
          })()}

  # ═══════════════════════════════════════════════════════════════════════
  # MEDIA GRID - Sonos (blue), Apple TV (blue), Samsung (blue)
  # ═══════════════════════════════════════════════════════════════════════
  - type: custom:layout-card
    layout_type: custom:grid-layout
    layout:
      grid-template-columns: repeat(3, 1fr)
      gap: 8px
      padding: 2px 12px 4px 12px
      mediaquery:
        "(max-width: 400px)":
          grid-template-columns: repeat(2, 1fr)
    card_mod:
      style: |
        ha-card {
          background: transparent !important;
          border: none !important;
          box-shadow: none !important;
          margin: 0 !important;
        }
    cards:
      # ─────────────────────────────────────────────────────────────────
      # Sonos Speaker - Blue accent, volume slider
      # ─────────────────────────────────────────────────────────────────
      - type: custom:bubble-card
        card_type: button
        button_type: slider
        entity: media_player.living_room
        name: Sonos
        icon: mdi:speaker
        show_state: false
        show_attribute: true
        attribute: volume_level
        scrolling_effect: false
        tap_action:
          action: perform-action
          perform_action: media_player.media_play_pause
          target:
            entity_id: media_player.living_room
        hold_action:
          action: call-service
          service: script.sonos_toggle_group_membership
          data:
            target_speaker: media_player.living_room
        card_mod:
          style: |
            ha-card {
              background: transparent !important;
              border: none !important;
              box-shadow: none !important;
            }
        styles: |-
          ${(() => {
            const inGroup = hass.states['binary_sensor.sonos_living_room_in_playing_group']?.state === 'on';
            const isDark = hass.themes?.darkMode;
            const accentColor = 'rgb(66, 133, 244)';
            const surfaceOn = isDark
              ? 'linear-gradient(180deg, rgba(66, 133, 244, 0.14) 0%, rgba(255, 255, 255, 0.03) 100%)'
              : 'linear-gradient(180deg, rgba(66, 133, 244, 0.13) 0%, rgba(255, 255, 255, 0.06) 100%)';
            const surfaceOff = isDark ? 'rgba(32, 32, 34, 0.7)' : 'rgba(255, 255, 255, 0.08)';
            const borderOn = isDark ? '1px solid rgba(66, 133, 244, 0.30)' : '1px solid rgba(66, 133, 244, 0.40)';
            const borderOff = isDark ? '1.5px solid rgba(255, 255, 255, 0.04)' : '1px solid rgba(160, 160, 165, 0.30)';
            const nameOn = isDark ? 'rgba(255, 255, 255, 0.95)' : 'rgba(25, 25, 25, 0.95)';
            const nameOff = isDark ? 'rgba(255, 255, 255, 0.45)' : 'rgba(40, 40, 40, 0.85)';
            const attrOff = isDark ? 'rgba(255, 255, 255, 0.30)' : 'rgba(60, 60, 60, 0.45)';
            const sliderTrack = isDark ? 'rgba(255, 255, 255, 0.04)' : 'rgba(0, 0, 0, 0.06)';
            const tooltipBg = isDark ? 'rgba(30, 30, 32, 0.92)' : 'rgba(255, 255, 255, 0.92)';
            return `.bubble-button-card-container { position: relative !important; display: grid !important; grid-template-rows: auto auto 1fr auto !important; justify-items: center !important; align-items: center !important; text-align: center !important; min-height: 100px !important; padding: 8px 4px 8px 4px !important; border-radius: 14px !important; overflow: hidden !important; clip-path: inset(0 round 14px) !important; transition: transform 0.15s ease-out, border-color 0.3s ease, background 0.3s ease, box-shadow 0.3s ease !important; background: ${inGroup ? surfaceOn : surfaceOff} !important; backdrop-filter: ${inGroup ? 'blur(12px) saturate(140%)' : 'blur(8px) saturate(110%)'} !important; -webkit-backdrop-filter: ${inGroup ? 'blur(12px) saturate(140%)' : 'blur(8px) saturate(110%)'} !important; border: ${inGroup ? borderOn : borderOff} !important; box-shadow: ${inGroup ? '0 4px 20px rgba(66, 133, 244, 0.10), inset 0 1px 0 rgba(255, 255, 255, 0.25)' : (isDark ? '0 1px 4px rgba(0, 0, 0, 0.15)' : '0 1px 6px rgba(0, 0, 0, 0.04), inset 0 1px 0 rgba(255, 255, 255, 0.15)')} !important; } .bubble-button-card-container:active { transform: scale(0.95) !important; } .bubble-button-card-container::after { content: '' !important; position: absolute !important; top: 5px !important; right: 5px !important; width: ${inGroup ? '7px' : '0px'} !important; height: ${inGroup ? '7px' : '0px'} !important; border-radius: 50% !important; background: ${inGroup ? accentColor : 'transparent'} !important; border: ${inGroup ? '1.5px solid rgba(255, 255, 255, 0.9)' : 'none'} !important; box-shadow: ${inGroup ? '0 0 4px rgba(66, 133, 244, 0.5)' : 'none'} !important; transition: all 0.2s ease !important; z-index: 25 !important; } .bubble-content-container { display: grid !important; grid-template-rows: auto auto 1fr !important; justify-items: center !important; width: 100% !important; position: relative !important; z-index: 5 !important; padding-bottom: 8px !important; } .bubble-icon-container { min-width: 36px !important; min-height: 36px !important; grid-row: 1 !important; margin: 1px 0 2px 0 !important; border-radius: 50% !important; display: flex !important; align-items: center !important; justify-content: center !important; background: ${inGroup ? 'rgba(66, 133, 244, 0.12)' : (isDark ? 'rgba(128, 128, 128, 0.06)' : 'rgba(120, 120, 125, 0.12)')} !important; border: ${inGroup ? '1.5px solid rgba(66, 133, 244, 0.25)' : '1.5px solid rgba(120, 120, 125, 0.22)'} !important; backdrop-filter: blur(4px) !important; -webkit-backdrop-filter: blur(4px) !important; } .bubble-icon { --mdc-icon-size: 24px !important; color: ${inGroup ? accentColor : (isDark ? 'rgba(255, 255, 255, 0.40)' : 'rgba(60, 60, 60, 0.55)')} !important; filter: ${inGroup ? 'drop-shadow(0 0 6px rgba(66, 133, 244, 0.45))' : 'none'} !important; } .bubble-name-container { grid-row: 2 !important; margin: 0 !important; width: 100% !important; } .bubble-name { font-weight: 650 !important; font-size: 14px !important; line-height: 1.2 !important; justify-content: center !important; color: ${inGroup ? nameOn : nameOff} !important; } .bubble-attribute { font-size: 13px !important; font-weight: 600 !important; margin-top: 1px !important; justify-content: center !important; color: ${inGroup ? accentColor : attrOff} !important; transition: opacity 0.15s ease !important; } .bubble-range-slider { position: absolute !important; bottom: 0 !important; left: 0 !important; right: 0 !important; width: 100% !important; height: 4px !important; border-radius: 0 0 14px 14px !important; z-index: 10 !important; background: ${sliderTrack} !important; overflow: visible !important; opacity: 1 !important; } .bubble-range-fill { height: 4px !important; border-radius: 0 0 14px 0 !important; background: ${accentColor} !important; } .bubble-range-value { position: absolute !important; top: unset !important; right: unset !important; bottom: 50px !important; left: 50% !important; transform: translateX(-50%) !important; font-size: 14px !important; font-weight: 700 !important; color: ${accentColor} !important; background: ${tooltipBg} !important; padding: 2px 8px !important; border-radius: 8px !important; box-shadow: 0 1px 6px rgba(0, 0, 0, 0.10) !important; opacity: 0 !important; pointer-events: none !important; transition: opacity 0.15s ease !important; z-index: 30 !important; white-space: nowrap !important; } .is-dragging .bubble-range-value { opacity: 1 !important; } .is-dragging .bubble-attribute { opacity: 0 !important; }`;
          })()}

      # ─────────────────────────────────────────────────────────────────
      # Apple TV - Blue accent, state button
      # ─────────────────────────────────────────────────────────────────
      - type: custom:bubble-card
        card_type: button
        button_type: state
        entity: media_player.living_room_apple_tv
        name: Apple TV
        icon: mdi:apple
        show_state: false
        tap_action:
          action: toggle
        hold_action:
          action: more-info
        card_mod:
          style: |
            ha-card {
              background: transparent !important;
              border: none !important;
              box-shadow: none !important;
            }
        styles: |-
          ${(() => {
            const isActive = ['playing', 'on', 'paused'].includes(hass.states['media_player.living_room_apple_tv']?.state);
            const isDark = hass.themes?.darkMode;
            const accentColor = 'rgb(66, 133, 244)';
            const surfaceOn = isDark ? 'linear-gradient(180deg, rgba(66, 133, 244, 0.14) 0%, rgba(255, 255, 255, 0.03) 100%)' : 'linear-gradient(180deg, rgba(66, 133, 244, 0.13) 0%, rgba(255, 255, 255, 0.06) 100%)';
            const surfaceOff = isDark ? 'rgba(32, 32, 34, 0.7)' : 'rgba(255, 255, 255, 0.08)';
            const borderOn = isDark ? '1px solid rgba(66, 133, 244, 0.30)' : '1px solid rgba(66, 133, 244, 0.40)';
            const borderOff = isDark ? '1.5px solid rgba(255, 255, 255, 0.04)' : '1px solid rgba(160, 160, 165, 0.30)';
            const nameOn = isDark ? 'rgba(255, 255, 255, 0.95)' : 'rgba(25, 25, 25, 0.95)';
            const nameOff = isDark ? 'rgba(255, 255, 255, 0.45)' : 'rgba(40, 40, 40, 0.85)';
            return `.bubble-button-card-container { position: relative !important; display: grid !important; grid-template-rows: auto auto 1fr auto !important; justify-items: center !important; align-items: center !important; text-align: center !important; min-height: 100px !important; padding: 8px 4px 8px 4px !important; border-radius: 14px !important; overflow: hidden !important; clip-path: inset(0 round 14px) !important; transition: transform 0.15s ease-out, border-color 0.3s ease, background 0.3s ease, box-shadow 0.3s ease !important; background: ${isActive ? surfaceOn : surfaceOff} !important; backdrop-filter: ${isActive ? 'blur(12px) saturate(140%)' : 'blur(8px) saturate(110%)'} !important; -webkit-backdrop-filter: ${isActive ? 'blur(12px) saturate(140%)' : 'blur(8px) saturate(110%)'} !important; border: ${isActive ? borderOn : borderOff} !important; box-shadow: ${isActive ? '0 4px 20px rgba(66, 133, 244, 0.10), inset 0 1px 0 rgba(255, 255, 255, 0.25)' : (isDark ? '0 1px 4px rgba(0, 0, 0, 0.15)' : '0 1px 6px rgba(0, 0, 0, 0.04), inset 0 1px 0 rgba(255, 255, 255, 0.15)')} !important; } .bubble-button-card-container:active { transform: scale(0.95) !important; } .bubble-content-container { display: grid !important; grid-template-rows: auto auto 1fr !important; justify-items: center !important; width: 100% !important; position: relative !important; z-index: 5 !important; padding-bottom: 8px !important; } .bubble-icon-container { min-width: 36px !important; min-height: 36px !important; grid-row: 1 !important; margin: 1px 0 2px 0 !important; border-radius: 50% !important; display: flex !important; align-items: center !important; justify-content: center !important; background: ${isActive ? 'rgba(66, 133, 244, 0.12)' : (isDark ? 'rgba(128, 128, 128, 0.06)' : 'rgba(120, 120, 125, 0.12)')} !important; border: ${isActive ? '1.5px solid rgba(66, 133, 244, 0.25)' : '1.5px solid rgba(120, 120, 125, 0.22)'} !important; backdrop-filter: blur(4px) !important; -webkit-backdrop-filter: blur(4px) !important; } .bubble-icon { --mdc-icon-size: 24px !important; color: ${isActive ? accentColor : (isDark ? 'rgba(255, 255, 255, 0.40)' : 'rgba(60, 60, 60, 0.55)')} !important; filter: ${isActive ? 'drop-shadow(0 0 6px rgba(66, 133, 244, 0.45))' : 'none'} !important; } .bubble-name-container { grid-row: 2 !important; margin: 0 !important; width: 100% !important; } .bubble-name { font-weight: 650 !important; font-size: 14px !important; line-height: 1.2 !important; justify-content: center !important; color: ${isActive ? nameOn : nameOff} !important; }`;
          })()}

      # ─────────────────────────────────────────────────────────────────
      # Samsung TV - Blue accent, state button
      # ─────────────────────────────────────────────────────────────────
      - type: custom:bubble-card
        card_type: button
        button_type: state
        entity: media_player.living_room_samsung_q60
        name: Samsung
        icon: mdi:television
        show_state: false
        tap_action:
          action: toggle
        hold_action:
          action: more-info
        card_mod:
          style: |
            ha-card {
              background: transparent !important;
              border: none !important;
              box-shadow: none !important;
            }
        styles: |-
          ${(() => {
            const isOn = hass.states['media_player.living_room_samsung_q60']?.state === 'on';
            const isDark = hass.themes?.darkMode;
            const accentColor = 'rgb(66, 133, 244)';
            const surfaceOn = isDark ? 'linear-gradient(180deg, rgba(66, 133, 244, 0.14) 0%, rgba(255, 255, 255, 0.03) 100%)' : 'linear-gradient(180deg, rgba(66, 133, 244, 0.13) 0%, rgba(255, 255, 255, 0.06) 100%)';
            const surfaceOff = isDark ? 'rgba(32, 32, 34, 0.7)' : 'rgba(255, 255, 255, 0.08)';
            const borderOn = isDark ? '1px solid rgba(66, 133, 244, 0.30)' : '1px solid rgba(66, 133, 244, 0.40)';
            const borderOff = isDark ? '1.5px solid rgba(255, 255, 255, 0.04)' : '1px solid rgba(160, 160, 165, 0.30)';
            const nameOn = isDark ? 'rgba(255, 255, 255, 0.95)' : 'rgba(25, 25, 25, 0.95)';
            const nameOff = isDark ? 'rgba(255, 255, 255, 0.45)' : 'rgba(40, 40, 40, 0.85)';
            return `.bubble-button-card-container { position: relative !important; display: grid !important; grid-template-rows: auto auto 1fr auto !important; justify-items: center !important; align-items: center !important; text-align: center !important; min-height: 100px !important; padding: 8px 4px 8px 4px !important; border-radius: 14px !important; overflow: hidden !important; clip-path: inset(0 round 14px) !important; transition: transform 0.15s ease-out, border-color 0.3s ease, background 0.3s ease, box-shadow 0.3s ease !important; background: ${isOn ? surfaceOn : surfaceOff} !important; backdrop-filter: ${isOn ? 'blur(12px) saturate(140%)' : 'blur(8px) saturate(110%)'} !important; -webkit-backdrop-filter: ${isOn ? 'blur(12px) saturate(140%)' : 'blur(8px) saturate(110%)'} !important; border: ${isOn ? borderOn : borderOff} !important; box-shadow: ${isOn ? '0 4px 20px rgba(66, 133, 244, 0.10), inset 0 1px 0 rgba(255, 255, 255, 0.25)' : (isDark ? '0 1px 4px rgba(0, 0, 0, 0.15)' : '0 1px 6px rgba(0, 0, 0, 0.04), inset 0 1px 0 rgba(255, 255, 255, 0.15)')} !important; } .bubble-button-card-container:active { transform: scale(0.95) !important; } .bubble-content-container { display: grid !important; grid-template-rows: auto auto 1fr !important; justify-items: center !important; width: 100% !important; position: relative !important; z-index: 5 !important; padding-bottom: 8px !important; } .bubble-icon-container { min-width: 36px !important; min-height: 36px !important; grid-row: 1 !important; margin: 1px 0 2px 0 !important; border-radius: 50% !important; display: flex !important; align-items: center !important; justify-content: center !important; background: ${isOn ? 'rgba(66, 133, 244, 0.12)' : (isDark ? 'rgba(128, 128, 128, 0.06)' : 'rgba(120, 120, 125, 0.12)')} !important; border: ${isOn ? '1.5px solid rgba(66, 133, 244, 0.25)' : '1.5px solid rgba(120, 120, 125, 0.22)'} !important; backdrop-filter: blur(4px) !important; -webkit-backdrop-filter: blur(4px) !important; } .bubble-icon { --mdc-icon-size: 24px !important; color: ${isOn ? accentColor : (isDark ? 'rgba(255, 255, 255, 0.40)' : 'rgba(60, 60, 60, 0.55)')} !important; filter: ${isOn ? 'drop-shadow(0 0 6px rgba(66, 133, 244, 0.45))' : 'none'} !important; } .bubble-name-container { grid-row: 2 !important; margin: 0 !important; width: 100% !important; } .bubble-name { font-weight: 650 !important; font-size: 14px !important; line-height: 1.2 !important; justify-content: center !important; color: ${isOn ? nameOn : nameOff} !important; }`;
          })()}

card_mod:
  style: |
    :host {
      display: block !important;
      background: rgba(248, 248, 250, 0.98) !important;
      border-radius: 22px !important;
      padding: 4px 0 6px 0 !important;
      margin-bottom: 12px !important;
      box-shadow: 0 2px 16px rgba(0, 0, 0, 0.06) !important;
      border: 1px solid rgba(0, 0, 0, 0.04) !important;
      overflow: hidden !important;
    }
    @media (prefers-color-scheme: dark) {
      :host {
        background: rgba(28, 28, 30, 0.98) !important;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.35), inset 0 1px 0 rgba(255, 255, 255, 0.02) !important;
        border: 1px solid rgba(255, 255, 255, 0.04) !important;
      }
    }
    #root {
      gap: 0 !important;
    }
    #root > * {
      margin-top: 0 !important;
      margin-bottom: 0 !important;
    }
