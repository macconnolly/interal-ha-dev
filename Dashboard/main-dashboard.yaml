# Main Dashboard Layout - FULLY ASSEMBLED
# ═══════════════════════════════════════════════════════════════════════
# Complete dashboard with all card content inline (no placeholders)
#
# Structure:
#   1. Chips Status Bar - OAL status, weather, climate
#   2. Hero Cards - Lights control + Sonos control side-by-side
#   3. Room Cards - Living, Bedroom, Kitchen with full device control
#   4. Climate Card - HVAC control with dynamic state styling
#
# Design System:
#   - Orange accent: rgba(255, 149, 0, X) - Lights active
#   - Blue accent: rgba(66, 133, 244, X) - Sonos/Media active
#   - Purple accent: rgba(156, 39, 176, X) - Override/Manual control
#   - Coral dot: rgb(255, 110, 90) - Manual control indicator
#   - Glassmorphic: backdrop-filter blur, semi-transparent borders
# ═══════════════════════════════════════════════════════════════════════

title: Home
path: home
type: panel
cards:
  - type: custom:layout-card
    layout_type: custom:grid-layout
    layout:
      grid-template-columns: 1fr
      grid-template-rows: auto auto auto auto
      grid-template-areas: |
        "chips"
        "heroes"
        "rooms"
        "climate"
      gap: 16px
      padding: 16px 16px 80px 16px
      min-height: 100vh
    cards:
      # ═══════════════════════════════════════════════════════════════════
      # CHIPS STATUS BAR - Dynamic state-based styling
      # ═══════════════════════════════════════════════════════════════════
      - view_layout:
          grid-area: chips
        type: custom:bubble-card
        card_type: sub-buttons
        sub_button:
          main: []
          bottom:
            - name: Home Status Chips
              buttons_layout: inline
              group:
                - entity: sensor.oal_system_status
                  name: Adapting
                  show_name: true
                  show_icon: true
                  show_background: true
                  state_background: false
                  show_state: false
                  show_attribute: true
                  attribute: zones_adaptive
                  tap_action:
                    action: more-info
                  custom_height: 50
                  content_layout: icon-top
                - name: Boost
                  entity: sensor.oal_system_status
                  show_name: true
                  show_icon: true
                  show_background: true
                  state_background: true
                  show_attribute: true
                  attribute: total_modification
                  tap_action:
                    action: more-info
                  custom_height: 50
                  content_layout: icon-top
                - entity: sensor.oal_soonest_override
                  name: Timer
                  show_name: false
                  show_icon: true
                  show_background: true
                  state_background: true
                  show_state: true
                  icon: mdi:clock-time-eight-outline
                  tap_action:
                    action: more-info
                  custom_height: 50
                  content_layout: icon-top
                - entity: weather.home
                  name: Temperature
                  show_name: false
                  show_icon: true
                  show_background: true
                  state_background: true
                  show_state: false
                  show_attribute: true
                  attribute: temperature
                  icon: mdi:thermometer
                  tap_action:
                    action: more-info
                  custom_height: 50
                  content_layout: icon-top
                - entity: climate.dining_room
                  name: Climate
                  show_name: false
                  show_icon: true
                  show_background: true
                  state_background: true
                  show_state: false
                  show_attribute: true
                  attribute: current_temperature
                  icon: mdi:thermostat
                  tap_action:
                    action: more-info
                  custom_height: 50
                  content_layout: icon-top
          bottom_layout: inline
        rows: 1
        grid_options:
          columns: full
        styles: |
          ha-card {
            background: rgba(255, 255, 255, 0.08) !important;
            backdrop-filter: blur(8px) saturate(120%) !important;
            -webkit-backdrop-filter: blur(8px) saturate(120%) !important;
            border: 1px solid rgba(255, 255, 255, 0.12) !important;
            border-radius: 16px !important;
            padding: 12px 16px !important;
          }
          .bubble-sub-button-container {
            gap: 8px !important;
          }
          .bubble-sub-button {
            background: rgba(255, 255, 255, 0.08) !important;
            backdrop-filter: blur(6px) saturate(110%) !important;
            -webkit-backdrop-filter: blur(6px) saturate(110%) !important;
            border: 1px solid rgba(255, 255, 255, 0.12) !important;
            border-radius: 12px !important;
            padding: 8px 12px !important;
            transition: all 0.3s ease !important;
          }
          .bubble-sub-button:hover {
            background: rgba(255, 255, 255, 0.12) !important;
            border: 1px solid rgba(255, 255, 255, 0.18) !important;
          }
          /* OAL Status - Orange when active */
          ${(() => {
            const status = hass.states['sensor.oal_system_status']?.state || '';
            const isActive = !status.includes('Baseline');
            return `
              .bubble-sub-button-1 {
                background: ${isActive ? 'rgba(255, 149, 0, 0.15)' : 'rgba(255, 255, 255, 0.08)'} !important;
                border: ${isActive ? '1px solid rgba(255, 149, 0, 0.35)' : '1px solid rgba(255, 255, 255, 0.12)'} !important;
              }
              .bubble-sub-button-1 .bubble-icon {
                color: ${isActive ? 'rgba(255, 152, 0, 0.96)' : 'rgba(200, 200, 200, 0.8)'} !important;
              }
              .bubble-sub-button-1 .bubble-attribute {
                color: ${isActive ? 'rgba(255, 152, 0, 0.96)' : 'rgba(200, 200, 200, 0.8)'} !important;
                font-weight: 600 !important;
              }
            `;
          })()}
          /* Boost - Orange when boosted */
          ${(() => {
            const monitor = hass.states['sensor.oal_real_time_monitor']?.attributes || {};
            const boostSource = monitor['Boost source'] || 'Baseline';
            const isBoosted = boostSource !== 'Baseline';
            return `
              .bubble-sub-button-2 {
                background: ${isBoosted ? 'rgba(255, 149, 0, 0.15)' : 'rgba(255, 255, 255, 0.08)'} !important;
                border: ${isBoosted ? '1px solid rgba(255, 149, 0, 0.35)' : '1px solid rgba(255, 255, 255, 0.12)'} !important;
              }
              .bubble-sub-button-2 .bubble-icon {
                color: ${isBoosted ? 'rgba(255, 152, 0, 0.96)' : 'rgba(200, 200, 200, 0.8)'} !important;
              }
              .bubble-sub-button-2 .bubble-attribute {
                color: ${isBoosted ? 'rgba(255, 152, 0, 0.96)' : 'rgba(200, 200, 200, 0.8)'} !important;
                font-weight: 600 !important;
              }
            `;
          })()}
          /* Manual Control Timer - Purple when active */
          ${(() => {
            const soonest = hass.states['sensor.oal_soonest_override'];
            const timeVal = soonest?.state || 'None';
            const hasManual = timeVal !== 'None' && timeVal !== 'unknown' && timeVal !== 'unavailable';
            return `
              .bubble-sub-button-3 {
                background: ${hasManual ? 'rgba(156, 39, 176, 0.15)' : 'rgba(255, 255, 255, 0.08)'} !important;
                border: ${hasManual ? '1px solid rgba(156, 39, 176, 0.35)' : '1px solid rgba(255, 255, 255, 0.12)'} !important;
              }
              .bubble-sub-button-3 .bubble-icon {
                color: ${hasManual ? 'rgba(156, 39, 176, 0.96)' : 'rgba(200, 200, 200, 0.8)'} !important;
              }
              .bubble-sub-button-3 .bubble-state {
                color: ${hasManual ? 'rgba(156, 39, 176, 0.96)' : 'rgba(200, 200, 200, 0.8)'} !important;
                font-weight: 600 !important;
              }
            `;
          })()}
          /* Weather and Climate chips - neutral gray */
          .bubble-sub-button-4 .bubble-icon,
          .bubble-sub-button-5 .bubble-icon {
            color: rgba(200, 200, 200, 0.8) !important;
          }
          .bubble-sub-button-4 .bubble-attribute,
          .bubble-sub-button-5 .bubble-attribute {
            color: rgba(200, 200, 200, 0.9) !important;
            font-weight: 600 !important;
          }

      # ═══════════════════════════════════════════════════════════════════
      # HEROES CONTAINER (Lights + Sonos) - Side by side on desktop
      # ═══════════════════════════════════════════════════════════════════
      - view_layout:
          grid-area: heroes
        type: custom:layout-card
        layout_type: custom:grid-layout
        layout:
          grid-template-columns: 1fr 1fr
          grid-template-areas: |
            "lights sonos"
          gap: 16px
        mediaquery:
          "(max-width: 1000px)":
            grid-template-columns: 1fr
            grid-template-areas: |
              "lights"
              "sonos"
        cards:
          # ═══════════════════════════════════════════════════════════════
          # HERO LIGHTS CARD - Quick actions + Zone tiles
          # ═══════════════════════════════════════════════════════════════
          - view_layout:
              grid-area: lights
            type: vertical-stack
            cards:
              - type: custom:bubble-card
                card_type: button
                button_type: name
                card_layout: large
                show_icon: false
                show_name: false
                show_state: false
                sub_button:
                  main:
                    - name: Quick Controls
                      buttons_layout: inline
                      group:
                        - entity: light.all_adaptive_lights
                          name: All
                          icon: mdi:lightbulb-group
                          show_name: false
                          show_icon: true
                          show_background: true
                          state_background: false
                          custom_height: 38
                          fill_width: false
                          tap_action:
                            action: toggle
                          hold_action:
                            action: more-info
                        - entity: input_select.oal_active_configuration
                          name: Config
                          icon: mdi:tune-variant
                          show_name: false
                          show_icon: true
                          show_background: true
                          state_background: false
                          custom_height: 38
                          fill_width: false
                          tap_action:
                            action: more-info
                          hold_action:
                            action: more-info
                        - entity: script.oal_reset_soft
                          name: Reset
                          icon: mdi:refresh
                          show_name: false
                          show_icon: true
                          show_background: true
                          state_background: false
                          custom_height: 38
                          fill_width: false
                          visibility:
                            - condition: template
                              value_template: >-
                                {% set zones = [
                                  'switch.adaptive_lighting_main_living',
                                  'switch.adaptive_lighting_kitchen_island',
                                  'switch.adaptive_lighting_bedroom_primary',
                                  'switch.adaptive_lighting_accent_spots',
                                  'switch.adaptive_lighting_recessed_ceiling',
                                  'switch.adaptive_lighting_column_lights'
                                ] %} {% set manual_count = namespace(value=0) %} {% for zone
                                in zones %}
                                  {% set manual_count.value = manual_count.value + (state_attr(zone, 'manual_control') | default([]) | length) %}
                                {% endfor %} {{ manual_count.value > 0 }}
                          tap_action:
                            action: perform-action
                            perform_action: script.oal_reset_soft
                            target: {}
                        - entity: script.oal_global_manual_warmer
                          name: Warmer
                          icon: mdi:thermometer-minus
                          show_name: false
                          show_icon: true
                          show_background: true
                          state_background: false
                          custom_height: 38
                          fill_width: false
                          tap_action:
                            action: perform-action
                            perform_action: script.oal_global_manual_warmer
                            target: {}
                          hold_action:
                            action: perform-action
                            perform_action: script.oal_global_manual_cooler
                            target: {}
                        - entity: script.oal_global_manual_dimmer
                          name: Dimmer
                          icon: mdi:brightness-4
                          show_name: false
                          show_icon: true
                          show_background: true
                          state_background: false
                          custom_height: 38
                          fill_width: false
                          tap_action:
                            action: perform-action
                            perform_action: script.oal_global_manual_dimmer
                            target: {}
                          hold_action:
                            action: perform-action
                            perform_action: script.oal_global_manual_brighter
                            target: {}
                        - entity: media_player.living_room
                          name: Media
                          icon: mdi:play-pause
                          show_name: false
                          show_icon: true
                          show_background: true
                          state_background: false
                          custom_height: 38
                          fill_width: false
                          visibility:
                            - condition: template
                              value_template: >-
                                {% set players = [
                                  'media_player.living_room',
                                  'media_player.kitchen',
                                  'media_player.bedroom',
                                  'media_player.bath',
                                  'media_player.dining_room'
                                ] %} {{ players | map('states') | select('in', ['playing',
                                'paused']) | list | length > 0 }}
                          tap_action:
                            action: perform-action
                            perform_action: media_player.media_play_pause
                            target:
                              entity_id: media_player.living_room
                        - entity: sensor.sonos_next_alarm_chip
                          name: Alarm
                          icon: mdi:alarm
                          show_name: true
                          show_icon: true
                          show_background: true
                          state_background: false
                          custom_height: 38
                          fill_width: false
                          visibility:
                            - condition: template
                              value_template: "{{ states('sensor.sonos_next_alarm_chip') != 'None' }}"
                          tap_action:
                            action: perform-action
                            perform_action: script.sonos_toggle_next_alarm
                            target: {}
                          hold_action:
                            action: more-info
                        - entity: binary_sensor.sonos_living_room_in_playing_group
                          name: Speakers
                          icon: mdi:speaker-multiple
                          show_name: false
                          show_icon: true
                          show_background: true
                          state_background: false
                          custom_height: 38
                          fill_width: false
                          visibility:
                            - condition: template
                              value_template: >-
                                {% set sensors = [
                                  'binary_sensor.sonos_living_room_in_playing_group',
                                  'binary_sensor.sonos_dining_room_in_playing_group',
                                  'binary_sensor.sonos_kitchen_in_playing_group',
                                  'binary_sensor.sonos_bath_in_playing_group',
                                  'binary_sensor.sonos_bedroom_in_playing_group'
                                ] %}
                                {{ sensors | select('is_state', 'on') | list | length > 0 }}
                          tap_action:
                            action: perform-action
                            perform_action: script.sonos_toggle_group_membership
                            target: {}
                          hold_action:
                            action: more-info
                            entity: media_player.living_room
                styles: >
                  :host {
                    position: relative !important;
                    z-index: 100 !important;
                    overflow: visible !important;
                  }
                  ha-card {
                    background: transparent !important;
                    border: none !important;
                    box-shadow: none !important;
                    margin: 0 !important;
                    padding: 12px 16px 4px 16px !important;
                  }
                  .bubble-button-card-container {
                    background: transparent !important;
                  }
                  .bubble-sub-button-container {
                    background: rgba(255, 255, 255, 0.06) !important;
                    backdrop-filter: blur(6px) saturate(120%) !important;
                    -webkit-backdrop-filter: blur(6px) saturate(120%) !important;
                    border-radius: 12px !important;
                    border: 1px solid rgba(255, 255, 255, 0.12) !important;
                    padding: 6px 10px !important;
                    margin: 0 !important;
                    box-shadow: none !important;
                    width: fit-content !important;
                    margin-left: auto !important;
                  }
                  .bubble-sub-button-1,
                  .bubble-sub-button-2,
                  .bubble-sub-button-3,
                  .bubble-sub-button-4,
                  .bubble-sub-button-5,
                  .bubble-sub-button-6,
                  .bubble-sub-button-7,
                  .bubble-sub-button-8 {
                    background: rgba(255, 255, 255, 0.10) !important;
                    border: 1px solid rgba(255, 255, 255, 0.12) !important;
                    border-radius: 8px !important;
                  }
                  /* Sub-button 1: All Lights - dynamic on/off styling */
                  .bubble-sub-button-1 {
                    background: ${hass.states['light.all_adaptive_lights']?.state === 'on'
                      ? 'rgba(255, 255, 255, 0.18)'
                      : 'rgba(255, 255, 255, 0.10)'} !important;
                    border: ${hass.states['light.all_adaptive_lights']?.state === 'on'
                      ? '1px solid rgba(255, 149, 0, 0.4)'
                      : '1px solid rgba(255, 255, 255, 0.12)'} !important;
                  }
                  .bubble-sub-button-1 .bubble-sub-button-icon {
                    color: ${hass.states['light.all_adaptive_lights']?.state === 'on'
                      ? 'rgb(255, 149, 0)'
                      : 'rgba(80, 80, 80, 0.7)'} !important;
                    --mdc-icon-size: 20px !important;
                  }
                  /* Sub-button 4 & 5: Warmer/Dimmer - Orange accent */
                  .bubble-sub-button-4 .bubble-sub-button-icon,
                  .bubble-sub-button-5 .bubble-sub-button-icon {
                    color: rgba(255, 149, 0, 0.8) !important;
                    --mdc-icon-size: 18px !important;
                  }
                  .bubble-sub-button-4:hover,
                  .bubble-sub-button-5:hover {
                    background: rgba(255, 149, 0, 0.15) !important;
                    border: 1px solid rgba(255, 149, 0, 0.3) !important;
                  }
              # Zone Tiles Row 1
              - type: horizontal-stack
                cards:
                  - type: custom:bubble-card
                    card_type: button
                    button_type: slider
                    entity: light.living_room_lights
                    name: Living
                    icon: mdi:sofa
                    show_state: false
                    show_attribute: true
                    attribute: brightness
                    scrolling_effect: false
                    tap_action:
                      action: toggle
                    hold_action:
                      action: more-info
                    double_tap_action:
                      action: call-service
                      service: light.turn_on
                      target:
                        entity_id: light.living_room_lights
                      data:
                        brightness_pct: 100
                    card_mod:
                      style: |
                        ha-card {
                          background: transparent !important;
                          border: none !important;
                          box-shadow: none !important;
                          max-width: clamp(95px, 22vw, 140px) !important;
                          margin: 0 auto !important;
                        }
                    styles: >-
                      .bubble-button-card-container {
                        position: relative !important;
                        display: grid !important;
                        grid-template-rows: auto auto 1fr auto !important;
                        justify-items: center !important;
                        align-items: center !important;
                        text-align: center !important;
                        min-height: 76px !important;
                        padding: 14px 6px 5px 6px !important;
                        border-radius: 14px !important;
                        overflow: hidden !important;
                        clip-path: inset(0 round 14px) !important;
                        transition: transform 0.1s ease-out, border-color 0.15s ease, background 0.2s ease !important;
                        background: ${state === 'on'
                          ? 'rgba(255, 255, 255, 0.20)'
                          : 'rgba(255, 255, 255, 0.12)'} !important;
                        backdrop-filter: blur(3px) !important;
                        -webkit-backdrop-filter: blur(3px) !important;
                        border: ${state === 'on'
                          ? '1px solid rgba(255, 149, 0, 0.6)'
                          : '1px solid rgba(120, 120, 120, 0.55)'} !important;
                        box-shadow: ${state === 'on'
                          ? '0 2px 10px rgba(255, 149, 0, 0.10)'
                          : 'none'} !important;
                      }
                      .bubble-button-card-container:active { transform: scale(0.95) !important; }
                      .bubble-content-container {
                        display: grid !important;
                        grid-template-rows: auto auto 1fr !important;
                        justify-items: center !important;
                        width: 100% !important;
                        position: relative !important;
                        z-index: 5 !important;
                        padding-bottom: 10px !important;
                      }
                      .bubble-button-card-container::after {
                        content: '' !important;
                        position: absolute !important;
                        top: 5px !important;
                        right: 5px !important;
                        width: ${(hass.states['switch.adaptive_lighting_main_living']?.attributes?.manual_control?.length > 0) ? '7px' : '0px'} !important;
                        height: ${(hass.states['switch.adaptive_lighting_main_living']?.attributes?.manual_control?.length > 0) ? '7px' : '0px'} !important;
                        border-radius: 50% !important;
                        background: rgb(255, 110, 90) !important;
                        border: 1px solid rgba(255, 255, 255, 0.6) !important;
                        box-shadow: 0 0 4px rgba(255, 110, 90, 0.5) !important;
                        transition: width 0.2s ease, height 0.2s ease !important;
                        z-index: 25 !important;
                      }
                      .bubble-icon-container {
                        min-width: 28px !important;
                        min-height: 28px !important;
                        grid-row: 1 !important;
                        margin: 8px 0 6px 0 !important;
                        border-radius: 50% !important;
                        display: flex !important;
                        align-items: center !important;
                        justify-content: center !important;
                        background: ${state === 'on'
                          ? 'rgba(255, 149, 0, 0.22)'
                          : 'rgba(60, 60, 60, 0.30)'} !important;
                        border: ${state === 'on'
                          ? '1px solid rgba(255, 149, 0, 0.35)'
                          : '1px solid rgba(60, 60, 60, 0.40)'} !important;
                      }
                      .bubble-icon {
                        --mdc-icon-size: 20px !important;
                        color: ${state === 'on'
                          ? 'rgb(255, 149, 0)'
                          : 'rgba(40, 40, 40, 0.80)'} !important;
                        filter: ${state === 'on' ? 'drop-shadow(0 0 3px rgba(255, 149, 0, 0.35))' : 'none'} !important;
                      }
                      .bubble-name-container {
                        grid-row: 2 !important;
                        margin: 0 !important;
                        width: 100% !important;
                      }
                      .bubble-name {
                        font-weight: 700 !important;
                        font-size: 14px !important;
                        text-transform: uppercase !important;
                        letter-spacing: 0.5px !important;
                        line-height: 1.1 !important;
                        justify-content: center !important;
                        margin: 0 4px !important;
                        text-shadow: 0 1px 2px rgba(255, 255, 255, 0.6) !important;
                        color: ${state === 'on'
                          ? 'rgba(40, 40, 40, 0.95)'
                          : 'rgba(50, 50, 50, 0.75)'} !important;
                      }
                      .bubble-attribute {
                        font-size: 12px !important;
                        font-weight: 600 !important;
                        margin-top: 1px !important;
                        justify-content: center !important;
                        color: ${state === 'on'
                          ? 'rgb(255, 149, 0)'
                          : 'rgba(60, 60, 60, 0.7)'} !important;
                      }
                      .bubble-range-slider {
                        position: absolute !important;
                        bottom: 4px !important;
                        left: 0 !important;
                        right: 0 !important;
                        margin: 0 auto !important;
                        width: 60% !important;
                        height: 3px !important;
                        border-radius: 3px !important;
                        z-index: 10 !important;
                        background: ${state === 'on'
                          ? 'rgba(0, 0, 0, 0.08)'
                          : 'transparent'} !important;
                        overflow: hidden !important;
                        opacity: ${state === 'on' ? '1' : '0'} !important;
                        transition: opacity 0.2s ease !important;
                      }
                      .bubble-range-fill {
                        height: 3px !important;
                        border-radius: 3px !important;
                        background: rgb(255, 149, 0) !important;
                      }
                      .bubble-range-value {
                        position: fixed !important;
                        top: 4px !important;
                        right: 5px !important;
                        font-size: 9px !important;
                        font-weight: 600 !important;
                        color: rgba(50, 50, 50, 0.9) !important;
                        opacity: 0 !important;
                        transition: opacity 0.15s ease !important;
                        z-index: 20 !important;
                      }
                      .is-dragging .bubble-range-value { opacity: 1 !important; }
                      .is-dragging .bubble-attribute { opacity: 0 !important; }
                  - type: custom:bubble-card
                    card_type: button
                    button_type: slider
                    entity: light.all_kitchen_lights
                    name: Kitchen
                    icon: mdi:countertop
                    show_state: false
                    show_attribute: true
                    attribute: brightness
                    scrolling_effect: false
                    tap_action:
                      action: toggle
                    hold_action:
                      action: more-info
                    double_tap_action:
                      action: call-service
                      service: light.turn_on
                      target:
                        entity_id: light.all_kitchen_lights
                      data:
                        brightness_pct: 100
                    card_mod:
                      style: |
                        ha-card {
                          background: transparent !important;
                          border: none !important;
                          box-shadow: none !important;
                          max-width: clamp(95px, 22vw, 140px) !important;
                          margin: 0 auto !important;
                        }
                    styles: >-
                      .bubble-button-card-container {
                        position: relative !important;
                        display: grid !important;
                        grid-template-rows: auto auto 1fr auto !important;
                        justify-items: center !important;
                        align-items: center !important;
                        text-align: center !important;
                        min-height: 76px !important;
                        padding: 14px 6px 5px 6px !important;
                        border-radius: 14px !important;
                        overflow: hidden !important;
                        clip-path: inset(0 round 14px) !important;
                        transition: transform 0.1s ease-out, border-color 0.15s ease, background 0.2s ease !important;
                        background: ${state === 'on'
                          ? 'rgba(255, 255, 255, 0.20)'
                          : 'rgba(255, 255, 255, 0.12)'} !important;
                        backdrop-filter: blur(3px) !important;
                        -webkit-backdrop-filter: blur(3px) !important;
                        border: ${state === 'on'
                          ? '1px solid rgba(255, 149, 0, 0.6)'
                          : '1px solid rgba(120, 120, 120, 0.55)'} !important;
                        box-shadow: ${state === 'on'
                          ? '0 2px 10px rgba(255, 149, 0, 0.10)'
                          : 'none'} !important;
                      }
                      .bubble-button-card-container:active { transform: scale(0.95) !important; }
                      .bubble-content-container {
                        display: grid !important;
                        grid-template-rows: auto auto 1fr !important;
                        justify-items: center !important;
                        width: 100% !important;
                        position: relative !important;
                        z-index: 5 !important;
                        padding-bottom: 10px !important;
                      }
                      .bubble-button-card-container::after {
                        content: '' !important;
                        position: absolute !important;
                        top: 5px !important;
                        right: 5px !important;
                        width: ${(hass.states['switch.adaptive_lighting_kitchen_island']?.attributes?.manual_control?.length > 0) ? '7px' : '0px'} !important;
                        height: ${(hass.states['switch.adaptive_lighting_kitchen_island']?.attributes?.manual_control?.length > 0) ? '7px' : '0px'} !important;
                        border-radius: 50% !important;
                        background: rgb(255, 110, 90) !important;
                        border: 1px solid rgba(255, 255, 255, 0.6) !important;
                        box-shadow: 0 0 4px rgba(255, 110, 90, 0.5) !important;
                        transition: width 0.2s ease, height 0.2s ease !important;
                        z-index: 25 !important;
                      }
                      .bubble-icon-container {
                        min-width: 28px !important;
                        min-height: 28px !important;
                        grid-row: 1 !important;
                        margin: 8px 0 6px 0 !important;
                        border-radius: 50% !important;
                        display: flex !important;
                        align-items: center !important;
                        justify-content: center !important;
                        background: ${state === 'on'
                          ? 'rgba(255, 149, 0, 0.22)'
                          : 'rgba(60, 60, 60, 0.30)'} !important;
                        border: ${state === 'on'
                          ? '1px solid rgba(255, 149, 0, 0.35)'
                          : '1px solid rgba(60, 60, 60, 0.40)'} !important;
                      }
                      .bubble-icon {
                        --mdc-icon-size: 20px !important;
                        color: ${state === 'on'
                          ? 'rgb(255, 149, 0)'
                          : 'rgba(40, 40, 40, 0.80)'} !important;
                        filter: ${state === 'on' ? 'drop-shadow(0 0 3px rgba(255, 149, 0, 0.35))' : 'none'} !important;
                      }
                      .bubble-name-container {
                        grid-row: 2 !important;
                        margin: 0 !important;
                        width: 100% !important;
                      }
                      .bubble-name {
                        font-weight: 700 !important;
                        font-size: 14px !important;
                        text-transform: uppercase !important;
                        letter-spacing: 0.5px !important;
                        line-height: 1.1 !important;
                        justify-content: center !important;
                        margin: 0 4px !important;
                        text-shadow: 0 1px 2px rgba(255, 255, 255, 0.6) !important;
                        color: ${state === 'on'
                          ? 'rgba(40, 40, 40, 0.95)'
                          : 'rgba(50, 50, 50, 0.75)'} !important;
                      }
                      .bubble-attribute {
                        font-size: 12px !important;
                        font-weight: 600 !important;
                        margin-top: 1px !important;
                        justify-content: center !important;
                        color: ${state === 'on'
                          ? 'rgb(255, 149, 0)'
                          : 'rgba(60, 60, 60, 0.7)'} !important;
                      }
                      .bubble-range-slider {
                        position: absolute !important;
                        bottom: 4px !important;
                        left: 0 !important;
                        right: 0 !important;
                        margin: 0 auto !important;
                        width: 60% !important;
                        height: 3px !important;
                        border-radius: 3px !important;
                        z-index: 10 !important;
                        background: ${state === 'on'
                          ? 'rgba(0, 0, 0, 0.08)'
                          : 'transparent'} !important;
                        overflow: hidden !important;
                        opacity: ${state === 'on' ? '1' : '0'} !important;
                        transition: opacity 0.2s ease !important;
                      }
                      .bubble-range-fill {
                        height: 3px !important;
                        border-radius: 3px !important;
                        background: rgb(255, 149, 0) !important;
                      }
                      .bubble-range-value {
                        position: fixed !important;
                        top: 4px !important;
                        right: 5px !important;
                        font-size: 9px !important;
                        font-weight: 600 !important;
                        color: rgba(50, 50, 50, 0.9) !important;
                        opacity: 0 !important;
                        transition: opacity 0.15s ease !important;
                        z-index: 20 !important;
                      }
                      .is-dragging .bubble-range-value { opacity: 1 !important; }
                      .is-dragging .bubble-attribute { opacity: 0 !important; }
                  - type: custom:bubble-card
                    card_type: button
                    button_type: slider
                    entity: light.bedroom_primary_lights
                    name: Bedroom
                    icon: mdi:bed
                    show_state: false
                    show_attribute: true
                    attribute: brightness
                    scrolling_effect: false
                    tap_action:
                      action: toggle
                    hold_action:
                      action: more-info
                    double_tap_action:
                      action: call-service
                      service: light.turn_on
                      target:
                        entity_id: light.bedroom_primary_lights
                      data:
                        brightness_pct: 100
                    card_mod:
                      style: |
                        ha-card {
                          background: transparent !important;
                          border: none !important;
                          box-shadow: none !important;
                          max-width: clamp(95px, 22vw, 140px) !important;
                          margin: 0 auto !important;
                        }
                    styles: >-
                      .bubble-button-card-container {
                        position: relative !important;
                        display: grid !important;
                        grid-template-rows: auto auto 1fr auto !important;
                        justify-items: center !important;
                        align-items: center !important;
                        text-align: center !important;
                        min-height: 76px !important;
                        padding: 14px 6px 5px 6px !important;
                        border-radius: 14px !important;
                        overflow: hidden !important;
                        clip-path: inset(0 round 14px) !important;
                        transition: transform 0.1s ease-out, border-color 0.15s ease, background 0.2s ease !important;
                        background: ${state === 'on'
                          ? 'rgba(255, 255, 255, 0.20)'
                          : 'rgba(255, 255, 255, 0.12)'} !important;
                        backdrop-filter: blur(3px) !important;
                        -webkit-backdrop-filter: blur(3px) !important;
                        border: ${state === 'on'
                          ? '1px solid rgba(255, 149, 0, 0.6)'
                          : '1px solid rgba(120, 120, 120, 0.55)'} !important;
                        box-shadow: ${state === 'on'
                          ? '0 2px 10px rgba(255, 149, 0, 0.10)'
                          : 'none'} !important;
                      }
                      .bubble-button-card-container:active { transform: scale(0.95) !important; }
                      .bubble-content-container {
                        display: grid !important;
                        grid-template-rows: auto auto 1fr !important;
                        justify-items: center !important;
                        width: 100% !important;
                        position: relative !important;
                        z-index: 5 !important;
                        padding-bottom: 10px !important;
                      }
                      .bubble-button-card-container::after {
                        content: '' !important;
                        position: absolute !important;
                        top: 5px !important;
                        right: 5px !important;
                        width: ${(hass.states['switch.adaptive_lighting_bedroom_primary']?.attributes?.manual_control?.length > 0) ? '7px' : '0px'} !important;
                        height: ${(hass.states['switch.adaptive_lighting_bedroom_primary']?.attributes?.manual_control?.length > 0) ? '7px' : '0px'} !important;
                        border-radius: 50% !important;
                        background: rgb(255, 110, 90) !important;
                        border: 1px solid rgba(255, 255, 255, 0.6) !important;
                        box-shadow: 0 0 4px rgba(255, 110, 90, 0.5) !important;
                        transition: width 0.2s ease, height 0.2s ease !important;
                        z-index: 25 !important;
                      }
                      .bubble-icon-container {
                        min-width: 28px !important;
                        min-height: 28px !important;
                        grid-row: 1 !important;
                        margin: 8px 0 6px 0 !important;
                        border-radius: 50% !important;
                        display: flex !important;
                        align-items: center !important;
                        justify-content: center !important;
                        background: ${state === 'on'
                          ? 'rgba(255, 149, 0, 0.22)'
                          : 'rgba(60, 60, 60, 0.30)'} !important;
                        border: ${state === 'on'
                          ? '1px solid rgba(255, 149, 0, 0.35)'
                          : '1px solid rgba(60, 60, 60, 0.40)'} !important;
                      }
                      .bubble-icon {
                        --mdc-icon-size: 20px !important;
                        color: ${state === 'on'
                          ? 'rgb(255, 149, 0)'
                          : 'rgba(40, 40, 40, 0.80)'} !important;
                        filter: ${state === 'on' ? 'drop-shadow(0 0 3px rgba(255, 149, 0, 0.35))' : 'none'} !important;
                      }
                      .bubble-name-container {
                        grid-row: 2 !important;
                        margin: 0 !important;
                        width: 100% !important;
                      }
                      .bubble-name {
                        font-weight: 700 !important;
                        font-size: 14px !important;
                        text-transform: uppercase !important;
                        letter-spacing: 0.5px !important;
                        line-height: 1.1 !important;
                        justify-content: center !important;
                        margin: 0 4px !important;
                        text-shadow: 0 1px 2px rgba(255, 255, 255, 0.6) !important;
                        color: ${state === 'on'
                          ? 'rgba(40, 40, 40, 0.95)'
                          : 'rgba(50, 50, 50, 0.75)'} !important;
                      }
                      .bubble-attribute {
                        font-size: 12px !important;
                        font-weight: 600 !important;
                        margin-top: 1px !important;
                        justify-content: center !important;
                        color: ${state === 'on'
                          ? 'rgb(255, 149, 0)'
                          : 'rgba(60, 60, 60, 0.7)'} !important;
                      }
                      .bubble-range-slider {
                        position: absolute !important;
                        bottom: 4px !important;
                        left: 0 !important;
                        right: 0 !important;
                        margin: 0 auto !important;
                        width: 60% !important;
                        height: 3px !important;
                        border-radius: 3px !important;
                        z-index: 10 !important;
                        background: ${state === 'on'
                          ? 'rgba(0, 0, 0, 0.08)'
                          : 'transparent'} !important;
                        overflow: hidden !important;
                        opacity: ${state === 'on' ? '1' : '0'} !important;
                        transition: opacity 0.2s ease !important;
                      }
                      .bubble-range-fill {
                        height: 3px !important;
                        border-radius: 3px !important;
                        background: rgb(255, 149, 0) !important;
                      }
                      .bubble-range-value {
                        position: fixed !important;
                        top: 4px !important;
                        right: 5px !important;
                        font-size: 9px !important;
                        font-weight: 600 !important;
                        color: rgba(50, 50, 50, 0.9) !important;
                        opacity: 0 !important;
                        transition: opacity 0.15s ease !important;
                        z-index: 20 !important;
                      }
                      .is-dragging .bubble-range-value { opacity: 1 !important; }
                      .is-dragging .bubble-attribute { opacity: 0 !important; }
                card_mod:
                  style: |
                    hui-horizontal-stack-card {
                      display: block !important;
                    }
                    #root {
                      display: flex !important;
                      justify-content: center !important;
                      align-items: stretch !important;
                      gap: 14px !important;
                      padding: 8px 20px !important;
                    }
                    #root > * {
                      flex: 1 1 0px !important;
                      max-width: 140px !important;
                      min-width: 0px !important;
                    }
              # Zone Tiles Row 2
              - type: horizontal-stack
                card_mod:
                  style: |
                    hui-horizontal-stack-card {
                      display: block !important;
                    }
                    #root {
                      display: flex !important;
                      justify-content: center !important;
                      align-items: stretch !important;
                      gap: 14px !important;
                      padding: 6px 20px 12px 20px !important;
                    }
                    #root > * {
                      flex: 1 1 0px !important;
                      max-width: 140px !important;
                      min-width: 0px !important;
                    }
                cards:
                  - type: custom:bubble-card
                    card_type: button
                    button_type: slider
                    entity: light.accent_spots_lights
                    name: Spots
                    icon: mdi:track-light
                    show_state: false
                    show_attribute: true
                    attribute: brightness
                    scrolling_effect: false
                    tap_action:
                      action: toggle
                    hold_action:
                      action: more-info
                    double_tap_action:
                      action: call-service
                      service: light.turn_on
                      target:
                        entity_id: light.accent_spots_lights
                      data:
                        brightness_pct: 100
                    card_mod:
                      style: |
                        ha-card {
                          background: transparent !important;
                          border: none !important;
                          box-shadow: none !important;
                          max-width: clamp(95px, 22vw, 140px) !important;
                          margin: 0 auto !important;
                        }
                    styles: >-
                      .bubble-button-card-container {
                        position: relative !important;
                        display: grid !important;
                        grid-template-rows: auto auto 1fr auto !important;
                        justify-items: center !important;
                        align-items: center !important;
                        text-align: center !important;
                        min-height: 76px !important;
                        padding: 14px 6px 5px 6px !important;
                        border-radius: 14px !important;
                        overflow: hidden !important;
                        clip-path: inset(0 round 14px) !important;
                        transition: transform 0.1s ease-out, border-color 0.15s ease, background 0.2s ease !important;
                        background: ${state === 'on' ? 'rgba(255, 255, 255, 0.20)' : 'rgba(255, 255, 255, 0.12)'} !important;
                        backdrop-filter: blur(3px) !important;
                        border: ${state === 'on' ? '1px solid rgba(255, 149, 0, 0.6)' : '1px solid rgba(120, 120, 120, 0.55)'} !important;
                        box-shadow: ${state === 'on' ? '0 2px 10px rgba(255, 149, 0, 0.10)' : 'none'} !important;
                      }
                      .bubble-button-card-container:active { transform: scale(0.95) !important; }
                      .bubble-button-card-container::after {
                        content: '' !important;
                        position: absolute !important;
                        top: 5px !important;
                        right: 5px !important;
                        width: ${(hass.states['switch.adaptive_lighting_accent_spots']?.attributes?.manual_control?.length > 0) ? '7px' : '0px'} !important;
                        height: ${(hass.states['switch.adaptive_lighting_accent_spots']?.attributes?.manual_control?.length > 0) ? '7px' : '0px'} !important;
                        border-radius: 50% !important;
                        background: rgb(255, 110, 90) !important;
                        border: 1px solid rgba(255, 255, 255, 0.6) !important;
                        z-index: 25 !important;
                      }
                      .bubble-icon-container {
                        min-width: 28px !important;
                        min-height: 28px !important;
                        margin: 8px 0 6px 0 !important;
                        border-radius: 50% !important;
                        background: ${state === 'on' ? 'rgba(255, 149, 0, 0.22)' : 'rgba(60, 60, 60, 0.30)'} !important;
                        border: ${state === 'on' ? '1px solid rgba(255, 149, 0, 0.35)' : '1px solid rgba(60, 60, 60, 0.40)'} !important;
                      }
                      .bubble-icon {
                        --mdc-icon-size: 20px !important;
                        color: ${state === 'on' ? 'rgb(255, 149, 0)' : 'rgba(40, 40, 40, 0.80)'} !important;
                      }
                      .bubble-name {
                        font-weight: 700 !important;
                        font-size: 14px !important;
                        text-transform: uppercase !important;
                        color: ${state === 'on' ? 'rgba(40, 40, 40, 0.95)' : 'rgba(50, 50, 50, 0.75)'} !important;
                      }
                      .bubble-attribute {
                        font-size: 12px !important;
                        font-weight: 600 !important;
                        color: ${state === 'on' ? 'rgb(255, 149, 0)' : 'rgba(60, 60, 60, 0.7)'} !important;
                      }
                      .bubble-range-slider {
                        position: absolute !important;
                        bottom: 4px !important;
                        width: 60% !important;
                        height: 3px !important;
                        opacity: ${state === 'on' ? '1' : '0'} !important;
                      }
                      .bubble-range-fill {
                        background: rgb(255, 149, 0) !important;
                      }
                  - type: custom:bubble-card
                    card_type: button
                    button_type: slider
                    entity: light.overhead_lights
                    name: Ceiling
                    icon: mdi:ceiling-light
                    show_state: false
                    show_attribute: true
                    attribute: brightness
                    scrolling_effect: false
                    tap_action:
                      action: toggle
                    hold_action:
                      action: more-info
                    double_tap_action:
                      action: call-service
                      service: light.turn_on
                      target:
                        entity_id: light.overhead_lights
                      data:
                        brightness_pct: 100
                    card_mod:
                      style: |
                        ha-card {
                          background: transparent !important;
                          border: none !important;
                          box-shadow: none !important;
                          max-width: clamp(95px, 22vw, 140px) !important;
                          margin: 0 auto !important;
                        }
                    styles: >-
                      .bubble-button-card-container {
                        position: relative !important;
                        display: grid !important;
                        min-height: 76px !important;
                        padding: 14px 6px 5px 6px !important;
                        border-radius: 14px !important;
                        overflow: hidden !important;
                        background: ${state === 'on' ? 'rgba(255, 255, 255, 0.20)' : 'rgba(255, 255, 255, 0.12)'} !important;
                        backdrop-filter: blur(3px) !important;
                        border: ${state === 'on' ? '1px solid rgba(255, 149, 0, 0.6)' : '1px solid rgba(120, 120, 120, 0.55)'} !important;
                      }
                      .bubble-button-card-container:active { transform: scale(0.95) !important; }
                      .bubble-button-card-container::after {
                        content: '' !important;
                        position: absolute !important;
                        top: 5px !important;
                        right: 5px !important;
                        width: ${(hass.states['switch.adaptive_lighting_recessed_ceiling']?.attributes?.manual_control?.length > 0) ? '7px' : '0px'} !important;
                        height: ${(hass.states['switch.adaptive_lighting_recessed_ceiling']?.attributes?.manual_control?.length > 0) ? '7px' : '0px'} !important;
                        border-radius: 50% !important;
                        background: rgb(255, 110, 90) !important;
                        z-index: 25 !important;
                      }
                      .bubble-icon-container {
                        min-width: 28px !important;
                        min-height: 28px !important;
                        margin: 8px 0 6px 0 !important;
                        border-radius: 50% !important;
                        background: ${state === 'on' ? 'rgba(255, 149, 0, 0.22)' : 'rgba(60, 60, 60, 0.30)'} !important;
                      }
                      .bubble-icon {
                        --mdc-icon-size: 20px !important;
                        color: ${state === 'on' ? 'rgb(255, 149, 0)' : 'rgba(40, 40, 40, 0.80)'} !important;
                      }
                      .bubble-name {
                        font-weight: 700 !important;
                        font-size: 14px !important;
                        text-transform: uppercase !important;
                        color: ${state === 'on' ? 'rgba(40, 40, 40, 0.95)' : 'rgba(50, 50, 50, 0.75)'} !important;
                      }
                      .bubble-attribute {
                        font-size: 12px !important;
                        color: ${state === 'on' ? 'rgb(255, 149, 0)' : 'rgba(60, 60, 60, 0.7)'} !important;
                      }
                      .bubble-range-slider {
                        position: absolute !important;
                        bottom: 4px !important;
                        width: 60% !important;
                        height: 3px !important;
                        opacity: ${state === 'on' ? '1' : '0'} !important;
                      }
                      .bubble-range-fill { background: rgb(255, 149, 0) !important; }
                  - type: custom:bubble-card
                    card_type: button
                    button_type: slider
                    entity: light.column_lights
                    name: Columns
                    icon: mdi:pillar
                    show_state: false
                    show_attribute: true
                    attribute: brightness
                    scrolling_effect: false
                    tap_action:
                      action: toggle
                    hold_action:
                      action: more-info
                    double_tap_action:
                      action: call-service
                      service: light.turn_on
                      target:
                        entity_id: light.column_lights
                      data:
                        brightness_pct: 100
                    card_mod:
                      style: |
                        ha-card {
                          background: transparent !important;
                          border: none !important;
                          box-shadow: none !important;
                          max-width: clamp(95px, 22vw, 140px) !important;
                          margin: 0 auto !important;
                        }
                    styles: >-
                      .bubble-button-card-container {
                        position: relative !important;
                        display: grid !important;
                        min-height: 76px !important;
                        padding: 14px 6px 5px 6px !important;
                        border-radius: 14px !important;
                        overflow: hidden !important;
                        background: ${state === 'on' ? 'rgba(255, 255, 255, 0.20)' : 'rgba(255, 255, 255, 0.12)'} !important;
                        backdrop-filter: blur(3px) !important;
                        border: ${state === 'on' ? '1px solid rgba(255, 149, 0, 0.6)' : '1px solid rgba(120, 120, 120, 0.55)'} !important;
                      }
                      .bubble-button-card-container:active { transform: scale(0.95) !important; }
                      .bubble-button-card-container::after {
                        content: '' !important;
                        position: absolute !important;
                        top: 5px !important;
                        right: 5px !important;
                        width: ${(hass.states['switch.adaptive_lighting_column_lights']?.attributes?.manual_control?.length > 0) ? '7px' : '0px'} !important;
                        height: ${(hass.states['switch.adaptive_lighting_column_lights']?.attributes?.manual_control?.length > 0) ? '7px' : '0px'} !important;
                        border-radius: 50% !important;
                        background: rgb(255, 110, 90) !important;
                        z-index: 25 !important;
                      }
                      .bubble-icon-container {
                        min-width: 28px !important;
                        min-height: 28px !important;
                        margin: 8px 0 6px 0 !important;
                        border-radius: 50% !important;
                        background: ${state === 'on' ? 'rgba(255, 149, 0, 0.22)' : 'rgba(60, 60, 60, 0.30)'} !important;
                      }
                      .bubble-icon {
                        --mdc-icon-size: 20px !important;
                        color: ${state === 'on' ? 'rgb(255, 149, 0)' : 'rgba(40, 40, 40, 0.80)'} !important;
                      }
                      .bubble-name {
                        font-weight: 700 !important;
                        font-size: 14px !important;
                        text-transform: uppercase !important;
                        color: ${state === 'on' ? 'rgba(40, 40, 40, 0.95)' : 'rgba(50, 50, 50, 0.75)'} !important;
                      }
                      .bubble-attribute {
                        font-size: 12px !important;
                        color: ${state === 'on' ? 'rgb(255, 149, 0)' : 'rgba(60, 60, 60, 0.7)'} !important;
                      }
                      .bubble-range-slider {
                        position: absolute !important;
                        bottom: 4px !important;
                        width: 60% !important;
                        height: 3px !important;
                        opacity: ${state === 'on' ? '1' : '0'} !important;
                      }
                      .bubble-range-fill { background: rgb(255, 149, 0) !important; }
            grid_options:
              columns: full
              rows: auto
            card_mod:
              style: |
                :host {
                  background:
                    radial-gradient(
                      ellipse at center,
                      rgba(255, 255, 255, 0.35) 0%,
                      rgba(255, 255, 255, 0.22) 60%,
                      rgba(0, 0, 0, 0.02) 100%
                    ),
                    url('/local/image/Room7.png') !important;
                  backdrop-filter: blur(2px) !important;
                  -webkit-backdrop-filter: blur(2px) !important;
                  background-size: cover !important;
                  background-position: center !important;
                  border-radius: 28px !important;
                  overflow: hidden !important;
                  border: none !important;
                  box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08) !important;
                  padding: 0 !important;
                  display: block !important;
                }

          # ═══════════════════════════════════════════════════════════════
          # HERO SONOS CARD - Media player + Room tiles
          # ═══════════════════════════════════════════════════════════════
          - view_layout:
              grid-area: sonos
            type: vertical-stack
            card_mod:
              style: |
                :host {
                  background:
                    linear-gradient(
                      180deg,
                      rgba(20, 30, 50, 0.12) 0%,
                      rgba(15, 25, 45, 0.08) 50%,
                      rgba(10, 20, 40, 0.18) 100%
                    ),
                    url('/local/image/sonos_bg.png') !important;
                  background-size: cover !important;
                  background-position: center !important;
                  border-radius: 28px !important;
                  overflow: hidden !important;
                  border: none !important;
                  box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08) !important;
                  padding: 0 !important;
                  display: block !important;
                }
            cards:
              - type: custom:bubble-card
                card_type: media-player
                entity: media_player.living_room
                name: ""
                icon: mdi:speaker-multiple
                card_layout: large-2-rows
                scrolling_effect: false
                show_state: false
                show_icon: false
                show_name: false
                show_last_changed: false
                show_attribute: false
                cover_background: true
                hide:
                  power_button: true
                  previous_button: false
                  next_button: false
                  volume_button: false
                  play_pause_button: false
                button_action:
                  double_tap_action:
                    action: navigate
                    navigation_path: "#sonos-detail"
                  hold_action:
                    action: more-info
                sub_button:
                  main:
                    - name: Group
                      icon: mdi:link-variant
                      entity: media_player.living_room
                      show_state: false
                      show_name: false
                      show_background: true
                      state_background: false
                      tap_action:
                        action: call-service
                        service: script.sonos_group_all_to_playing
                      hold_action:
                        action: call-service
                        service: script.sonos_ungroup_all
                    - name: Skip
                      icon: mdi:skip-next
                      entity: media_player.living_room
                      show_state: false
                      show_name: false
                      show_background: true
                      tap_action:
                        action: perform-action
                        perform_action: media_player.media_next_track
                        target:
                          entity_id: media_player.living_room
                    - name: Prev
                      icon: mdi:skip-previous
                      entity: media_player.living_room
                      show_state: false
                      show_name: false
                      show_background: true
                      tap_action:
                        action: perform-action
                        perform_action: media_player.media_previous_track
                        target:
                          entity_id: media_player.living_room
                  bottom: []
                styles: |
                  ha-card {
                    background: transparent !important;
                    border: none !important;
                    box-shadow: none !important;
                    margin: 0 !important;
                    padding: 12px 16px 8px 16px !important;
                  }
                  .bubble-media-cover {
                    border-radius: 16px !important;
                    opacity: 0.92 !important;
                  }
                  .bubble-title {
                    color: rgba(255, 255, 255, 0.95) !important;
                    font-size: 14px !important;
                    font-weight: 600 !important;
                    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.4) !important;
                  }
                  .bubble-sub-title {
                    color: rgba(255, 255, 255, 0.7) !important;
                    font-size: 12px !important;
                    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3) !important;
                  }
                  .bubble-media-button {
                    background: rgba(255, 255, 255, 0.15) !important;
                    color: rgba(255, 255, 255, 0.95) !important;
                    border: 1px solid rgba(255, 255, 255, 0.2) !important;
                    border-radius: 50% !important;
                    transition: all 0.15s ease !important;
                  }
                  .bubble-media-button:hover {
                    background: rgba(66, 133, 244, 0.3) !important;
                    border-color: rgba(66, 133, 244, 0.5) !important;
                  }
                  .bubble-sub-button-container {
                    background: transparent !important;
                    backdrop-filter: blur(14px) saturate(140%) !important;
                    border-radius: 12px !important;
                    border: 1px solid rgba(255, 255, 255, 0.2) !important;
                    padding: 6px 10px !important;
                    width: fit-content !important;
                    margin-left: auto !important;
                    gap: 6px !important;
                  }
                  .bubble-sub-button {
                    background: rgba(255, 255, 255, 0.15) !important;
                    border: 1px solid rgba(255, 255, 255, 0.2) !important;
                    border-radius: 8px !important;
                    min-width: 40px !important;
                  }
                  .bubble-sub-button ha-icon {
                    color: rgba(255, 255, 255, 0.9) !important;
                    --mdc-icon-size: 15px !important;
                  }
                  .bubble-range-fill {
                    background: linear-gradient(90deg, rgba(66, 133, 244, 0.7) 0%, rgba(100, 181, 246, 0.9) 100%) !important;
                  }
              # Sonos Room Tiles Grid
              - type: custom:layout-card
                layout_type: custom:grid-layout
                layout:
                  grid-template-columns: repeat(5, 1fr)
                  gap: 14px
                  padding: 10px 16px 14px 16px
                  justify-items: center
                mediaquery:
                  "(max-width: 600px)":
                    grid-template-columns: repeat(3, 1fr)
                  "(max-width: 400px)":
                    grid-template-columns: repeat(2, 1fr)
                cards:
                  # Living Room Sonos
                  - type: custom:bubble-card
                    card_type: button
                    button_type: state
                    entity: binary_sensor.sonos_living_room_in_playing_group
                    name: Living
                    icon: mdi:sofa
                    show_state: false
                    show_attribute: false
                    tap_action:
                      action: call-service
                      service: script.sonos_toggle_group_membership
                      data:
                        target_speaker: media_player.living_room
                    hold_action:
                      action: more-info
                      entity: media_player.living_room
                    double_tap_action:
                      action: call-service
                      service: media_player.volume_set
                      target:
                        entity_id: media_player.living_room
                      data:
                        volume_level: 0.3
                    card_mod:
                      style: |
                        ha-card {
                          background: transparent !important;
                          border: none !important;
                          box-shadow: none !important;
                        }
                    styles: >-
                      .bubble-button-card-container {
                        position: relative !important;
                        min-height: 74px !important;
                        padding: 8px 6px 6px 6px !important;
                        border-radius: 14px !important;
                        overflow: hidden !important;
                        transition: transform 0.1s ease-out !important;
                        background: ${state === 'on' ? 'rgba(66, 133, 244, 0.08)' : 'rgba(255, 255, 255, 0.02)'} !important;
                        backdrop-filter: ${state === 'on' ? 'blur(2px) saturate(110%)' : 'blur(0.5px)'} !important;
                        border: ${state === 'on' ? '1.5px solid rgba(66, 133, 244, 0.55)' : '1.5px solid rgba(80, 80, 80, 0.4)'} !important;
                        box-shadow: ${state === 'on' ? '0 2px 8px rgba(66, 133, 244, 0.15)' : 'none'} !important;
                      }
                      .bubble-button-card-container:active { transform: scale(0.96) !important; }
                      .bubble-icon-container {
                        min-width: 32px !important;
                        min-height: 32px !important;
                        margin: 4px 0 4px 0 !important;
                        border-radius: 50% !important;
                        background: ${state === 'on' ? 'rgba(66, 133, 244, 0.18)' : 'rgba(60, 60, 60, 0.18)'} !important;
                        border: ${state === 'on' ? '1px solid rgba(66, 133, 244, 0.35)' : '1px solid rgba(60, 60, 60, 0.25)'} !important;
                      }
                      .bubble-icon {
                        --mdc-icon-size: 18px !important;
                        color: ${state === 'on' ? 'rgb(66, 133, 244)' : 'rgba(20, 20, 20, 0.7)'} !important;
                        filter: ${state === 'on' ? 'drop-shadow(0 0 4px rgba(66, 133, 244, 0.5))' : 'none'} !important;
                      }
                      .bubble-name {
                        font-weight: 600 !important;
                        font-size: 10px !important;
                        text-transform: uppercase !important;
                        letter-spacing: 0.8px !important;
                        color: ${state === 'on' ? 'rgba(255, 255, 255, 0.95)' : 'rgba(10, 10, 10, 0.9)'} !important;
                        text-shadow: ${state === 'on' ? '0 1px 3px rgba(0, 0, 0, 0.3)' : 'none'} !important;
                      }
                      ${(() => {
                        const isCoordinator = hass.states['sensor.sonos_current_playing_group_coordinator']?.state === 'media_player.living_room';
                        const isPlaying = hass.states['media_player.living_room']?.state === 'playing';
                        return isCoordinator && isPlaying ? `
                          .bubble-button-card-container::after {
                            content: '' !important;
                            position: absolute !important;
                            bottom: 6px !important;
                            left: 50% !important;
                            transform: translateX(-50%) !important;
                            width: 60% !important;
                            height: 3px !important;
                            border-radius: 2px !important;
                            background: linear-gradient(90deg, rgba(66, 133, 244, 0.6) 0%, rgba(100, 181, 246, 0.9) 50%, rgba(66, 133, 244, 0.6) 100%) !important;
                            animation: pulse-bar 1.5s ease-in-out infinite !important;
                          }
                          @keyframes pulse-bar { 0%, 100% { opacity: 0.6; } 50% { opacity: 1; } }
                        ` : '';
                      })()}
                    sub_button:
                      main: []
                      bottom: []
                  # Kitchen Sonos
                  - type: custom:bubble-card
                    card_type: button
                    button_type: state
                    entity: binary_sensor.sonos_kitchen_in_playing_group
                    name: Kitchen
                    icon: mdi:stove
                    show_state: false
                    show_attribute: false
                    tap_action:
                      action: call-service
                      service: script.sonos_toggle_group_membership
                      data:
                        target_speaker: media_player.kitchen
                    hold_action:
                      action: more-info
                      entity: media_player.kitchen
                    double_tap_action:
                      action: call-service
                      service: media_player.volume_set
                      target:
                        entity_id: media_player.kitchen
                      data:
                        volume_level: 0.3
                    card_mod:
                      style: |
                        ha-card { background: transparent !important; border: none !important; }
                    styles: >-
                      .bubble-button-card-container {
                        position: relative !important;
                        min-height: 74px !important;
                        padding: 8px 6px 6px 6px !important;
                        border-radius: 14px !important;
                        background: ${state === 'on' ? 'rgba(66, 133, 244, 0.08)' : 'rgba(255, 255, 255, 0.02)'} !important;
                        border: ${state === 'on' ? '1.5px solid rgba(66, 133, 244, 0.55)' : '1.5px solid rgba(80, 80, 80, 0.4)'} !important;
                      }
                      .bubble-button-card-container:active { transform: scale(0.96) !important; }
                      .bubble-icon-container {
                        min-width: 32px !important;
                        min-height: 32px !important;
                        border-radius: 50% !important;
                        background: ${state === 'on' ? 'rgba(66, 133, 244, 0.18)' : 'rgba(60, 60, 60, 0.18)'} !important;
                      }
                      .bubble-icon {
                        --mdc-icon-size: 18px !important;
                        color: ${state === 'on' ? 'rgb(66, 133, 244)' : 'rgba(20, 20, 20, 0.7)'} !important;
                      }
                      .bubble-name {
                        font-weight: 600 !important;
                        font-size: 10px !important;
                        text-transform: uppercase !important;
                        color: ${state === 'on' ? 'rgba(255, 255, 255, 0.95)' : 'rgba(10, 10, 10, 0.9)'} !important;
                      }
                    sub_button:
                      main: []
                  # Bedroom Sonos
                  - type: custom:bubble-card
                    card_type: button
                    button_type: state
                    entity: binary_sensor.sonos_bedroom_in_playing_group
                    name: Bedroom
                    icon: mdi:bed
                    show_state: false
                    tap_action:
                      action: call-service
                      service: script.sonos_toggle_group_membership
                      data:
                        target_speaker: media_player.bedroom
                    hold_action:
                      action: more-info
                      entity: media_player.bedroom
                    double_tap_action:
                      action: call-service
                      service: media_player.volume_set
                      target:
                        entity_id: media_player.bedroom
                      data:
                        volume_level: 0.3
                    card_mod:
                      style: |
                        ha-card { background: transparent !important; border: none !important; }
                    styles: >-
                      .bubble-button-card-container {
                        position: relative !important;
                        min-height: 74px !important;
                        padding: 8px 6px 6px 6px !important;
                        border-radius: 14px !important;
                        background: ${state === 'on' ? 'rgba(66, 133, 244, 0.08)' : 'rgba(255, 255, 255, 0.02)'} !important;
                        border: ${state === 'on' ? '1.5px solid rgba(66, 133, 244, 0.55)' : '1.5px solid rgba(80, 80, 80, 0.4)'} !important;
                      }
                      .bubble-button-card-container:active { transform: scale(0.96) !important; }
                      .bubble-icon-container {
                        min-width: 32px !important;
                        min-height: 32px !important;
                        border-radius: 50% !important;
                        background: ${state === 'on' ? 'rgba(66, 133, 244, 0.18)' : 'rgba(60, 60, 60, 0.18)'} !important;
                      }
                      .bubble-icon {
                        --mdc-icon-size: 18px !important;
                        color: ${state === 'on' ? 'rgb(66, 133, 244)' : 'rgba(20, 20, 20, 0.7)'} !important;
                      }
                      .bubble-name {
                        font-weight: 600 !important;
                        font-size: 10px !important;
                        text-transform: uppercase !important;
                        color: ${state === 'on' ? 'rgba(255, 255, 255, 0.95)' : 'rgba(10, 10, 10, 0.9)'} !important;
                      }
                    sub_button:
                      main: []
                  # Dining Sonos
                  - type: custom:bubble-card
                    card_type: button
                    button_type: state
                    entity: binary_sensor.sonos_dining_room_in_playing_group
                    name: Dining
                    icon: mdi:table-furniture
                    show_state: false
                    tap_action:
                      action: call-service
                      service: script.sonos_toggle_group_membership
                      data:
                        target_speaker: media_player.dining_room
                    hold_action:
                      action: more-info
                      entity: media_player.dining_room
                    double_tap_action:
                      action: call-service
                      service: media_player.volume_set
                      target:
                        entity_id: media_player.dining_room
                      data:
                        volume_level: 0.3
                    card_mod:
                      style: |
                        ha-card { background: transparent !important; border: none !important; }
                    styles: >-
                      .bubble-button-card-container {
                        position: relative !important;
                        min-height: 74px !important;
                        padding: 8px 6px 6px 6px !important;
                        border-radius: 14px !important;
                        background: ${state === 'on' ? 'rgba(66, 133, 244, 0.08)' : 'rgba(255, 255, 255, 0.02)'} !important;
                        border: ${state === 'on' ? '1.5px solid rgba(66, 133, 244, 0.55)' : '1.5px solid rgba(80, 80, 80, 0.4)'} !important;
                      }
                      .bubble-button-card-container:active { transform: scale(0.96) !important; }
                      .bubble-icon-container {
                        min-width: 32px !important;
                        min-height: 32px !important;
                        border-radius: 50% !important;
                        background: ${state === 'on' ? 'rgba(66, 133, 244, 0.18)' : 'rgba(60, 60, 60, 0.18)'} !important;
                      }
                      .bubble-icon {
                        --mdc-icon-size: 18px !important;
                        color: ${state === 'on' ? 'rgb(66, 133, 244)' : 'rgba(20, 20, 20, 0.7)'} !important;
                      }
                      .bubble-name {
                        font-weight: 600 !important;
                        font-size: 10px !important;
                        text-transform: uppercase !important;
                        color: ${state === 'on' ? 'rgba(255, 255, 255, 0.95)' : 'rgba(10, 10, 10, 0.9)'} !important;
                      }
                    sub_button:
                      main: []
                  # Bath Sonos
                  - type: custom:bubble-card
                    card_type: button
                    button_type: state
                    entity: binary_sensor.sonos_bath_in_playing_group
                    name: Bath
                    icon: mdi:shower-head
                    show_state: false
                    tap_action:
                      action: call-service
                      service: script.sonos_toggle_group_membership
                      data:
                        target_speaker: media_player.bath
                    hold_action:
                      action: more-info
                      entity: media_player.bath
                    double_tap_action:
                      action: call-service
                      service: media_player.volume_set
                      target:
                        entity_id: media_player.bath
                      data:
                        volume_level: 0.3
                    card_mod:
                      style: |
                        ha-card { background: transparent !important; border: none !important; }
                    styles: >-
                      .bubble-button-card-container {
                        position: relative !important;
                        min-height: 74px !important;
                        padding: 8px 6px 6px 6px !important;
                        border-radius: 14px !important;
                        background: ${state === 'on' ? 'rgba(66, 133, 244, 0.08)' : 'rgba(255, 255, 255, 0.02)'} !important;
                        border: ${state === 'on' ? '1.5px solid rgba(66, 133, 244, 0.55)' : '1.5px solid rgba(80, 80, 80, 0.4)'} !important;
                      }
                      .bubble-button-card-container:active { transform: scale(0.96) !important; }
                      .bubble-icon-container {
                        min-width: 32px !important;
                        min-height: 32px !important;
                        border-radius: 50% !important;
                        background: ${state === 'on' ? 'rgba(66, 133, 244, 0.18)' : 'rgba(60, 60, 60, 0.18)'} !important;
                      }
                      .bubble-icon {
                        --mdc-icon-size: 18px !important;
                        color: ${state === 'on' ? 'rgb(66, 133, 244)' : 'rgba(20, 20, 20, 0.7)'} !important;
                      }
                      .bubble-name {
                        font-weight: 600 !important;
                        font-size: 10px !important;
                        text-transform: uppercase !important;
                        color: ${state === 'on' ? 'rgba(255, 255, 255, 0.95)' : 'rgba(10, 10, 10, 0.9)'} !important;
                      }
                    sub_button:
                      main: []

      # ═══════════════════════════════════════════════════════════════════
      # ROOM CARDS SECTION - Detailed per-room controls
      # Note: Full room cards in Dashboard/cards/ can be used in popups
      # ═══════════════════════════════════════════════════════════════════
      - view_layout:
          grid-area: rooms
        type: custom:layout-card
        layout_type: custom:grid-layout
        layout:
          grid-template-columns: repeat(3, 1fr)
          gap: 16px
        mediaquery:
          "(max-width: 900px)":
            grid-template-columns: repeat(2, 1fr)
          "(max-width: 500px)":
            grid-template-columns: 1fr
        cards:
          # Living Room Summary Card
          - type: custom:bubble-card
            card_type: button
            button_type: slider
            entity: light.living_room_lights
            name: Living Room
            icon: mdi:sofa
            show_state: false
            show_attribute: true
            attribute: brightness
            tap_action:
              action: toggle
            hold_action:
              action: navigate
              navigation_path: "#room-living"
            double_tap_action:
              action: call-service
              service: light.turn_on
              target:
                entity_id: light.living_room_lights
              data:
                brightness_pct: 100
            styles: >-
              ${(() => {
                const roomState = hass.states['sensor.room_living_state']?.state || 'idle';
                const hasOverride = hass.states['switch.adaptive_lighting_main_living']?.attributes?.manual_control?.length > 0;
                let bgGradient, borderColor, iconColor;
                if (hasOverride) {
                  bgGradient = 'linear-gradient(180deg, rgba(156, 39, 176, 0.12) 0%, rgba(255, 255, 255, 0.08) 100%)';
                  borderColor = 'rgba(156, 39, 176, 0.4)';
                  iconColor = 'rgb(156, 39, 176)';
                } else if (roomState === 'playing') {
                  bgGradient = 'linear-gradient(180deg, rgba(66, 133, 244, 0.12) 0%, rgba(255, 255, 255, 0.08) 100%)';
                  borderColor = 'rgba(66, 133, 244, 0.4)';
                  iconColor = 'rgb(66, 133, 244)';
                } else if (roomState === 'active') {
                  bgGradient = 'linear-gradient(180deg, rgba(255, 149, 0, 0.12) 0%, rgba(255, 255, 255, 0.08) 100%)';
                  borderColor = 'rgba(255, 149, 0, 0.4)';
                  iconColor = 'rgb(255, 149, 0)';
                } else {
                  bgGradient = 'rgba(255, 255, 255, 0.06)';
                  borderColor = 'rgba(255, 255, 255, 0.15)';
                  iconColor = 'rgba(100, 100, 100, 0.7)';
                }
                return `
                  ha-card {
                    background: ${bgGradient} !important;
                    backdrop-filter: blur(14px) saturate(140%) !important;
                    border: 1px solid ${borderColor} !important;
                    border-radius: 20px !important;
                    padding: 16px !important;
                  }
                  .bubble-button-card-container { background: transparent !important; position: relative !important; }
                  .bubble-button-card-container::after {
                    content: '' !important;
                    position: absolute !important;
                    top: 8px !important;
                    right: 8px !important;
                    width: ${hasOverride ? '10px' : '0px'} !important;
                    height: ${hasOverride ? '10px' : '0px'} !important;
                    border-radius: 50% !important;
                    background: rgb(255, 110, 90) !important;
                    border: 2px solid rgba(255, 255, 255, 0.8) !important;
                    z-index: 25 !important;
                  }
                  .bubble-icon-container {
                    background: rgba(100, 100, 100, 0.1) !important;
                    border-radius: 50% !important;
                    min-width: 48px !important;
                    min-height: 48px !important;
                  }
                  .bubble-icon {
                    color: ${iconColor} !important;
                    --mdc-icon-size: 28px !important;
                  }
                  .bubble-name {
                    font-size: 18px !important;
                    font-weight: 700 !important;
                    color: rgba(40, 40, 40, 0.95) !important;
                  }
                  .bubble-attribute {
                    font-size: 14px !important;
                    color: ${iconColor} !important;
                    font-weight: 600 !important;
                  }
                  .bubble-range-fill { background: ${iconColor} !important; }
                `;
              })()}
          # Bedroom Summary Card
          - type: custom:bubble-card
            card_type: button
            button_type: slider
            entity: light.bedroom_primary_lights
            name: Bedroom
            icon: mdi:bed
            show_state: false
            show_attribute: true
            attribute: brightness
            tap_action:
              action: toggle
            hold_action:
              action: navigate
              navigation_path: "#room-bedroom"
            double_tap_action:
              action: call-service
              service: light.turn_on
              target:
                entity_id: light.bedroom_primary_lights
              data:
                brightness_pct: 100
            sub_button:
              main:
                - entity: sensor.sonos_next_alarm_chip
                  name: ''
                  icon: mdi:alarm
                  show_name: false
                  show_icon: true
                  show_background: true
                  show_state: true
                  tap_action:
                    action: perform-action
                    perform_action: script.sonos_toggle_next_alarm
                    target: {}
                  visibility:
                    - condition: template
                      value_template: "{{ states('sensor.sonos_next_alarm_chip') != 'None' }}"
            styles: >-
              ${(() => {
                const roomState = hass.states['sensor.room_bedroom_state']?.state || 'idle';
                const hasOverride = hass.states['switch.adaptive_lighting_bedroom_primary']?.attributes?.manual_control?.length > 0;
                const alarmEnabled = hass.states['sensor.sonos_next_alarm_chip']?.attributes?.is_enabled === true;
                let bgGradient, borderColor, iconColor;
                if (hasOverride) {
                  bgGradient = 'linear-gradient(180deg, rgba(156, 39, 176, 0.12) 0%, rgba(255, 255, 255, 0.08) 100%)';
                  borderColor = 'rgba(156, 39, 176, 0.4)';
                  iconColor = 'rgb(156, 39, 176)';
                } else if (roomState === 'alarm') {
                  bgGradient = 'linear-gradient(180deg, rgba(66, 133, 244, 0.12) 0%, rgba(255, 255, 255, 0.08) 100%)';
                  borderColor = 'rgba(66, 133, 244, 0.4)';
                  iconColor = 'rgb(66, 133, 244)';
                } else if (roomState === 'active') {
                  bgGradient = 'linear-gradient(180deg, rgba(255, 149, 0, 0.12) 0%, rgba(255, 255, 255, 0.08) 100%)';
                  borderColor = 'rgba(255, 149, 0, 0.4)';
                  iconColor = 'rgb(255, 149, 0)';
                } else {
                  bgGradient = 'rgba(255, 255, 255, 0.06)';
                  borderColor = 'rgba(255, 255, 255, 0.15)';
                  iconColor = 'rgba(100, 100, 100, 0.7)';
                }
                return `
                  ha-card {
                    background: ${bgGradient} !important;
                    backdrop-filter: blur(14px) saturate(140%) !important;
                    border: 1px solid ${borderColor} !important;
                    border-radius: 20px !important;
                    padding: 16px !important;
                  }
                  .bubble-button-card-container { background: transparent !important; position: relative !important; }
                  .bubble-button-card-container::after {
                    content: '' !important;
                    position: absolute !important;
                    top: 8px !important;
                    right: 8px !important;
                    width: ${hasOverride ? '10px' : '0px'} !important;
                    height: ${hasOverride ? '10px' : '0px'} !important;
                    border-radius: 50% !important;
                    background: rgb(255, 110, 90) !important;
                    z-index: 25 !important;
                  }
                  .bubble-icon-container {
                    background: rgba(100, 100, 100, 0.1) !important;
                    border-radius: 50% !important;
                    min-width: 48px !important;
                    min-height: 48px !important;
                  }
                  .bubble-icon {
                    color: ${iconColor} !important;
                    --mdc-icon-size: 28px !important;
                  }
                  .bubble-name {
                    font-size: 18px !important;
                    font-weight: 700 !important;
                    color: rgba(40, 40, 40, 0.95) !important;
                  }
                  .bubble-attribute {
                    font-size: 14px !important;
                    color: ${iconColor} !important;
                    font-weight: 600 !important;
                  }
                  .bubble-range-fill { background: ${iconColor} !important; }
                  .bubble-sub-button {
                    background: ${alarmEnabled ? 'rgba(138, 100, 200, 0.15)' : 'rgba(120, 120, 120, 0.10)'} !important;
                    border: ${alarmEnabled ? '1px solid rgba(138, 100, 200, 0.35)' : '1px solid rgba(120, 120, 120, 0.25)'} !important;
                    border-radius: 10px !important;
                  }
                  .bubble-sub-button .bubble-sub-button-icon {
                    color: ${alarmEnabled ? 'rgba(120, 80, 180, 0.9)' : 'rgba(80, 80, 80, 0.5)'} !important;
                  }
                `;
              })()}
          # Kitchen Summary Card
          - type: custom:bubble-card
            card_type: button
            button_type: slider
            entity: light.all_kitchen_lights
            name: Kitchen
            icon: mdi:countertop
            show_state: false
            show_attribute: true
            attribute: brightness
            tap_action:
              action: toggle
            hold_action:
              action: navigate
              navigation_path: "#room-kitchen"
            double_tap_action:
              action: call-service
              service: light.turn_on
              target:
                entity_id: light.all_kitchen_lights
              data:
                brightness_pct: 100
            styles: >-
              ${(() => {
                const roomState = hass.states['sensor.room_kitchen_state']?.state || 'idle';
                const hasOverride = hass.states['switch.adaptive_lighting_kitchen_island']?.attributes?.manual_control?.length > 0;
                let bgGradient, borderColor, iconColor;
                if (hasOverride) {
                  bgGradient = 'linear-gradient(180deg, rgba(156, 39, 176, 0.12) 0%, rgba(255, 255, 255, 0.08) 100%)';
                  borderColor = 'rgba(156, 39, 176, 0.4)';
                  iconColor = 'rgb(156, 39, 176)';
                } else if (roomState === 'playing') {
                  bgGradient = 'linear-gradient(180deg, rgba(66, 133, 244, 0.12) 0%, rgba(255, 255, 255, 0.08) 100%)';
                  borderColor = 'rgba(66, 133, 244, 0.4)';
                  iconColor = 'rgb(66, 133, 244)';
                } else if (roomState === 'active') {
                  bgGradient = 'linear-gradient(180deg, rgba(255, 149, 0, 0.12) 0%, rgba(255, 255, 255, 0.08) 100%)';
                  borderColor = 'rgba(255, 149, 0, 0.4)';
                  iconColor = 'rgb(255, 149, 0)';
                } else {
                  bgGradient = 'rgba(255, 255, 255, 0.06)';
                  borderColor = 'rgba(255, 255, 255, 0.15)';
                  iconColor = 'rgba(100, 100, 100, 0.7)';
                }
                return `
                  ha-card {
                    background: ${bgGradient} !important;
                    backdrop-filter: blur(14px) saturate(140%) !important;
                    border: 1px solid ${borderColor} !important;
                    border-radius: 20px !important;
                    padding: 16px !important;
                  }
                  .bubble-button-card-container { background: transparent !important; position: relative !important; }
                  .bubble-button-card-container::after {
                    content: '' !important;
                    position: absolute !important;
                    top: 8px !important;
                    right: 8px !important;
                    width: ${hasOverride ? '10px' : '0px'} !important;
                    height: ${hasOverride ? '10px' : '0px'} !important;
                    border-radius: 50% !important;
                    background: rgb(255, 110, 90) !important;
                    z-index: 25 !important;
                  }
                  .bubble-icon-container {
                    background: rgba(100, 100, 100, 0.1) !important;
                    border-radius: 50% !important;
                    min-width: 48px !important;
                    min-height: 48px !important;
                  }
                  .bubble-icon {
                    color: ${iconColor} !important;
                    --mdc-icon-size: 28px !important;
                  }
                  .bubble-name {
                    font-size: 18px !important;
                    font-weight: 700 !important;
                    color: rgba(40, 40, 40, 0.95) !important;
                  }
                  .bubble-attribute {
                    font-size: 14px !important;
                    color: ${iconColor} !important;
                    font-weight: 600 !important;
                  }
                  .bubble-range-fill { background: ${iconColor} !important; }
                `;
              })()}

      # ═══════════════════════════════════════════════════════════════════
      # CLIMATE SECTION
      # ═══════════════════════════════════════════════════════════════════
      - view_layout:
          grid-area: climate
        type: custom:bubble-card
        card_type: button
        button_type: state
        entity: climate.dining_room
        name: Climate
        icon: mdi:thermostat
        show_state: true
        show_attribute: true
        attribute: current_temperature
        tap_action:
          action: more-info
        hold_action:
          action: more-info
        sub_button:
          main:
            - name: Target
              entity: climate.dining_room
              show_attribute: true
              attribute: temperature
              show_background: true
              tap_action:
                action: more-info
            - name: Mode
              entity: climate.dining_room
              icon: mdi:fan
              show_state: false
              show_background: true
              visibility:
                - condition: template
                  value_template: "{{ states('climate.dining_room') not in ['unavailable', 'unknown'] }}"
              tap_action:
                action: call-service
                service: climate.set_hvac_mode
                target:
                  entity_id: climate.dining_room
                data:
                  hvac_mode: auto
        styles: >-
          ${(() => {
            const climate = hass.states['climate.dining_room'];
            const state = climate?.state || 'off';
            const hvacAction = climate?.attributes?.hvac_action || 'idle';
            let bgGradient, borderColor, iconColor;
            if (hvacAction === 'heating') {
              bgGradient = 'linear-gradient(180deg, rgba(244, 67, 54, 0.12) 0%, rgba(255, 255, 255, 0.06) 100%)';
              borderColor = 'rgba(244, 67, 54, 0.4)';
              iconColor = 'rgb(244, 67, 54)';
            } else if (hvacAction === 'cooling') {
              bgGradient = 'linear-gradient(180deg, rgba(66, 133, 244, 0.12) 0%, rgba(255, 255, 255, 0.06) 100%)';
              borderColor = 'rgba(66, 133, 244, 0.4)';
              iconColor = 'rgb(66, 133, 244)';
            } else if (state === 'heat_cool' || state === 'auto') {
              bgGradient = 'linear-gradient(180deg, rgba(76, 175, 80, 0.08) 0%, rgba(255, 255, 255, 0.06) 100%)';
              borderColor = 'rgba(76, 175, 80, 0.3)';
              iconColor = 'rgb(76, 175, 80)';
            } else {
              bgGradient = 'rgba(255, 255, 255, 0.06)';
              borderColor = 'rgba(255, 255, 255, 0.15)';
              iconColor = 'rgba(100, 100, 100, 0.7)';
            }
            return `
              ha-card {
                background: ${bgGradient} !important;
                backdrop-filter: blur(14px) saturate(140%) !important;
                border: 1px solid ${borderColor} !important;
                border-radius: 20px !important;
                padding: 16px !important;
              }
              .bubble-button-card-container { background: transparent !important; }
              .bubble-icon-container {
                background: ${iconColor.replace('rgb', 'rgba').replace(')', ', 0.15)')} !important;
                border-radius: 50% !important;
                min-width: 48px !important;
                min-height: 48px !important;
              }
              .bubble-icon {
                color: ${iconColor} !important;
                --mdc-icon-size: 28px !important;
                ${hvacAction !== 'idle' && hvacAction !== 'off' ? `filter: drop-shadow(0 0 8px ${iconColor.replace('rgb', 'rgba').replace(')', ', 0.5)')}) !important;` : ''}
              }
              .bubble-name {
                font-size: 16px !important;
                font-weight: 700 !important;
                color: rgba(40, 40, 40, 0.95) !important;
              }
              .bubble-state {
                font-size: 13px !important;
                color: rgba(60, 60, 60, 0.8) !important;
                text-transform: capitalize !important;
              }
              .bubble-attribute {
                font-size: 24px !important;
                font-weight: 700 !important;
                color: ${iconColor} !important;
              }
              .bubble-sub-button {
                background: rgba(255, 255, 255, 0.12) !important;
                border: 1px solid rgba(255, 255, 255, 0.2) !important;
                border-radius: 10px !important;
                padding: 8px 12px !important;
              }
              .bubble-sub-button-1 .bubble-sub-button-attribute {
                font-size: 14px !important;
                font-weight: 600 !important;
                color: ${iconColor} !important;
              }
              ${hvacAction === 'heating' ? `
                .bubble-icon-container::after {
                  content: '\U0001F525';
                  position: absolute;
                  bottom: -4px;
                  right: -4px;
                  font-size: 14px;
                }
              ` : hvacAction === 'cooling' ? `
                .bubble-icon-container::after {
                  content: '\u2744\ufe0f';
                  position: absolute;
                  bottom: -4px;
                  right: -4px;
                  font-size: 14px;
                }
              ` : ''}
            `;
          })()}
        card_mod:
          style: |
            :host {
              margin-bottom: 16px !important;
            }
