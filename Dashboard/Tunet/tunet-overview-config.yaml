# ═══════════════════════════════════════════════════════════════
# Tunet Overview Dashboard — Final Composition Contract
# ═══════════════════════════════════════════════════════════════
# Order:
#   1) Quick Actions Strip (compact)
#   2) Home Status (4x2)
#   3) Lighting Hero (Top 5 zones)
#   4) Environment Row (Climate + Weather)
#   5) Media
#   6) Rooms
#
# Notes:
# - This file is card-YAML for the overview page composition.
# - Uses native HA grid card for side-by-side environment row.
# - Status tiles support tap_action, show_when, and aux_action.
# - No external layout-card dependency.
# ═══════════════════════════════════════════════════════════════

# ─── 1. QUICK ACTIONS ─────────────────────────────────────────
- type: custom:tunet-actions-card
  variant: mode_strip
  compact: true
  mode_entity: input_select.oal_active_configuration
  actions:
    - name: All On
      icon: lightbulb
      accent: amber
      service: light.turn_on
      service_data:
        entity_id: light.all_adaptive_lights
      state_entity: light.all_adaptive_lights
      active_when: 'on'

    - name: All Off
      icon: power_settings_new
      accent: amber
      service: light.turn_off
      service_data:
        entity_id: light.all_adaptive_lights
      state_entity: light.all_adaptive_lights
      active_when: 'off'

    - name: Bedtime
      icon: bedtime
      accent: amber
      service: input_select.select_option
      service_data:
        entity_id: input_select.oal_active_configuration
        option: Dim Ambient
      state_entity: input_select.oal_active_configuration
      active_when: Dim Ambient

    - name: Sleep Mode
      icon: bed
      accent: amber
      service: input_select.select_option
      service_data:
        entity_id: input_select.oal_active_configuration
        option: Sleep
      state_entity: input_select.oal_active_configuration
      active_when: Sleep

# ─── 2. HOME STATUS (4x2) ─────────────────────────────────────
- type: custom:tunet-status-card
  name: Home Status
  columns: 4
  tile_size: compact
  tiles:
    # Row 1
    - type: value
      entity: sensor.oal_system_status
      icon: sunny
      label: Adaptive
      accent: green
      attribute: zones_adaptive
      format: integer
      tap_action:
        action: navigate
        navigation_path: /tunet-overview/lights

    - type: value
      entity: sensor.oal_system_status
      icon: front_hand
      label: Manual
      accent: red
      attribute: active_zonal_overrides
      format: integer
      show_when:
        entity: sensor.oal_system_status
        operator: not_equals
        state: Adaptive
      aux_action:
        label: Reset
        icon: restart_alt
        action: call-service
        service: script.turn_on
        service_data:
          entity_id: script.oal_reset_soft
      tap_action:
        action: more-info

    - type: value
      entity: sensor.oal_global_brightness_offset
      icon: bolt
      label: Boost
      accent: amber
      format: integer
      secondary:
        entity: sensor.oal_system_status
        attribute: active_modifiers

    - type: dropdown
      entity: input_select.oal_active_configuration
      icon: tune
      label: Mode
      accent: muted

    # Row 2 (fixed)
    - type: value
      entity: weather.home
      icon: partly_cloudy_day
      label: Weather
      accent: blue
      format: state

    - type: value
      entity: weather.home
      icon: thermostat
      label: Outside
      accent: blue
      attribute: temperature
      unit: °F
      format: integer

    - type: value
      entity: weather.home
      icon: water_drop
      label: Humidity
      accent: blue
      attribute: humidity
      unit: '%'
      format: integer

    - type: value
      entity: sensor.dining_room_temperature
      icon: home
      label: Inside
      accent: amber
      unit: °F
      format: integer

# ─── 3. LIGHTING HERO (3x2 CORE ZONES) ────────────────────────
- type: custom:tunet-lighting-card
  name: Lighting
  surface: section
  layout: grid
  expand_groups: false
  show_adaptive_toggle: false
  tile_size: compact
  columns: 3
  rows: 2
  adaptive_entity: switch.adaptive_lighting_main_living
  primary_entity: sensor.oal_system_status
  zones:
    - entity: light.living_room_lights
      name: Living
      icon: lightbulb
    - entity: light.kitchen_island_lights
      name: Kitchen
      icon: kitchen
    - entity: light.bedroom_primary_lights
      name: Bedroom
      icon: bed
    - entity: light.accent_spots_lights
      name: Spots
      icon: highlight
    - entity: light.recessed_ceiling_lights
      name: Ceiling
      icon: light
    - entity: light.column_lights
      name: Columns
      icon: view_column

# ─── 4. ENVIRONMENT ROW ───────────────────────────────────────
- type: grid
  columns: 2
  square: false
  cards:
    - type: custom:tunet-climate-card
      entity: climate.dining_room
      name: Climate

    - type: custom:tunet-weather-card
      entity: weather.home
      name: Environment
      forecast_days: 5
      show_last_updated: false

# ─── 4b. ENVIRONMENT SENSORS ─────────────────────────────────
- type: custom:tunet-sensor-card
  title: Environment
  icon: sensors
  icon_color: blue
  show_sparkline: true
  show_trend: true
  sensors:
    - entity: sensor.dining_room_temperature
      label: Living Room
      icon: thermostat
      accent: amber
      unit: "°F"
      precision: 0
      thresholds:
        - value: 80
          condition: gte
          style: error
        - value: 75
          condition: gte
          style: warning
      show_range: true
    - entity: sensor.kitchen_humidity
      label: Humidity
      icon: water_drop
      accent: blue
      unit: "%"
      precision: 0
      thresholds:
        - value: 60
          condition: gte
          style: warning
        - value: 20
          condition: lte
          style: warning
      show_range: true
    - entity: weather.home
      label: Outside
      icon: device_thermostat
      accent: blue
      unit: "°F"
      precision: 0
      value_attribute: temperature
      show_range: true
    - entity: sensor.aqi
      label: Air Quality
      icon: air
      accent: green
      unit: AQI
      thresholds:
        - value: 150
          condition: gte
          style: error
        - value: 100
          condition: gte
          style: warning
        - value: 50
          condition: lte
          style: success

# ─── 5. MEDIA ─────────────────────────────────────────────────
- type: custom:tunet-media-card
  entity: media_player.living_room
  name: Sonos
  show_progress: true

# ─── 6. ROOMS ─────────────────────────────────────────────────
- type: custom:tunet-rooms-card
  name: Rooms
  rooms:
    - name: Living Room
      icon: weekend
      temperature_entity: sensor.dining_room_temperature
      navigate_path: /tunet-overview/living-room
      lights:
        - entity: light.living_room_couch_lamp
          icon: lamp
          name: Couch
        - entity: light.living_room_floor_lamp
          icon: lamp
          name: Floor
        - entity: light.living_room_spot_lights
          icon: highlight
          name: Spots
        - entity: light.living_room_credenza_light
          icon: light
          name: Credenza

    - name: Kitchen
      icon: kitchen
      navigate_path: /tunet-overview/kitchen
      lights:
        - entity: light.kitchen_island_pendants
          icon: light
          name: Pendants
        - entity: light.kitchen_main_lights
          icon: kitchen
          name: Main
        - entity: light.kitchen_counter_cabinet_underlights
          icon: kitchen
          name: Under-cab

    - name: Dining Room
      icon: restaurant
      temperature_entity: sensor.dining_room_temperature
      navigate_path: /tunet-overview/dining
      lights:
        - entity: light.dining_room_spot_lights
          icon: highlight
          name: Spots
        - entity: light.all_column_lights
          icon: view_column
          name: Columns

    - name: Bedroom
      icon: bed
      temperature_entity: sensor.bedroom_temp_humidity_sensor_temperature
      navigate_path: /tunet-overview/bedroom
      lights:
        - entity: light.master_presence
          icon: bed
          name: Main
        - entity: light.master_bedroom_corner_accent_govee
          icon: nightlight
          name: Accent
        - entity: light.master_bedroom_table_lamps
          icon: lamp
          name: Table Lamps

    - name: Office
      icon: desktop_windows
      navigate_path: /tunet-overview/office
      lights:
        - entity: light.office_desk_lamp
          icon: desk
          name: Desk
